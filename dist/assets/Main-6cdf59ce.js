import{P as oe}from"./ProgressModal-abda8de4.js";import{d as G,r as s,i as z,w as ce,o as ne,f as F,g as y,j as r,x as D,h as e,y as V,k as M,z as re,T as ve,F as Q,n as p,A as pe,_ as Y,t as W,C as fe,D as ae,E as se,p as ie,m as de,G as me,H as ge}from"./index-ce9b54a5.js";import{s as S}from"./services-3e2e4a22.js";const _e={id:"teleport-upload-modal",class:"contents"},be={class:"title-area"},ye={class:"original"},he={class:"pixell-ai"},xe=["src"],ke=["src"],Ve={key:0,class:"timeline-area"},Ie={class:"video-menu-area"},Be=G({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(I){const f=I,B=s(null),h=s(null),$=s(null),d=s(null),m=s(null),b=s(null),x=s(!1),g=s(!1),U=z("signOut"),O=s(!1),i=s(null),{isUploaded:k,isInferred:L,originalVideoSrc:R,inferredVideoSrc:C}=ce(f),T=()=>{C.value.split(".").pop(),i.value!==null&&clearTimeout(i.value),window.navigator.clipboard.writeText(C.value).then(()=>{const n=document.createElement("a");n.href=C.value,n.download=C.value,n.click(),O.value=!0,i.value=setTimeout(()=>{O.value=!1},2e3)})},j=n=>{const t=B.value;let o=!1;document.onmouseup=()=>{o=!1,g.value=!1};const a=()=>{o=!0,g.value=!0},v=w=>{if(o&&t!==null){const J=t.getBoundingClientRect();if("pageX"in w){const q=(w.pageX-J.left)/t.offsetWidth*100;q<100&&q>0?n.style.left=q+"%":q<=0?n.style.left="0px":q>=100&&(n.style.left="100%")}}},_=()=>{o=!1,g.value=!1};n.onmousedown=a,n.onmouseup=_,t!==null&&(t.onmousemove=v,t.onmouseout=v)},E=n=>{if(g.value){const t=B.value,o=$.value,a=m.value;if(t!==null){const v=t.getBoundingClientRect();if("pageX"in n){const _=(n.pageX-v.left)/t.offsetWidth*100;_<100&&_>0?(o.style.width=_+"%",a.style.width=100/_*100+"%",a.style.zIndex="3"):_<=0?(o.style.width="0",a.style.width="0"):_>=100&&(o.style.width="100%",a.style.width="100%")}}}},N=()=>{d.value!==null&&m.value!==null&&(d.value.paused?(d.value.play(),m.value.play(),x.value=!0):(d.value.pause(),m.value.pause(),x.value=!1))},X=n=>{d.value!==null&&m.value!==null&&(n=="forward"?(m.value.currentTime+=10,d.value.currentTime+=10):(m.value.currentTime-=10,d.value.currentTime-=10))},H=()=>{x.value=!1};return ne(()=>{const n=B.value,t=b.value;t!==null&&n!==null&&(j(t),n.addEventListener("mousemove",E,!1),n.addEventListener("mouseout",E,!1),n.addEventListener("touchstart",E,!1),n.addEventListener("touchmove",E,!1)),d.value!==null&&(d.value.addEventListener("ended",H,!1),d.value.addEventListener("timeupdate",o=>{},!1),d.value.addEventListener("seeking",o=>{d.value!==null&&console.log(Math.floor(d.value.currentTime))},!1))}),(n,t)=>{const o=F("FontAwesomeIcon");return p(),y(Q,null,[r(o,{icon:"right-from-bracket",class:"sign-out-button",onClick:D(U)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:B},[e("div",_e,[e("div",be,[e("div",ye,[e("strong",{class:V(D(k)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",he,[e("strong",{class:V(D(L)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:h},[D(L)?(p(),y("button",{key:0,ref_key:"draggableButton",ref:b,class:"drag-btn"},null,512)):M("",!0),e("video",{ref_key:"originalVideo",ref:d,src:D(R)},null,8,xe),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:$},[e("video",{ref_key:"inferenceVideo",ref:m,src:D(C)},null,8,ke)],512),D(L)?(p(),y("button",{key:1,class:"share-btn",onClick:T},[r(ve,{name:"fade",mode:"out-in"},{default:re(()=>[O.value?(p(),y("span",{key:0,class:"copy-text",onClick:t[0]||(t[0]=pe(()=>{},["stop"]))},"copied.")):M("",!0)]),_:1})])):M("",!0)],512),D(L)?(p(),y("div",Ve,[e("div",Ie,[r(o,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:t[1]||(t[1]=a=>X("backward"))}),r(o,{icon:"circle-play",class:"fa-3x play-button",onClick:N}),r(o,{icon:"play",class:"fa-3x next-button",onClick:t[2]||(t[2]=a=>X("forward"))})])])):M("",!0)])],512)],64)}}});const Ce=Y(Be,[["__scopeId","data-v-49ba84d9"]]),we="http://172.168.10.91:49090/assets/sample_video_img-8e9d2f79.png",Z=I=>(ie("data-v-a5bf2b61"),I=I(),de(),I),Ae={class:"upload-modal-container"},Se={class:"contents"},$e=Z(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),Oe=Z(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Le={class:"sample-video-area"},Ee=Z(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),Ue={class:"sample-video-list"},Me=["onClick"],Pe={key:0,class:"file-name-area"},Re={class:"file-name"},qe={key:1,class:"file-name-area"},De={class:"upload-btn-area"},Fe=G({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(I,{emit:f}){const B=z("defaultInstance"),h=z("emitter"),$=s([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),d=s(0),m=s(!1),b=s(0),x=s(-1),g=s([]),U=s(!1),O=new AbortController,i=t=>{g.value.length>0?h.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):x.value=t},k=()=>{U.value=!0},L=()=>{U.value=!1},R=t=>{U.value=!0,t.preventDefault()},C=t=>{if(x.value!==-1)h.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{t.preventDefault();const o=/(\.mov|\.mp4|\.mkv)$/i;U.value=!1;const a=t.dataTransfer;if(a&&a.files){for(const v of a.files)if(!o.exec(v.name)){h.emit("update:alert",{isActive:!0,message:"mp4,mov,mkv 확장자만 지원합니다."});break}T(a.files,"drop")}}},T=(t,o)=>{let a;if(o=="change"?a=t.files:a=t,a!==null)for(let v=0;v<a.length;v++)g.value.push({title:a[v].name,file:a[v]})},j=t=>{g.value.splice(t,1)},E=t=>{if(x.value!==-1)h.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const o=t.target;o&&o.files&&T(o,"change")}},N=()=>{f("update:close")},X=()=>{f("update:abort"),O.abort()},H=()=>{Promise.all([B.get(S.videoList),B.get(S.inferenceModelList)]).then(t=>{f("update:upload",{videoList:t[0].data,inferenceModelList:t[1].data.data.filter(o=>o!==null)}),N()})},n=()=>{if(g.value.length>0){m.value=!0;const t=g.value,o=new FormData;for(let a=0;a<t.length;a++)console.log(t[a].file),o.append("file",t[a].file);B.postForm(S.upload,o,{signal:O.signal,onUploadProgress:a=>{const v=a.loaded*100/a.total;b.value=Number(v.toFixed(0)),v==100&&(m.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(a=>{console.log("output-> result",a),H()})}else h.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(t,o)=>{const a=F("FontAwesomeIcon"),v=F("BaseButton");return p(),y(Q,null,[m.value?(p(),W(oe,{key:0,text:"video file uploading...",progressValue:b.value,"onUpdate:closeProgressModal":X},null,8,["progressValue"])):M("",!0),e("div",Ae,[e("button",{class:"close-btn",onClick:N}),e("div",Se,[e("div",{class:V(["file-upload-area",U.value?"dragged":""]),onDragenter:k,onDragover:R,onDragleave:L,onDrop:C},[e("strong",null,[fe(" Drop Video File here to upload or "),$e,(p(),y("input",{key:d.value,type:"file",id:"file-upload",accept:".mp4, .mov, .mkv",onChange:E,onClick:o[0]||(o[0]=_=>d.value+=1),multiple:""},null,32))])],34),Oe,e("div",Le,[Ee,e("ul",Ue,[(p(!0),y(Q,null,ae($.value,(_,w)=>(p(),y("li",{key:w},[e("img",{onClick:J=>i(w),src:we,class:V(w==x.value?"selected":"")},null,10,Me)]))),128))])]),g.value.length>0?(p(),y("ul",Pe,[(p(!0),y(Q,null,ae(g.value,(_,w)=>(p(),y("li",{key:w},[e("span",Re,se(_.file.name),1),r(a,{icon:"xmark",class:"delete-button",onClick:J=>j(w)},null,8,["onClick"])]))),128))])):M("",!0),x.value!=-1?(p(),y("ul",qe,[e("li",null,se($.value[x.value].name),1)])):M("",!0),e("div",De,[r(v,{text:"Upload",onClick:n})])])])],64)}}});const Te=Y(Fe,[["__scopeId","data-v-a5bf2b61"]]),P=I=>(ie("data-v-40bafccc"),I=I(),de(),I),Ne={class:"upload-area"},Xe=P(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),je={class:"row"},He={class:"row"},Je=P(()=>e("label",{class:"label"},"video File",-1)),Qe={class:"setting-area"},ze=P(()=>e("h2",{class:"h2-title"},"Output Setting",-1)),Ke={class:"row"},We=P(()=>e("label",{class:"label"},"AI Model",-1)),Ge={class:"row"},Ye=P(()=>e("label",{class:"label"},"Format",-1)),Ze={class:"row"},et=P(()=>e("label",{class:"label"},"Encoder",-1)),tt={class:"row check-area"},lt=P(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),at={class:"row check-area"},st={class:"row"},ot=P(()=>e("label",{class:"bitrate"},"AVg.Bitrate : ",-1)),nt=P(()=>e("span",{class:"unit"},"(kbps)",-1)),it={class:"row"},dt=G({__name:"Main",setup(I){const f=z("emitter"),B=s(0),h=z("defaultInstance"),$=s([]),d=s(null),m=s([]),b=s(null),x=[{name:"mp4"},{name:"mov"},{name:"mkv"}],g=s({name:"mp4"}),U=[{name:"H.264"},{name:"H.265"},{name:"ProRes"}],O=s({name:"H.264"}),i=s([]),k=s("VBR"),L=s(!1),R=s(!1),C=s("128"),T=s(0),j=s(!1),E=s(!1),N=s(""),X=s(""),H=s("");let n;const t=u=>{d.value=null,m.value=[],$.value=[],m.value=u.inferenceModelList,$.value=u.videoList},o=()=>{Promise.all([h.get(S.videoList),h.get(S.inferenceModelList)]).then(u=>{$.value=u[0].data,m.value=u[1].data.data.filter(l=>l!==null)})},a=u=>{const l=i.value.indexOf(u);l>=0?i.value.splice(l,1):u=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(u)},v=()=>{d.value==null?f.emit("update:alert",{isActive:!0,message:"Please select a video file."}):b.value==null?f.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(f.emit("update:loading",{isLoading:!0}),h.post(S.videoInference,{videoId:d.value&&d.value.videoId,containerId:b.value.containerId,format:g.value.name,encoder:O.value.name,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?0:C.value,vbr:i.value.indexOf("best quality")>=0?!1:k.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:k.value=="CBR"}).then(u=>{console.log(u),localStorage.setItem("inference",JSON.stringify({uuid:u.data.data,containerId:b.value.containerId})),H.value=u.data.data,J(u.data.data)}))},_=()=>{n.close(),R.value=!1,E.value=!1,ee({containerId:b.value.containerId,uuid:H.value})},w=()=>{f.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{f.emit("update:loading",{isLoading:!0}),_()}})},J=u=>{n=new EventSource(S.connectSSE+`?uuid=${u}`),n.onopen=()=>{console.log(S.connectSSE+`?uuid=${u}----connect`)},n.onmessage=l=>{try{if(typeof JSON.parse(l.data)=="object"){const A=JSON.parse(l.data);console.log(A),A.step=="inference"&&(R.value=!0,f.emit("update:loading",{isLoading:!1}),T.value=A.progress),A.status=="error"&&_(),A.step=="all"&&A.progress==100&&A.result=="true"&&(n.close(),R.value=!1,localStorage.removeItem("inference"),f.emit("update:loading",{isLoading:!0}),N.value="http://172.168.10.91:49090"+S.videoDownload+`?videoId=${d.value&&d.value.videoId}`,X.value="http://172.168.10.91:49090"+S.videoDownload+`?uuid=${u}`,E.value=!0,f.emit("update:loading",{isLoading:!1}))}}catch{}},n.onerror=l=>{console.log(l),_()}},q=u=>(u.preventDefault(),u.stopImmediatePropagation(),""),ee=u=>{f.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요."}),h.delete(S.videoInference+`?containerId=${u.containerId}&uuid=${u.uuid}`).then(l=>{console.log("삭제",l),o(),f.emit("update:loading",{isLoading:!1}),f.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),localStorage.removeItem("inference")})};return me(()=>{window.removeEventListener("beforeunload",q)}),ne(()=>{window.addEventListener("beforeunload",q),o(),localStorage.getItem("inference")!=null&&ee(JSON.parse(localStorage.getItem("inference")))}),(u,l)=>{const A=F("BaseButton"),K=F("BaseSelect"),te=F("BaseCheckBox"),le=F("BaseRadio"),ue=F("BaseInput");return p(),y(Q,null,[R.value?(p(),W(oe,{key:0,text:"Inference is in progress...",progressValue:T.value,"onUpdate:closeProgressModal":w},null,8,["progressValue"])):M("",!0),e("main",null,[L.value?(p(),W(ge,{key:0,to:"#teleport-upload-modal"},[(p(),W(Te,{key:B.value,"onUpdate:close":l[0]||(l[0]=c=>L.value=!1),"onUpdate:upload":l[1]||(l[1]=c=>t(c)),"onUpdate:abort":l[2]||(l[2]=c=>B.value+=1)}))])):M("",!0),e("aside",null,[e("section",Ne,[Xe,e("div",je,[r(A,{onClick:l[3]||(l[3]=c=>L.value=!0),text:"Upload Video"})]),e("div",He,[Je,r(K,{"onUpdate:selectBox":l[4]||(l[4]=c=>{j.value=!0,d.value=c}),name:"fileName",options:$.value,text:d.value==null?"<span class=not-selected>Please Upload Video Files</span>":d.value.fileName},null,8,["options","text"])])]),e("section",Qe,[ze,e("div",Ke,[We,r(K,{"onUpdate:selectBox":l[5]||(l[5]=c=>{b.value=c}),options:m.value,name:"projectName,modelName",text:b.value==null?"<span class=not-selected>Select AI Model</span>":b.value.projectName+"/"+b.value.modelName},null,8,["options","text"])]),e("div",Ge,[Ye,r(K,{"onUpdate:selectBox":l[6]||(l[6]=c=>g.value=c),options:x,name:"name",text:g.value.name},null,8,["text"])]),e("div",Ze,[et,r(K,{"onUpdate:selectBox":l[7]||(l[7]=c=>O.value=c),options:U,name:"name",text:O.value.name},null,8,["text"])]),e("div",tt,[e("div",null,[r(te,{"onUpdate:checkModelValue":a,id:"BestQuality",value:"best quality"}),lt]),e("div",null,[e("span",{class:V(["check-box",i.value.indexOf("best quality")<0?"active":"inActive"])},[r(te,{"onUpdate:checkModelValue":a,id:i.value.indexOf("best quality")<0?"2PassEncoding":"",value:"2-Pass Encoding"},null,8,["id"])],2),e("label",{for:"2PassEncoding",class:V(i.value.indexOf("best quality")<0?"active":"inActive")},"2-Pass Encoding",2)])]),e("div",at,[e("div",null,[r(le,{class:V(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[l[8]||(l[8]=c=>k.value=c),l[9]||(l[9]=c=>k.value=c)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:k.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:V(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[r(le,{class:V(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[l[10]||(l[10]=c=>k.value=c),l[11]||(l[11]=c=>k.value=c)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:k.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:V(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",st,[ot,r(ue,{"onUpdate:modelValue":l[12]||(l[12]=c=>C.value=c),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?0:C.value,class:V(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),nt]),e("div",it,[r(A,{text:"Preview",class:V(d.value==null||b.value==null?"inActive":"active"),onClick:v},null,8,["class"])])])]),r(Ce,{isUploaded:j.value,isInferred:E.value,originalVideoSrc:N.value,inferredVideoSrc:X.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const vt=Y(dt,[["__scopeId","data-v-40bafccc"]]);export{vt as default};
