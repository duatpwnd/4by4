import{P as Z}from"./ProgressModal-e4167bbe.js";import{d as z,r as n,i as H,w as oe,o as ee,f as q,g as _,j as r,x as P,h as e,y as x,k as E,z as ae,T as ne,F as X,A as ie,n as v,C as de,_ as K,t as Q,D as ue,E as Y,G as J,p as te,m as le,H as ce}from"./index-bb016b7a.js";import{s as U}from"./services-39e6a1b0.js";const re={id:"teleport-upload-modal",class:"contents"},ve={class:"title-area"},pe={class:"original"},fe={class:"pixell-ai"},me=["src"],_e=["src"],ge={key:0,class:"timeline-area"},be={class:"video-menu-area"},ye=z({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(k){const $=k,V=n(null),b=n(null),C=n(null),d=n(null),p=n(null),g=n(null),y=n(!1),f=n(!1),O=H("signOut"),w=n(!1),i=n(null),{isUploaded:h,isInferred:I,originalVideoSrc:M,inferredVideoSrc:D}=oe($),F=()=>{const u="test.mp4".split(".").pop();i.value!==null&&clearTimeout(i.value),window.navigator.clipboard.writeText("copy").then(()=>{ie.get("",{responseType:"blob"}).then(o=>{console.log(o)});const l=new Blob([""],{type:`video/${u}`}),s=document.createElement("a");s.href=URL.createObjectURL(l),s.download="test",s.click(),URL.revokeObjectURL(s.href),w.value=!0,i.value=setTimeout(()=>{w.value=!1},2e3)})},T=u=>{const l=V.value;let s=!1;document.onmouseup=()=>{s=!1,f.value=!1};const o=()=>{s=!0,f.value=!0},a=m=>{if(s&&l!==null){const R=l.getBoundingClientRect();if("pageX"in m){const S=(m.pageX-R.left)/l.offsetWidth*100;S<100&&S>0?u.style.left=S+"%":S<=0?u.style.left="0px":S>=100&&(u.style.left="100%")}}},t=()=>{s=!1,f.value=!1};u.onmousedown=o,u.onmouseup=t,l!==null&&(l.onmousemove=a,l.onmouseout=a)},A=u=>{if(f.value){const l=V.value,s=C.value,o=p.value;if(l!==null){const a=l.getBoundingClientRect();if("pageX"in u){const t=(u.pageX-a.left)/l.offsetWidth*100;t<100&&t>0?(s.style.width=t+"%",o.style.width=100/t*100+"%",o.style.zIndex="3"):t<=0?(s.style.width="0",o.style.width="0"):t>=100&&(s.style.width="100%",o.style.width="100%")}}}},B=()=>{d.value!==null&&p.value!==null&&(d.value.paused?(d.value.play(),p.value.play(),y.value=!0):(d.value.pause(),p.value.pause(),y.value=!1))},N=u=>{d.value!==null&&p.value!==null&&(u=="forward"?(p.value.currentTime+=10,d.value.currentTime+=10):(p.value.currentTime-=10,d.value.currentTime-=10))},j=()=>{y.value=!1};return ee(()=>{const u=V.value,l=g.value;l!==null&&u!==null&&(T(l),u.addEventListener("mousemove",A,!1),u.addEventListener("mouseout",A,!1),u.addEventListener("touchstart",A,!1),u.addEventListener("touchmove",A,!1)),d.value!==null&&(d.value.addEventListener("ended",j,!1),d.value.addEventListener("timeupdate",s=>{},!1),d.value.addEventListener("seeking",s=>{d.value!==null&&console.log(Math.floor(d.value.currentTime))},!1))}),(u,l)=>{const s=q("FontAwesomeIcon");return v(),_(X,null,[r(s,{icon:"right-from-bracket",class:"sign-out-button",onClick:P(O)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:V},[e("div",re,[e("div",ve,[e("div",pe,[e("strong",{class:x(P(h)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",fe,[e("strong",{class:x(P(I)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:b},[P(I)?(v(),_("button",{key:0,ref_key:"draggableButton",ref:g,class:"drag-btn"},null,512)):E("",!0),e("video",{ref_key:"originalVideo",ref:d},[e("source",{src:P(M)},null,8,me)],512),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:C},[e("video",{ref_key:"inferenceVideo",ref:p},[e("source",{src:P(D)},null,8,_e)],512)],512),P(I)?(v(),_("button",{key:1,class:"share-btn",onClick:F},[r(ne,{name:"fade",mode:"out-in"},{default:ae(()=>[w.value?(v(),_("span",{key:0,class:"copy-text",onClick:l[0]||(l[0]=de(()=>{},["stop"]))},"copied.")):E("",!0)]),_:1})])):E("",!0)],512),P(I)?(v(),_("div",ge,[e("div",be,[r(s,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:l[1]||(l[1]=o=>N("backward"))}),r(s,{icon:"circle-play",class:"fa-3x play-button",onClick:B}),r(s,{icon:"play",class:"fa-3x next-button",onClick:l[2]||(l[2]=o=>N("forward"))})])])):E("",!0)])],512)],64)}}});const he=K(ye,[["__scopeId","data-v-e12fa026"]]),xe="http://222.107.124.161:64000/assets/sample_video_img-8e9d2f79.png",W=k=>(te("data-v-a5bf2b61"),k=k(),le(),k),ke={class:"upload-modal-container"},Ve={class:"contents"},Be=W(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),Ce=W(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),we={class:"sample-video-area"},Ie=W(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),Ae={class:"sample-video-list"},Ue=["onClick"],$e={key:0,class:"file-name-area"},Oe={class:"file-name"},Ee={key:1,class:"file-name-area"},Le={class:"upload-btn-area"},Me=z({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(k,{emit:$}){const V=H("defaultInstance"),b=H("emitter"),C=n([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),d=n(0),p=n(!1),g=n(0),y=n(-1),f=n([]),O=n(!1),w=new AbortController,i=l=>{f.value.length>0?b.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):y.value=l},h=()=>{O.value=!0},I=()=>{O.value=!1},M=l=>{O.value=!0,l.preventDefault()},D=l=>{if(y.value!==-1)b.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{l.preventDefault();const s=/(\.mov|\.mp4|\.mkv)$/i;O.value=!1;const o=l.dataTransfer;if(o&&o.files){for(const a of o.files)if(!s.exec(a.name)){b.emit("update:alert",{isActive:!0,message:"mp4,mov,mkv 확장자만 지원합니다."});break}F(o.files,"drop")}}},F=(l,s)=>{let o;if(s=="change"?o=l.files:o=l,o!==null)for(let a=0;a<o.length;a++)f.value.push({title:o[a].name,file:o[a]})},T=l=>{f.value.splice(l,1)},A=l=>{if(y.value!==-1)b.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const s=l.target;s&&s.files&&F(s,"change")}},B=()=>{$("update:close")},N=()=>{$("update:abort"),w.abort()},j=()=>{Promise.all([V.get(U.videoList),V.get(U.inferenceModelList)]).then(l=>{$("update:upload",{videoList:l[0].data,inferenceModelList:l[1].data.data.filter(s=>s!==null)}),B()})},u=()=>{if(f.value.length>0){p.value=!0;const l=f.value,s=new FormData;for(let o=0;o<l.length;o++)console.log(l[o].file),s.append("file",l[o].file);V.postForm(U.upload,s,{signal:w.signal,onUploadProgress:o=>{const a=o.loaded*100/o.total;g.value=Number(a.toFixed(0)),a==100&&(p.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(o=>{console.log("output-> result",o),j()})}else b.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(l,s)=>{const o=q("FontAwesomeIcon"),a=q("BaseButton");return v(),_(X,null,[p.value?(v(),Q(Z,{key:0,text:"video file uploading...",progressValue:g.value,"onUpdate:closeProgressModal":N},null,8,["progressValue"])):E("",!0),e("div",ke,[e("button",{class:"close-btn",onClick:B}),e("div",Ve,[e("div",{class:x(["file-upload-area",O.value?"dragged":""]),onDragenter:h,onDragover:M,onDragleave:I,onDrop:D},[e("strong",null,[ue(" Drop Video File here to upload or "),Be,(v(),_("input",{key:d.value,type:"file",id:"file-upload",accept:".mp4, .mov, .mkv",onChange:A,onClick:s[0]||(s[0]=t=>d.value+=1),multiple:""},null,32))])],34),Ce,e("div",we,[Ie,e("ul",Ae,[(v(!0),_(X,null,Y(C.value,(t,m)=>(v(),_("li",{key:m},[e("img",{onClick:R=>i(m),src:xe,class:x(m==y.value?"selected":"")},null,10,Ue)]))),128))])]),f.value.length>0?(v(),_("ul",$e,[(v(!0),_(X,null,Y(f.value,(t,m)=>(v(),_("li",{key:m},[e("span",Oe,J(t.file.name),1),r(o,{icon:"xmark",class:"delete-button",onClick:R=>T(m)},null,8,["onClick"])]))),128))])):E("",!0),y.value!=-1?(v(),_("ul",Ee,[e("li",null,J(C.value[y.value].name),1)])):E("",!0),e("div",Le,[r(a,{text:"Upload",onClick:u})])])])],64)}}});const Re=K(Me,[["__scopeId","data-v-a5bf2b61"]]),L=k=>(te("data-v-b3e44fdd"),k=k(),le(),k),Se={class:"upload-area"},Pe=L(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),qe={class:"row"},De={class:"row"},Fe=L(()=>e("label",{class:"label"},"video File",-1)),Te={class:"setting-area"},Ne=L(()=>e("h2",{class:"h2-title"},"Output Setting",-1)),je={class:"row"},Xe=L(()=>e("label",{class:"label"},"AI Model",-1)),He={class:"row"},Qe=L(()=>e("label",{class:"label"},"Format",-1)),ze={class:"row"},Ke=L(()=>e("label",{class:"label"},"Encoder",-1)),We={class:"row check-area"},Ge=L(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),Ye={class:"row check-area"},Je={class:"row"},Ze=L(()=>e("label",{class:"bitrate"},"AVg.Bitrate : ",-1)),et=L(()=>e("span",{class:"unit"},"(kbps)",-1)),tt={class:"row"},lt=z({__name:"Main",setup(k){const $=H("emitter"),V=n(0),b=H("defaultInstance"),C=n([]),d=n(null),p=n([]),g=n(null),y=[{name:"mp4"},{name:"mov"},{name:"mkv"}],f=n({name:"mp4"}),O=[{name:"H.264"},{name:"H.265"},{name:"ProRes"}],w=n({name:"H.264"}),i=n([]),h=n("VBR"),I=n(!1),M=n(!1),D=n("128"),F=n(0),T=n(!1),A=n(!1);let B;const N=a=>{d.value=null,p.value=[],C.value=[],p.value=a.inferenceModelList,C.value=a.videoList},j=()=>{Promise.all([b.get(U.videoList),b.get(U.inferenceModelList)]).then(a=>{C.value=a[0].data,p.value=a[1].data.data.filter(t=>t!==null)})},u=a=>{const t=i.value.indexOf(a);t>=0?i.value.splice(t,1):a=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(a)},l=()=>{d.value==null?$.emit("update:alert",{isActive:!0,message:"Please select a video file."}):g.value==null?$.emit("update:alert",{isActive:!0,message:"Please select ai model."}):b.post(U.videoInference,{videoId:d.value&&d.value.videoId,containerId:g.value.containerId,format:f.value.name,encoder:w.value.name,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?0:D.value,vbr:i.value.indexOf("best quality")>=0?!1:h.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:h.value=="CBR"}).then(a=>{console.log(a),o(a.data)})},s=()=>{$.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{B.close(),M.value=!1,A.value=!1,console.log(U.connectSSE+"----closed")}})},o=a=>{B=new EventSource(U.connectSSE+`?uuid=${a}`),B.onopen=()=>{M.value=!0,console.log(U.connectSSE+`?uuid=${a}----connect`)},B.onmessage=t=>{console.log(t),F.value=t.data.progress,t.data.progress==100&&(B.close(),A.value=!0,M.value=!1,b.get(U.videoDownload+"?path=$").then(m=>{console.log("video download",m)}))},B.onerror=t=>{console.log(t)}};return ee(()=>{j()}),(a,t)=>{const m=q("BaseButton"),R=q("BaseSelect"),S=q("BaseCheckBox"),G=q("BaseRadio"),se=q("BaseInput");return v(),_(X,null,[M.value?(v(),Q(Z,{key:0,text:"Inference is in progress...",progressValue:F.value,"onUpdate:closeProgressModal":s},null,8,["progressValue"])):E("",!0),e("main",null,[I.value?(v(),Q(ce,{key:0,to:"#teleport-upload-modal"},[(v(),Q(Re,{key:V.value,"onUpdate:close":t[0]||(t[0]=c=>I.value=!1),"onUpdate:upload":t[1]||(t[1]=c=>N(c)),"onUpdate:abort":t[2]||(t[2]=c=>V.value+=1)}))])):E("",!0),e("aside",null,[e("section",Se,[Pe,e("div",qe,[r(m,{onClick:t[3]||(t[3]=c=>I.value=!0),text:"Upload Video"})]),e("div",De,[Fe,r(R,{"onUpdate:selectBox":t[4]||(t[4]=c=>{T.value=!0,d.value=c}),name:"fileName",options:C.value,text:d.value==null?"<span class=not-selected>Please Upload Video Files</span>":d.value.fileName},null,8,["options","text"])])]),e("section",Te,[Ne,e("div",je,[Xe,r(R,{"onUpdate:selectBox":t[5]||(t[5]=c=>{g.value=c}),options:p.value,name:"projectName,modelName",text:g.value==null?"<span class=not-selected>Select AI Model</span>":g.value.projectName+"/"+g.value.modelName},null,8,["options","text"])]),e("div",He,[Qe,r(R,{"onUpdate:selectBox":t[6]||(t[6]=c=>f.value=c),options:y,name:"name",text:f.value.name},null,8,["text"])]),e("div",ze,[Ke,r(R,{"onUpdate:selectBox":t[7]||(t[7]=c=>w.value=c),options:O,name:"name",text:w.value.name},null,8,["text"])]),e("div",We,[e("div",null,[r(S,{"onUpdate:checkModelValue":u,id:"BestQuality",value:"best quality"}),Ge]),e("div",null,[e("span",{class:x(["check-box",i.value.indexOf("best quality")<0?"active":"inActive"])},[r(S,{"onUpdate:checkModelValue":u,id:i.value.indexOf("best quality")<0?"2PassEncoding":"",value:"2-Pass Encoding"},null,8,["id"])],2),e("label",{for:"2PassEncoding",class:x(i.value.indexOf("best quality")<0?"active":"inActive")},"2-Pass Encoding",2)])]),e("div",Ye,[e("div",null,[r(G,{class:x(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[t[8]||(t[8]=c=>h.value=c),t[9]||(t[9]=c=>h.value=c)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:h.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:x(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[r(G,{class:x(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[t[10]||(t[10]=c=>h.value=c),t[11]||(t[11]=c=>h.value=c)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:h.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:x(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",Je,[Ze,r(se,{"onUpdate:modelValue":t[12]||(t[12]=c=>D.value=c),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?0:D.value,class:x(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),et]),e("div",tt,[r(m,{text:"Preview",class:x(d.value==null||g.value==null?"inActive":"active"),onClick:l},null,8,["class"])])])]),r(he,{isUploaded:T.value,isInferred:A.value,originalVideoSrc:"",inferredVideoSrc:""},null,8,["isUploaded","isInferred"])])],64)}}});const nt=K(lt,[["__scopeId","data-v-b3e44fdd"]]);export{nt as default};
