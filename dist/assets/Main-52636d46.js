import{d as ae,r as a,i as K,w as Ce,o as de,f as E,g as _,j as f,x as N,h as e,y as O,z as re,A as we,C as ce,T as Be,k as q,F as J,n as c,D as ve,_ as se,t as Z,E as pe,G as ee,H as W,p as fe,m as me,I as Ae,J as Se,K as Le,L as $e}from"./index-81176348.js";import{P as _e}from"./ProgressModal-5bc93678.js";import{s as P}from"./services-5a74fb2b.js";const Oe={id:"teleport-upload-modal",class:"contents"},Me={class:"title-area"},Ue={class:"original"},Ee={class:"pixell-ai"},Pe=["src"],Re=["src"],De={key:0,class:"timeline-area"},Fe={class:"video-menu-area"},Ne=ae({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(B){const v=B,A=a(null),k=a(null),x=a(null),u=a(null),g=a(null),b=a(null),I=a(!1),p=a(!1),S=K("signOut"),i=a(!1),h=a(null),{isUploaded:T,isInferred:C,originalVideoSrc:H,inferredVideoSrc:L}=Ce(v),X=()=>{L.value.split(".").pop(),h.value!==null&&clearTimeout(h.value),console.log(L.value),window.navigator.clipboard.writeText(L.value).then(()=>{const d=document.createElement("a");d.href=L.value,d.download=L.value,d.click(),i.value=!0,h.value=setTimeout(()=>{i.value=!1},2e3)})},D=d=>{const t=A.value;console.log(t);let s=!1;document.onmouseup=()=>{s=!1,p.value=!1};const l=()=>{s=!0,p.value=!0},m=V=>{if(s&&t!==null){const M=t.getBoundingClientRect();if("pageX"in V){const U=(V.pageX-M.left)/t.offsetWidth*100;U<100&&U>0?d.style.left=U+"%":U<=0?d.style.left="0px":U>=100&&(d.style.left="100%")}}},y=()=>{s=!1,p.value=!1};d.onmousedown=l,d.onmouseup=y,t!==null&&(t.onmousemove=m,t.onmouseout=m)},$=d=>{if(p.value){const t=A.value,s=x.value,l=g.value;if(t!==null){const m=t.getBoundingClientRect();if("pageX"in d){const y=(d.pageX-m.left)/t.offsetWidth*100;y<100&&y>0?(s.style.width=y+"%",l.style.width=100/y*100+"%",l.style.zIndex="3"):y<=0?(s.style.width="0",l.style.width="0"):y>=100&&(s.style.width="100%",l.style.width="100%")}}}},F=()=>{u.value!==null&&g.value!==null&&(u.value.paused?(u.value.play(),g.value.play(),I.value=!0):(u.value.pause(),g.value.pause(),I.value=!1))},z=d=>{u.value!==null&&g.value!==null&&(d=="forward"?(g.value.currentTime+=10,u.value.currentTime+=10):(g.value.currentTime-=10,u.value.currentTime-=10))},j=()=>{I.value=!1};return de(()=>{const d=A.value,t=b.value;t!==null&&d!==null&&(D(t),d.addEventListener("mousemove",$,!1),d.addEventListener("mouseout",$,!1),d.addEventListener("touchstart",$,!1),d.addEventListener("touchmove",$,!1)),u.value!==null&&(u.value.addEventListener("ended",j,!1),u.value.addEventListener("timeupdate",s=>{},!1),u.value.addEventListener("seeking",s=>{u.value!==null&&console.log(Math.floor(u.value.currentTime))},!1))}),(d,t)=>{const s=E("FontAwesomeIcon");return c(),_(J,null,[f(s,{icon:"right-from-bracket",class:"sign-out-button",onClick:N(S)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:A},[e("div",Oe,[e("div",Me,[e("div",Ue,[e("strong",{class:O(N(T)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",Ee,[e("strong",{class:O(N(C)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:k},[re(e("button",{ref_key:"draggableButton",ref:b,class:"drag-btn"},null,512),[[we,N(C)]]),e("video",{ref_key:"originalVideo",ref:u,src:N(H)},null,8,Pe),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:x},[e("video",{ref_key:"inferenceVideo",ref:g,src:N(L)},null,8,Re)],512),N(C)?(c(),_("button",{key:0,class:"share-btn",onClick:X},[f(Be,{name:"fade",mode:"out-in"},{default:ce(()=>[i.value?(c(),_("span",{key:0,class:"copy-text",onClick:t[0]||(t[0]=ve(()=>{},["stop"]))},"download and copy")):q("",!0)]),_:1})])):q("",!0)],512),N(C)?(c(),_("div",De,[e("div",Fe,[f(s,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:t[1]||(t[1]=l=>z("backward"))}),f(s,{icon:"circle-play",class:"fa-3x play-button",onClick:F}),f(s,{icon:"play",class:"fa-3x next-button",onClick:t[2]||(t[2]=l=>z("forward"))})])])):q("",!0)])],512)],64)}}});const qe=se(Ne,[["__scopeId","data-v-aaf53aee"]]),Te="http://222.107.124.161:64000/assets/sample_video_img-8e9d2f79.png",oe=B=>(fe("data-v-e55f1bc4"),B=B(),me(),B),He={class:"upload-modal-container"},Xe={class:"contents"},ze=oe(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),Je=oe(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),je={class:"sample-video-area"},Qe=oe(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),We={class:"sample-video-list"},Ke=["onClick"],Ge={key:0,class:"file-name-area"},Ye={class:"file-name"},Ze={key:1,class:"file-name-area"},et={class:"upload-btn-area"},tt=ae({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(B,{emit:v}){const A=K("defaultInstance"),k=K("emitter"),x=a([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),u=a(0),g=a(!1),b=a(0),I=a(-1),p=a([]),S=a(!1),i=new AbortController,h=t=>{p.value.length>0?k.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):I.value=t},T=()=>{S.value=!0},C=()=>{S.value=!1},H=t=>{S.value=!0,t.preventDefault()},L=t=>{if(I.value!==-1)k.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{t.preventDefault();const s=/(\.mov|\.mp4|\.mkv)$/i;S.value=!1;const l=t.dataTransfer;if(l&&l.files){for(const m of l.files)if(!s.exec(m.name)){k.emit("update:alert",{isActive:!0,message:"mp4,mov,mkv 확장자만 지원합니다."});break}X(l.files,"drop")}}},X=(t,s)=>{let l;if(s=="change"?l=t.files:l=t,l!==null)for(let m=0;m<l.length;m++){p.value.push({title:l[m].name,file:l[m]});const y=p.value.filter((V,M,U)=>M===U.findIndex(te=>te.title===V.title));p.value=y}},D=t=>{p.value.splice(t,1)},$=t=>{if(I.value!==-1)k.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const s=t.target;s&&s.files&&X(s,"change")}},F=()=>{v("update:close")},z=()=>{v("update:abort"),i.abort()},j=()=>{Promise.all([A.get(P.videoList),A.get(P.inferenceModelList)]).then(t=>{v("update:upload",{videoList:t[0].data,inferenceModelList:t[1].data.data.filter(s=>s!==null)}),F()})},d=()=>{if(p.value.length>0){g.value=!0;const t=p.value,s=new FormData;for(let l=0;l<t.length;l++)console.log(t[l].file),s.append("file",t[l].file);A.postForm(P.upload,s,{signal:i.signal,onUploadProgress:l=>{const m=l.loaded*100/l.total;b.value=Number(m.toFixed(0)),m==100&&(g.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(l=>{console.log("output-> result",l),j()})}else k.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(t,s)=>{const l=E("FontAwesomeIcon"),m=E("BaseButton");return c(),_(J,null,[g.value?(c(),Z(_e,{key:0,text:"video file uploading...",progressValue:b.value,"onUpdate:closeProgressModal":z},null,8,["progressValue"])):q("",!0),e("div",He,[e("button",{class:"close-btn",onClick:F}),e("div",Xe,[e("div",{class:O(["file-upload-area",S.value?"dragged":""]),onDragenter:T,onDragover:H,onDragleave:C,onDrop:L},[e("strong",null,[pe(" Drop Video File here to upload or "),ze,(c(),_("input",{key:u.value,type:"file",id:"file-upload",accept:".mp4, .mov, .mkv",onChange:$,onClick:s[0]||(s[0]=y=>u.value+=1),multiple:""},null,32))])],34),Je,e("div",je,[Qe,e("ul",We,[(c(!0),_(J,null,ee(x.value,(y,V)=>(c(),_("li",{key:V},[e("img",{onClick:M=>h(V),src:Te,class:O(V==I.value?"selected":"")},null,10,Ke)]))),128))])]),p.value.length>0?(c(),_("ul",Ge,[(c(!0),_(J,null,ee(p.value,(y,V)=>(c(),_("li",{key:V},[e("span",Ye,W(y.file.name),1),f(l,{icon:"xmark",class:"delete-button",onClick:M=>D(V)},null,8,["onClick"])]))),128))])):q("",!0),I.value!=-1?(c(),_("ul",Ze,[e("li",null,W(x.value[I.value].name),1)])):q("",!0),e("div",et,[f(m,{text:"Upload",onClick:d})])])])],64)}}});const lt=se(tt,[["__scopeId","data-v-e55f1bc4"]]),R=B=>(fe("data-v-c35a7c16"),B=B(),me(),B),at={class:"upload-area"},st=R(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),ot={class:"row"},nt={class:"row video-file-select-area"},it=R(()=>e("label",{class:"label"},"Video File",-1)),ut={class:"date"},dt=["onClick","onMouseenter"],rt={class:"file-size"},ct={class:"setting-area"},vt=R(()=>e("h2",{class:"h2-title"},"Output Settings",-1)),pt={class:"row"},ft=R(()=>e("label",{class:"label"},"AI Model",-1)),mt={class:"row"},_t=R(()=>e("label",{class:"label"},"Format",-1)),gt={class:"row"},yt=R(()=>e("label",{class:"label"},"Encoder",-1)),bt={class:"row check-area"},ht=R(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),kt={class:"row check-area"},Vt={class:"row"},xt=R(()=>e("label",{class:"bitrate"},"Bitrate : ",-1)),It=R(()=>e("span",{class:"unit"},"(kbps)",-1)),Ct={class:"row"},wt=ae({__name:"Main",setup(B){const v=K("emitter"),A=a(0),k=K("defaultInstance"),x=a([]),u=a(null),g=a([]),b=a(null),I=[{name:"mp4"},{name:"mov"},{name:"mkv"}],p=a({name:"mp4"}),S=a({name:"H.264",value:"H.264"}),i=a([]),h=a("VBR"),T=a(!1),C=a(!1),H=a("1000"),L=a(0),X=a(!1),D=a(!1),$=a(""),F=a(""),z=a(""),j=a(""),d=Ae(()=>{const n=[{name:"H.264",value:"H.264"},{name:"H.265",value:"H.265"},{name:"ProRes(Unable to play video)",value:"ProRes"}];return(p.value.name=="mp4"||p.value.name=="mov")&&(n[2].disabled=!0),n}),t=a(-1),s=a(null);let l;const m=n=>{x.value.length==0&&(v.emit("update:alert",{isActive:!0,message:"Please upload your video files."}),n.stopPropagation())},y=n=>{u.value=null,g.value=[],x.value=[],g.value=n.inferenceModelList,x.value=n.videoList},V=n=>{v.emit("update:alert",{isActive:!0,message:"삭제하시겠습니까?",fn:()=>{v.emit("update:loading",{isLoading:!0}),k.delete(P.video+`?videoId=${n}`).then(o=>{v.emit("update:loading",{isLoading:!1}),M()})}})},M=()=>{Promise.all([k.get(P.videoList),k.get(P.inferenceModelList)]).then(n=>{x.value=n[0].data,g.value=n[1].data.data.filter(o=>o!==null)})},U=n=>{const o=i.value.indexOf(n);o>=0?i.value.splice(o,1):n=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(n)},te=()=>{u.value==null?v.emit("update:alert",{isActive:!0,message:"Please select a video file."}):b.value==null?v.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(D.value=!1,$.value="",F.value="",v.emit("update:loading",{isLoading:!0}),k.post(P.videoInference,{videoId:u.value&&u.value.videoId,containerId:b.value.containerId,format:p.value.name,encoder:S.value.value,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?"1000":H.value,vbr:i.value.indexOf("best quality")>=0?!1:h.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:h.value=="CBR"}).then(n=>{sessionStorage.setItem("inference",JSON.stringify({uuid:n.data.data,containerId:b.value.containerId})),z.value=n.data.data,ye(n.data.data)}))},le=()=>{l.close(),C.value=!1,D.value=!1,ie({containerId:b.value.containerId,uuid:z.value})},ge=()=>{v.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{v.emit("update:loading",{isLoading:!0}),le()}})},ye=n=>{l=new EventSource(P.connectSSE+`?uuid=${n}`),l.onopen=()=>{v.emit("update:loading",{isLoading:!1})},l.onmessage=o=>{try{if(typeof JSON.parse(o.data)=="object"){const w=JSON.parse(o.data);j.value=w.step,L.value=w.progress,C.value=!0,w.status=="error"&&le(),w.step=="all"&&w.progress==100&&w.result=="true"&&(l.close(),C.value=!1,sessionStorage.removeItem("inference"),v.emit("update:loading",{isLoading:!0}),$.value=w.originalVideo,F.value=w.inferenceVideo,D.value=!0,v.emit("update:loading",{isLoading:!1}))}}catch{}},l.onerror=o=>{console.log(o),le()}},ne=n=>{if(C.value)return n.preventDefault(),n.stopImmediatePropagation(),""},ie=n=>{v.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요."}),k.delete(P.videoInference+`?containerId=${n.containerId}&uuid=${n.uuid}`).then(o=>{M(),v.emit("update:loading",{isLoading:!1}),v.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),sessionStorage.removeItem("inference")})};return Se(()=>{window.removeEventListener("beforeunload",ne)}),de(()=>{window.addEventListener("beforeunload",ne),M(),sessionStorage.getItem("inference")!=null&&ie(JSON.parse(sessionStorage.getItem("inference")))}),(n,o)=>{const w=E("BaseButton"),be=E("FontAwesomeIcon"),G=E("BaseSelect"),he=E("BaseCheckBox"),ue=E("BaseRadio"),ke=E("BaseInput"),Ve=Le("tooltip");return c(),_(J,null,[C.value?(c(),Z(_e,{key:0,text:j.value+" in_progress...",progressValue:L.value,"onUpdate:closeProgressModal":ge},null,8,["text","progressValue"])):q("",!0),e("main",null,[T.value?(c(),Z($e,{key:0,to:"#teleport-upload-modal"},[(c(),Z(lt,{key:A.value,"onUpdate:close":o[0]||(o[0]=r=>T.value=!1),"onUpdate:upload":o[1]||(o[1]=r=>y(r)),"onUpdate:abort":o[2]||(o[2]=r=>A.value+=1)}))])):q("",!0),e("aside",null,[e("section",at,[st,e("div",ot,[f(w,{onClick:o[3]||(o[3]=r=>T.value=!0),text:"Upload Video"})]),e("div",nt,[it,f(G,{onClick:m,name:"fileName",options:x.value,text:u.value==null?"<span class=not-selected>Please Upload Video Files</span>":u.value.fileName},{list:ce(()=>[(c(!0),_(J,null,ee(x.value,(r,xe)=>(c(),_("li",{class:"optionItem",key:xe},[e("span",ut,W(r.date),1),(c(!0),_(J,null,ee(r.video,(Q,Y)=>(c(),_("div",{class:"file-name-area",onClick:Ie=>{X.value=!0,u.value=Q},onMouseenter:()=>{s.value&&s.value[Y].offsetWidth<s.value[Y].scrollWidth&&(t.value=Y)}},[re((c(),_("span",{class:"file-name",ref_for:!0,ref_key:"fileName",ref:s},[pe(W(Q.fileName),1)])),[[Ve,{content:t.value==Y?Q.fileName:"",placement:"bottom",delay:0}]]),e("span",null,[e("span",rt,W(Q.fileSize),1),f(be,{icon:"xmark",class:"delete-button",onClick:ve(Ie=>V(Q.videoId),["stop"])},null,8,["onClick"])])],40,dt))),256))]))),128))]),_:1},8,["options","text"])])]),e("section",ct,[vt,e("div",pt,[ft,f(G,{"onUpdate:selectBox":o[4]||(o[4]=r=>{b.value=r}),options:g.value,name:"projectName,modelName",text:b.value==null?"<span class=not-selected>Select AI Model</span>":b.value.projectName+"/"+b.value.modelName},null,8,["options","text"])]),e("div",mt,[_t,f(G,{"onUpdate:selectBox":o[5]||(o[5]=r=>p.value=r),options:I,name:"name",text:p.value.name},null,8,["text"])]),e("div",gt,[yt,f(G,{"onUpdate:selectBox":o[6]||(o[6]=r=>S.value=r),options:d.value,name:"name",text:S.value.name},null,8,["options","text"])]),e("div",bt,[e("div",null,[f(he,{"onUpdate:checkModelValue":U,id:"BestQuality",value:"best quality"}),ht])]),e("div",kt,[e("div",null,[f(ue,{class:O(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[o[7]||(o[7]=r=>h.value=r),o[8]||(o[8]=r=>h.value=r)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:h.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:O(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[f(ue,{class:O(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[o[9]||(o[9]=r=>h.value=r),o[10]||(o[10]=r=>h.value=r)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:h.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:O(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",Vt,[xt,f(ke,{"onUpdate:modelValue":o[11]||(o[11]=r=>H.value=r),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?1e3:H.value,class:O(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),It]),e("div",Ct,[f(w,{text:"Preview",class:O(u.value==null||b.value==null?"inActive":"active"),onClick:te},null,8,["class"])])])]),f(qe,{isUploaded:X.value,isInferred:D.value,originalVideoSrc:$.value,inferredVideoSrc:F.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const Lt=se(wt,[["__scopeId","data-v-c35a7c16"]]);export{Lt as default};
