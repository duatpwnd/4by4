import{P as ne}from"./ProgressModal-811429d5.js";import{d as Z,r as a,i as z,w as fe,o as ie,f as E,g as b,j as r,x as q,h as e,y as U,z as me,A as _e,C as de,T as ge,k as N,F as H,n as v,D as be,_ as ee,t as W,E as ye,G,H as Y,p as ue,m as ce,I as he,J as ke,K as xe}from"./index-bd17afd0.js";import{s as A}from"./services-3e2e4a22.js";const Ie={id:"teleport-upload-modal",class:"contents"},Ve={class:"title-area"},we={class:"original"},Ce={class:"pixell-ai"},Be=["src"],Se=["src"],Ae={key:0,class:"timeline-area"},$e={class:"video-menu-area"},Le=Z({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(w){const f=w,C=a(null),k=a(null),B=a(null),n=a(null),m=a(null),g=a(null),x=a(!1),_=a(!1),M=z("signOut"),$=a(!1),i=a(null),{isUploaded:I,isInferred:L,originalVideoSrc:P,inferredVideoSrc:V}=fe(f),T=()=>{V.value.split(".").pop(),i.value!==null&&clearTimeout(i.value),console.log(V.value),window.navigator.clipboard.writeText(V.value).then(()=>{const d=document.createElement("a");d.href=V.value,d.download=V.value,d.click(),$.value=!0,i.value=setTimeout(()=>{$.value=!1},2e3)})},J=d=>{const t=C.value;console.log(t);let o=!1;document.onmouseup=()=>{o=!1,_.value=!1};const s=()=>{o=!0,_.value=!0},p=h=>{if(o&&t!==null){const Q=t.getBoundingClientRect();if("pageX"in h){const X=(h.pageX-Q.left)/t.offsetWidth*100;X<100&&X>0?d.style.left=X+"%":X<=0?d.style.left="0px":X>=100&&(d.style.left="100%")}}},y=()=>{o=!1,_.value=!1};d.onmousedown=s,d.onmouseup=y,t!==null&&(t.onmousemove=p,t.onmouseout=p)},S=d=>{if(_.value){const t=C.value,o=B.value,s=m.value;if(t!==null){const p=t.getBoundingClientRect();if("pageX"in d){const y=(d.pageX-p.left)/t.offsetWidth*100;y<100&&y>0?(o.style.width=y+"%",s.style.width=100/y*100+"%",s.style.zIndex="3"):y<=0?(o.style.width="0",s.style.width="0"):y>=100&&(o.style.width="100%",s.style.width="100%")}}}},R=()=>{n.value!==null&&m.value!==null&&(n.value.paused?(n.value.play(),m.value.play(),x.value=!0):(n.value.pause(),m.value.pause(),x.value=!1))},F=d=>{n.value!==null&&m.value!==null&&(d=="forward"?(m.value.currentTime+=10,n.value.currentTime+=10):(m.value.currentTime-=10,n.value.currentTime-=10))},j=()=>{x.value=!1};return ie(()=>{const d=C.value,t=g.value;t!==null&&d!==null&&(J(t),d.addEventListener("mousemove",S,!1),d.addEventListener("mouseout",S,!1),d.addEventListener("touchstart",S,!1),d.addEventListener("touchmove",S,!1)),n.value!==null&&(n.value.addEventListener("ended",j,!1),n.value.addEventListener("timeupdate",o=>{},!1),n.value.addEventListener("seeking",o=>{n.value!==null&&console.log(Math.floor(n.value.currentTime))},!1))}),(d,t)=>{const o=E("FontAwesomeIcon");return v(),b(H,null,[r(o,{icon:"right-from-bracket",class:"sign-out-button",onClick:q(M)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:C},[e("div",Ie,[e("div",Ve,[e("div",we,[e("strong",{class:U(q(I)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",Ce,[e("strong",{class:U(q(L)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:k},[me(e("button",{ref_key:"draggableButton",ref:g,class:"drag-btn"},null,512),[[_e,q(L)]]),e("video",{ref_key:"originalVideo",ref:n,src:q(P)},null,8,Be),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:B},[e("video",{ref_key:"inferenceVideo",ref:m,src:q(V)},null,8,Se)],512),q(L)?(v(),b("button",{key:0,class:"share-btn",onClick:T},[r(ge,{name:"fade",mode:"out-in"},{default:de(()=>[$.value?(v(),b("span",{key:0,class:"copy-text",onClick:t[0]||(t[0]=be(()=>{},["stop"]))},"download and copy")):N("",!0)]),_:1})])):N("",!0)],512),q(L)?(v(),b("div",Ae,[e("div",$e,[r(o,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:t[1]||(t[1]=s=>F("backward"))}),r(o,{icon:"circle-play",class:"fa-3x play-button",onClick:R}),r(o,{icon:"play",class:"fa-3x next-button",onClick:t[2]||(t[2]=s=>F("forward"))})])])):N("",!0)])],512)],64)}}});const Oe=ee(Le,[["__scopeId","data-v-aaf53aee"]]),Ue="http://222.107.124.161:64000/assets/sample_video_img-8e9d2f79.png",te=w=>(ue("data-v-a5bf2b61"),w=w(),ce(),w),Me={class:"upload-modal-container"},Ee={class:"contents"},De=te(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),Pe=te(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Re={class:"sample-video-area"},Fe=te(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),qe={class:"sample-video-list"},Ne=["onClick"],Te={key:0,class:"file-name-area"},Xe={class:"file-name"},Je={key:1,class:"file-name-area"},je={class:"upload-btn-area"},He=Z({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(w,{emit:f}){const C=z("defaultInstance"),k=z("emitter"),B=a([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),n=a(0),m=a(!1),g=a(0),x=a(-1),_=a([]),M=a(!1),$=new AbortController,i=t=>{_.value.length>0?k.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):x.value=t},I=()=>{M.value=!0},L=()=>{M.value=!1},P=t=>{M.value=!0,t.preventDefault()},V=t=>{if(x.value!==-1)k.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{t.preventDefault();const o=/(\.mov|\.mp4|\.mkv)$/i;M.value=!1;const s=t.dataTransfer;if(s&&s.files){for(const p of s.files)if(!o.exec(p.name)){k.emit("update:alert",{isActive:!0,message:"mp4,mov,mkv 확장자만 지원합니다."});break}T(s.files,"drop")}}},T=(t,o)=>{let s;if(o=="change"?s=t.files:s=t,s!==null)for(let p=0;p<s.length;p++)_.value.push({title:s[p].name,file:s[p]})},J=t=>{_.value.splice(t,1)},S=t=>{if(x.value!==-1)k.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const o=t.target;o&&o.files&&T(o,"change")}},R=()=>{f("update:close")},F=()=>{f("update:abort"),$.abort()},j=()=>{Promise.all([C.get(A.videoList),C.get(A.inferenceModelList)]).then(t=>{f("update:upload",{videoList:t[0].data,inferenceModelList:t[1].data.data.filter(o=>o!==null)}),R()})},d=()=>{if(_.value.length>0){m.value=!0;const t=_.value,o=new FormData;for(let s=0;s<t.length;s++)console.log(t[s].file),o.append("file",t[s].file);C.postForm(A.upload,o,{signal:$.signal,onUploadProgress:s=>{const p=s.loaded*100/s.total;g.value=Number(p.toFixed(0)),p==100&&(m.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(s=>{console.log("output-> result",s),j()})}else k.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(t,o)=>{const s=E("FontAwesomeIcon"),p=E("BaseButton");return v(),b(H,null,[m.value?(v(),W(ne,{key:0,text:"video file uploading...",progressValue:g.value,"onUpdate:closeProgressModal":F},null,8,["progressValue"])):N("",!0),e("div",Me,[e("button",{class:"close-btn",onClick:R}),e("div",Ee,[e("div",{class:U(["file-upload-area",M.value?"dragged":""]),onDragenter:I,onDragover:P,onDragleave:L,onDrop:V},[e("strong",null,[ye(" Drop Video File here to upload or "),De,(v(),b("input",{key:n.value,type:"file",id:"file-upload",accept:".mp4, .mov, .mkv",onChange:S,onClick:o[0]||(o[0]=y=>n.value+=1),multiple:""},null,32))])],34),Pe,e("div",Re,[Fe,e("ul",qe,[(v(!0),b(H,null,G(B.value,(y,h)=>(v(),b("li",{key:h},[e("img",{onClick:Q=>i(h),src:Ue,class:U(h==x.value?"selected":"")},null,10,Ne)]))),128))])]),_.value.length>0?(v(),b("ul",Te,[(v(!0),b(H,null,G(_.value,(y,h)=>(v(),b("li",{key:h},[e("span",Xe,Y(y.file.name),1),r(s,{icon:"xmark",class:"delete-button",onClick:Q=>J(h)},null,8,["onClick"])]))),128))])):N("",!0),x.value!=-1?(v(),b("ul",Je,[e("li",null,Y(B.value[x.value].name),1)])):N("",!0),e("div",je,[r(p,{text:"Upload",onClick:d})])])])],64)}}});const Qe=ee(He,[["__scopeId","data-v-a5bf2b61"]]),D=w=>(ue("data-v-853d06c7"),w=w(),ce(),w),ze={class:"upload-area"},Ke=D(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),We={class:"row"},Ge={class:"row video-file-select-area"},Ye=D(()=>e("label",{class:"label"},"video File",-1)),Ze={class:"date"},et={class:"file-name-area"},tt=["onClick"],lt={class:"setting-area"},at=D(()=>e("h2",{class:"h2-title"},"Output Setting",-1)),st={class:"row"},ot=D(()=>e("label",{class:"label"},"AI Model",-1)),nt={class:"row"},it=D(()=>e("label",{class:"label"},"Format",-1)),dt={class:"row"},ut=D(()=>e("label",{class:"label"},"Encoder",-1)),ct={class:"row check-area"},rt=D(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),vt={class:"row check-area"},pt={class:"row"},ft=D(()=>e("label",{class:"bitrate"},"Bitrate : ",-1)),mt=D(()=>e("span",{class:"unit"},"(kbps)",-1)),_t={class:"row"},gt=Z({__name:"Main",setup(w){const f=z("emitter"),C=a(0),k=z("defaultInstance"),B=a([]),n=a(null),m=a([]),g=a(null),x=[{name:"mp4"},{name:"mov"},{name:"mkv"}],_=a({name:"mp4"}),M=[{name:"H.264"},{name:"H.265"},{name:"ProRes"}],$=a({name:"H.264"}),i=a([]),I=a("VBR"),L=a(!1),P=a(!1),V=a("128"),T=a(0),J=a(!1),S=a(!1),R=a(""),F=a(""),j=a(""),d=a("");let t;const o=u=>{n.value=null,m.value=[],B.value=[],m.value=u.inferenceModelList,B.value=u.videoList},s=()=>{Promise.all([k.get(A.videoList),k.get(A.inferenceModelList)]).then(u=>{B.value=u[0].data,m.value=u[1].data.data.filter(l=>l!==null)})},p=u=>{const l=i.value.indexOf(u);l>=0?i.value.splice(l,1):u=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(u)},y=()=>{n.value==null?f.emit("update:alert",{isActive:!0,message:"Please select a video file."}):g.value==null?f.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(S.value=!1,R.value="",F.value="",f.emit("update:loading",{isLoading:!0}),k.post(A.videoInference,{videoId:n.value&&n.value.videoId,containerId:g.value.containerId,format:_.value.name,encoder:$.value.name,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?0:V.value,vbr:i.value.indexOf("best quality")>=0?!1:I.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:I.value=="CBR"}).then(u=>{console.log(u),sessionStorage.setItem("inference",JSON.stringify({uuid:u.data.data,containerId:g.value.containerId})),j.value=u.data.data,X(u.data.data)}))},h=()=>{t.close(),P.value=!1,S.value=!1,ae({containerId:g.value.containerId,uuid:j.value})},Q=()=>{f.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{f.emit("update:loading",{isLoading:!0}),h()}})},X=u=>{t=new EventSource(A.connectSSE+`?uuid=${u}`),t.onopen=()=>{f.emit("update:loading",{isLoading:!1}),console.log(A.connectSSE+`?uuid=${u}----connect`)},t.onmessage=l=>{try{if(typeof JSON.parse(l.data)=="object"){const O=JSON.parse(l.data);d.value=O.step,T.value=O.progress,P.value=!0,O.status=="error"&&h(),O.step=="all"&&O.progress==100&&O.result=="true"&&(t.close(),P.value=!1,sessionStorage.removeItem("inference"),f.emit("update:loading",{isLoading:!0}),R.value="http://222.107.124.161:64000"+A.videoDownload+`?videoId=${n.value&&n.value.videoId}`,F.value="http://222.107.124.161:64000"+A.videoDownload+`?uuid=${u}`,S.value=!0,f.emit("update:loading",{isLoading:!1}))}}catch{}},t.onerror=l=>{console.log(l),h()}},le=u=>(u.preventDefault(),u.stopImmediatePropagation(),""),ae=u=>{f.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요."}),k.delete(A.videoInference+`?containerId=${u.containerId}&uuid=${u.uuid}`).then(l=>{console.log("삭제",l),s(),f.emit("update:loading",{isLoading:!1}),f.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),sessionStorage.removeItem("inference")})};return he(()=>{window.removeEventListener("beforeunload",le)}),ie(()=>{window.addEventListener("beforeunload",le),s(),sessionStorage.getItem("inference")!=null&&ae(JSON.parse(sessionStorage.getItem("inference")))}),(u,l)=>{const O=E("BaseButton"),re=E("FontAwesomeIcon"),K=E("BaseSelect"),ve=E("BaseCheckBox"),se=E("BaseRadio"),pe=E("BaseInput");return v(),b(H,null,[P.value?(v(),W(ne,{key:0,text:d.value+" in_progress...",progressValue:T.value,"onUpdate:closeProgressModal":Q},null,8,["text","progressValue"])):N("",!0),e("main",null,[L.value?(v(),W(ke,{key:0,to:"#teleport-upload-modal"},[(v(),W(Qe,{key:C.value,"onUpdate:close":l[0]||(l[0]=c=>L.value=!1),"onUpdate:upload":l[1]||(l[1]=c=>o(c)),"onUpdate:abort":l[2]||(l[2]=c=>C.value+=1)}))])):N("",!0),e("aside",null,[e("section",ze,[Ke,e("div",We,[r(O,{onClick:l[3]||(l[3]=c=>L.value=!0),text:"Upload Video"})]),e("div",Ge,[Ye,r(K,{name:"fileName",options:B.value,text:n.value==null?"<span class=not-selected>Please Upload Video Files</span>":n.value.fileName},xe({_:2},[G(B.value,c=>({name:"list",fn:de(()=>[e("span",Ze,Y(c.date),1),(v(!0),b(H,null,G(c.video,oe=>(v(),b("div",et,[e("span",{class:"file-name",onClick:bt=>{J.value=!0,n.value=oe}},Y(oe.fileName),9,tt),r(re,{icon:"xmark",class:"delete-button"})]))),256))])}))]),1032,["options","text"])])]),e("section",lt,[at,e("div",st,[ot,r(K,{"onUpdate:selectBox":l[4]||(l[4]=c=>{g.value=c}),options:m.value,name:"projectName,modelName",text:g.value==null?"<span class=not-selected>Select AI Model</span>":g.value.projectName+"/"+g.value.modelName},null,8,["options","text"])]),e("div",nt,[it,r(K,{"onUpdate:selectBox":l[5]||(l[5]=c=>_.value=c),options:x,name:"name",text:_.value.name},null,8,["text"])]),e("div",dt,[ut,r(K,{"onUpdate:selectBox":l[6]||(l[6]=c=>$.value=c),options:M,name:"name",text:$.value.name},null,8,["text"])]),e("div",ct,[e("div",null,[r(ve,{"onUpdate:checkModelValue":p,id:"BestQuality",value:"best quality"}),rt])]),e("div",vt,[e("div",null,[r(se,{class:U(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[l[7]||(l[7]=c=>I.value=c),l[8]||(l[8]=c=>I.value=c)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:I.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:U(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[r(se,{class:U(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[l[9]||(l[9]=c=>I.value=c),l[10]||(l[10]=c=>I.value=c)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:I.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:U(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",pt,[ft,r(pe,{"onUpdate:modelValue":l[11]||(l[11]=c=>V.value=c),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?0:V.value,class:U(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),mt]),e("div",_t,[r(O,{text:"Preview",class:U(n.value==null||g.value==null?"inActive":"active"),onClick:y},null,8,["class"])])])]),r(Oe,{isUploaded:J.value,isInferred:S.value,originalVideoSrc:R.value,inferredVideoSrc:F.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const xt=ee(gt,[["__scopeId","data-v-853d06c7"]]);export{xt as default};
