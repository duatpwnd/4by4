import{P as ee}from"./ProgressModal-259c72bf.js";import{d as z,r as n,i as H,w as ae,o as te,f as q,g as _,j as v,x as S,h as e,y as k,k as M,z as ne,T as ie,F as X,A as de,n as p,C as ue,_ as K,t as Q,D as ce,E as J,G as Z,p as le,m as se,b as re,H as ve,I as pe}from"./index-1ecc783b.js";import{s as $}from"./services-39e6a1b0.js";const fe={id:"teleport-upload-modal",class:"contents"},me={class:"title-area"},_e={class:"original"},ge={class:"pixell-ai"},be=["src"],ye=["src"],he={key:0,class:"timeline-area"},xe={class:"video-menu-area"},ke=z({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(V){const b=V,B=n(null),y=n(null),w=n(null),d=n(null),f=n(null),g=n(null),h=n(!1),m=n(!1),E=H("signOut"),I=n(!1),i=n(null),{isUploaded:x,isInferred:A,originalVideoSrc:O,inferredVideoSrc:D}=ae(b),F=()=>{const u="test.mp4".split(".").pop();i.value!==null&&clearTimeout(i.value),window.navigator.clipboard.writeText("copy").then(()=>{de.get("",{responseType:"blob"}).then(o=>{console.log(o)});const l=new Blob([""],{type:`video/${u}`}),s=document.createElement("a");s.href=URL.createObjectURL(l),s.download="test",s.click(),URL.revokeObjectURL(s.href),I.value=!0,i.value=setTimeout(()=>{I.value=!1},2e3)})},T=u=>{const l=B.value;let s=!1;document.onmouseup=()=>{s=!1,m.value=!1};const o=()=>{s=!0,m.value=!0},r=t=>{if(s&&l!==null){const P=l.getBoundingClientRect();if("pageX"in t){const L=(t.pageX-P.left)/l.offsetWidth*100;L<100&&L>0?u.style.left=L+"%":L<=0?u.style.left="0px":L>=100&&(u.style.left="100%")}}},a=()=>{s=!1,m.value=!1};u.onmousedown=o,u.onmouseup=a,l!==null&&(l.onmousemove=r,l.onmouseout=r)},U=u=>{if(m.value){const l=B.value,s=w.value,o=f.value;if(l!==null){const r=l.getBoundingClientRect();if("pageX"in u){const a=(u.pageX-r.left)/l.offsetWidth*100;a<100&&a>0?(s.style.width=a+"%",o.style.width=100/a*100+"%",o.style.zIndex="3"):a<=0?(s.style.width="0",o.style.width="0"):a>=100&&(s.style.width="100%",o.style.width="100%")}}}},C=()=>{d.value!==null&&f.value!==null&&(d.value.paused?(d.value.play(),f.value.play(),h.value=!0):(d.value.pause(),f.value.pause(),h.value=!1))},N=u=>{d.value!==null&&f.value!==null&&(u=="forward"?(f.value.currentTime+=10,d.value.currentTime+=10):(f.value.currentTime-=10,d.value.currentTime-=10))},j=()=>{h.value=!1};return te(()=>{const u=B.value,l=g.value;l!==null&&u!==null&&(T(l),u.addEventListener("mousemove",U,!1),u.addEventListener("mouseout",U,!1),u.addEventListener("touchstart",U,!1),u.addEventListener("touchmove",U,!1)),d.value!==null&&(d.value.addEventListener("ended",j,!1),d.value.addEventListener("timeupdate",s=>{},!1),d.value.addEventListener("seeking",s=>{d.value!==null&&console.log(Math.floor(d.value.currentTime))},!1))}),(u,l)=>{const s=q("FontAwesomeIcon");return p(),_(X,null,[v(s,{icon:"right-from-bracket",class:"sign-out-button",onClick:S(E)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:B},[e("div",fe,[e("div",me,[e("div",_e,[e("strong",{class:k(S(x)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",ge,[e("strong",{class:k(S(A)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:y},[S(A)?(p(),_("button",{key:0,ref_key:"draggableButton",ref:g,class:"drag-btn"},null,512)):M("",!0),e("video",{ref_key:"originalVideo",ref:d},[e("source",{src:S(O)},null,8,be)],512),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:w},[e("video",{ref_key:"inferenceVideo",ref:f},[e("source",{src:S(D)},null,8,ye)],512)],512),S(A)?(p(),_("button",{key:1,class:"share-btn",onClick:F},[v(ie,{name:"fade",mode:"out-in"},{default:ne(()=>[I.value?(p(),_("span",{key:0,class:"copy-text",onClick:l[0]||(l[0]=ue(()=>{},["stop"]))},"copied.")):M("",!0)]),_:1})])):M("",!0)],512),S(A)?(p(),_("div",he,[e("div",xe,[v(s,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:l[1]||(l[1]=o=>N("backward"))}),v(s,{icon:"circle-play",class:"fa-3x play-button",onClick:C}),v(s,{icon:"play",class:"fa-3x next-button",onClick:l[2]||(l[2]=o=>N("forward"))})])])):M("",!0)])],512)],64)}}});const Ve=K(ke,[["__scopeId","data-v-e12fa026"]]),Be="http://222.107.124.161:64000/assets/sample_video_img-8e9d2f79.png",W=V=>(le("data-v-a5bf2b61"),V=V(),se(),V),Ce={class:"upload-modal-container"},we={class:"contents"},Ie=W(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),Ae=W(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Ue={class:"sample-video-area"},Le=W(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),$e={class:"sample-video-list"},Ee=["onClick"],Oe={key:0,class:"file-name-area"},Me={class:"file-name"},Re={key:1,class:"file-name-area"},Pe={class:"upload-btn-area"},Se=z({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(V,{emit:b}){const B=H("defaultInstance"),y=H("emitter"),w=n([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),d=n(0),f=n(!1),g=n(0),h=n(-1),m=n([]),E=n(!1),I=new AbortController,i=l=>{m.value.length>0?y.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):h.value=l},x=()=>{E.value=!0},A=()=>{E.value=!1},O=l=>{E.value=!0,l.preventDefault()},D=l=>{if(h.value!==-1)y.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{l.preventDefault();const s=/(\.mov|\.mp4|\.mkv)$/i;E.value=!1;const o=l.dataTransfer;if(o&&o.files){for(const r of o.files)if(!s.exec(r.name)){y.emit("update:alert",{isActive:!0,message:"mp4,mov,mkv 확장자만 지원합니다."});break}F(o.files,"drop")}}},F=(l,s)=>{let o;if(s=="change"?o=l.files:o=l,o!==null)for(let r=0;r<o.length;r++)m.value.push({title:o[r].name,file:o[r]})},T=l=>{m.value.splice(l,1)},U=l=>{if(h.value!==-1)y.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const s=l.target;s&&s.files&&F(s,"change")}},C=()=>{b("update:close")},N=()=>{b("update:abort"),I.abort()},j=()=>{Promise.all([B.get($.videoList),B.get($.inferenceModelList)]).then(l=>{b("update:upload",{videoList:l[0].data,inferenceModelList:l[1].data.data.filter(s=>s!==null)}),C()})},u=()=>{if(m.value.length>0){f.value=!0;const l=m.value,s=new FormData;for(let o=0;o<l.length;o++)console.log(l[o].file),s.append("file",l[o].file);B.postForm($.upload,s,{signal:I.signal,onUploadProgress:o=>{const r=o.loaded*100/o.total;g.value=Number(r.toFixed(0)),r==100&&(f.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(o=>{console.log("output-> result",o),j()})}else y.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(l,s)=>{const o=q("FontAwesomeIcon"),r=q("BaseButton");return p(),_(X,null,[f.value?(p(),Q(ee,{key:0,text:"video file uploading...",progressValue:g.value,"onUpdate:closeProgressModal":N},null,8,["progressValue"])):M("",!0),e("div",Ce,[e("button",{class:"close-btn",onClick:C}),e("div",we,[e("div",{class:k(["file-upload-area",E.value?"dragged":""]),onDragenter:x,onDragover:O,onDragleave:A,onDrop:D},[e("strong",null,[ce(" Drop Video File here to upload or "),Ie,(p(),_("input",{key:d.value,type:"file",id:"file-upload",accept:".mp4, .mov, .mkv",onChange:U,onClick:s[0]||(s[0]=a=>d.value+=1),multiple:""},null,32))])],34),Ae,e("div",Ue,[Le,e("ul",$e,[(p(!0),_(X,null,J(w.value,(a,t)=>(p(),_("li",{key:t},[e("img",{onClick:P=>i(t),src:Be,class:k(t==h.value?"selected":"")},null,10,Ee)]))),128))])]),m.value.length>0?(p(),_("ul",Oe,[(p(!0),_(X,null,J(m.value,(a,t)=>(p(),_("li",{key:t},[e("span",Me,Z(a.file.name),1),v(o,{icon:"xmark",class:"delete-button",onClick:P=>T(t)},null,8,["onClick"])]))),128))])):M("",!0),h.value!=-1?(p(),_("ul",Re,[e("li",null,Z(w.value[h.value].name),1)])):M("",!0),e("div",Pe,[v(r,{text:"Upload",onClick:u})])])])],64)}}});const qe=K(Se,[["__scopeId","data-v-a5bf2b61"]]),R=V=>(le("data-v-ddffc0bb"),V=V(),se(),V),De={class:"upload-area"},Fe=R(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),Te={class:"row"},Ne={class:"row"},je=R(()=>e("label",{class:"label"},"video File",-1)),Xe={class:"setting-area"},He=R(()=>e("h2",{class:"h2-title"},"Output Setting",-1)),Qe={class:"row"},ze=R(()=>e("label",{class:"label"},"AI Model",-1)),Ke={class:"row"},We=R(()=>e("label",{class:"label"},"Format",-1)),Ge={class:"row"},Ye=R(()=>e("label",{class:"label"},"Encoder",-1)),Je={class:"row check-area"},Ze=R(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),et={class:"row check-area"},tt={class:"row"},lt=R(()=>e("label",{class:"bitrate"},"AVg.Bitrate : ",-1)),st=R(()=>e("span",{class:"unit"},"(kbps)",-1)),ot={class:"row"},at=z({__name:"Main",setup(V){const b=H("emitter"),B=n(0),y=H("defaultInstance"),w=n([]),d=n(null),f=n([]),g=n(null),h=[{name:"mp4"},{name:"mov"},{name:"mkv"}],m=n({name:"mp4"}),E=[{name:"H.264"},{name:"H.265"},{name:"ProRes"}],I=n({name:"H.264"}),i=n([]),x=n("VBR"),A=n(!1),O=n(!1),D=n("128"),F=n(0),T=n(!1),U=n(!1);re();let C;const N=a=>{d.value=null,f.value=[],w.value=[],f.value=a.inferenceModelList,w.value=a.videoList},j=()=>{Promise.all([y.get($.videoList),y.get($.inferenceModelList)]).then(a=>{w.value=a[0].data,f.value=a[1].data.data.filter(t=>t!==null)})},u=a=>{const t=i.value.indexOf(a);t>=0?i.value.splice(t,1):a=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(a)},l=()=>{d.value==null?b.emit("update:alert",{isActive:!0,message:"Please select a video file."}):g.value==null?b.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(b.emit("update:loading",{isLoading:!0}),y.post($.videoInference,{videoId:d.value&&d.value.videoId,containerId:g.value.containerId,format:m.value.name,encoder:I.value.name,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?0:D.value,vbr:i.value.indexOf("best quality")>=0?!1:x.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:x.value=="CBR"}).then(a=>{console.log(a),o(a.data.data)}))},s=()=>{b.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{C.close(),O.value=!1,U.value=!1,console.log($.connectSSE+"----closed")}})},o=a=>{C=new EventSource($.connectSSE+`?uuid=${a}`),C.onopen=()=>{b.emit("update:loading",{isLoading:!1}),O.value=!0,console.log($.connectSSE+`?uuid=${a}----connect`)},C.onmessage=t=>{console.log(t),F.value=t.data.progress,t.data.progress==100&&(C.close(),U.value=!0,O.value=!1,y.get($.videoDownload+"?path=$").then(P=>{console.log("video download",P)}))},C.onerror=t=>{b.emit("update:loading",{isLoading:!1}),console.log(t)}},r=a=>{if(O.value)return a.preventDefault(),a.stopImmediatePropagation(),""};return ve(()=>{window.removeEventListener("beforeunload",r)}),te(()=>{window.addEventListener("beforeunload",r),j()}),(a,t)=>{const P=q("BaseButton"),L=q("BaseSelect"),G=q("BaseCheckBox"),Y=q("BaseRadio"),oe=q("BaseInput");return p(),_(X,null,[O.value?(p(),Q(ee,{key:0,text:"Inference is in progress...",progressValue:F.value,"onUpdate:closeProgressModal":s},null,8,["progressValue"])):M("",!0),e("main",null,[A.value?(p(),Q(pe,{key:0,to:"#teleport-upload-modal"},[(p(),Q(qe,{key:B.value,"onUpdate:close":t[0]||(t[0]=c=>A.value=!1),"onUpdate:upload":t[1]||(t[1]=c=>N(c)),"onUpdate:abort":t[2]||(t[2]=c=>B.value+=1)}))])):M("",!0),e("aside",null,[e("section",De,[Fe,e("div",Te,[v(P,{onClick:t[3]||(t[3]=c=>A.value=!0),text:"Upload Video"})]),e("div",Ne,[je,v(L,{"onUpdate:selectBox":t[4]||(t[4]=c=>{T.value=!0,d.value=c}),name:"fileName",options:w.value,text:d.value==null?"<span class=not-selected>Please Upload Video Files</span>":d.value.fileName},null,8,["options","text"])])]),e("section",Xe,[He,e("div",Qe,[ze,v(L,{"onUpdate:selectBox":t[5]||(t[5]=c=>{g.value=c}),options:f.value,name:"projectName,modelName",text:g.value==null?"<span class=not-selected>Select AI Model</span>":g.value.projectName+"/"+g.value.modelName},null,8,["options","text"])]),e("div",Ke,[We,v(L,{"onUpdate:selectBox":t[6]||(t[6]=c=>m.value=c),options:h,name:"name",text:m.value.name},null,8,["text"])]),e("div",Ge,[Ye,v(L,{"onUpdate:selectBox":t[7]||(t[7]=c=>I.value=c),options:E,name:"name",text:I.value.name},null,8,["text"])]),e("div",Je,[e("div",null,[v(G,{"onUpdate:checkModelValue":u,id:"BestQuality",value:"best quality"}),Ze]),e("div",null,[e("span",{class:k(["check-box",i.value.indexOf("best quality")<0?"active":"inActive"])},[v(G,{"onUpdate:checkModelValue":u,id:i.value.indexOf("best quality")<0?"2PassEncoding":"",value:"2-Pass Encoding"},null,8,["id"])],2),e("label",{for:"2PassEncoding",class:k(i.value.indexOf("best quality")<0?"active":"inActive")},"2-Pass Encoding",2)])]),e("div",et,[e("div",null,[v(Y,{class:k(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[t[8]||(t[8]=c=>x.value=c),t[9]||(t[9]=c=>x.value=c)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:x.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:k(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[v(Y,{class:k(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[t[10]||(t[10]=c=>x.value=c),t[11]||(t[11]=c=>x.value=c)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:x.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:k(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",tt,[lt,v(oe,{"onUpdate:modelValue":t[12]||(t[12]=c=>D.value=c),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?0:D.value,class:k(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),st]),e("div",ot,[v(P,{text:"Preview",class:k(d.value==null||g.value==null?"inActive":"active"),onClick:l},null,8,["class"])])])]),v(Ve,{isUploaded:T.value,isInferred:U.value,originalVideoSrc:"",inferredVideoSrc:""},null,8,["isUploaded","isInferred"])])],64)}}});const ut=K(at,[["__scopeId","data-v-ddffc0bb"]]);export{ut as default};
