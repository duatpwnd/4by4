import{d as se,r as a,v as Ve,o as pe,f as F,g as _,h as e,w as O,x as L,y as Ie,z as we,j as f,A as le,T as ve,k as U,m as v,C as ae,_ as oe,i as W,q as ee,D as Ce,F as j,E as te,G,p as fe,l as me,c as Be,H as Ae,I as Se,J as $e}from"./index-52f3fb6e.js";import{P as _e,e as Le}from"./eventsource-f2c07c9b.js";import{s as T}from"./services-b33b6e54.js";const Oe={id:"teleport-upload-modal",class:"contents"},Ue={class:"title-area"},Ee={class:"original"},Me={class:"pixell-ai"},Pe=["src"],Re=["src"],De={key:0,class:"timeline-area"},Fe={class:"video-menu-area"},Te=se({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(C){const p=C,S=a(null),E=a(null),N=a(null),c=a(null),m=a(null),h=a(null),g=a(!1),d=a(!1),B=a(!1),x=a(!1),M=a(null),i=a(null),{isUploaded:V,isInferred:I,originalVideoSrc:P,inferredVideoSrc:A}=Ve(p),J=()=>{M.value!==null&&clearTimeout(M.value),window.navigator.clipboard.writeText(A.value).then(()=>{B.value=!0,M.value=setTimeout(()=>{B.value=!1},2e3)})},Q=()=>{i.value!==null&&clearTimeout(i.value);const l=document.createElement("a");l.href=A.value,l.download=A.value,l.click(),x.value=!0,i.value=setTimeout(()=>{x.value=!1},2e3)},R=l=>{const t=S.value;console.log(t);let o=!1;document.onmouseup=()=>{o=!1,d.value=!1};const b=()=>{o=!0,d.value=!0},y=H=>{if(o&&t!==null){const K=t.getBoundingClientRect();if("pageX"in H){const D=(H.pageX-K.left)/t.offsetWidth*100;D<100&&D>0?l.style.left=D+"%":D<=0?l.style.left="0px":D>=100&&(l.style.left="100%")}}},k=()=>{o=!1,d.value=!1};l.onmousedown=b,l.onmouseup=k,t!==null&&(t.onmousemove=y,t.onmouseout=y)},$=l=>{if(d.value){const t=S.value,o=N.value,b=m.value;if(t!==null){const y=t.getBoundingClientRect();if("pageX"in l){const k=(l.pageX-y.left)/t.offsetWidth*100;k<100&&k>0?(o.style.width=k+"%",b.style.width=100/k*100+"%",b.style.zIndex="3"):k<=0?(o.style.width="0",b.style.width="0"):k>=100&&(o.style.width="100%",b.style.width="100%")}}}},z=()=>{c.value!==null&&m.value!==null&&(c.value.paused?(c.value.play(),m.value.play(),g.value=!0):(c.value.pause(),m.value.pause(),g.value=!1))},X=l=>{c.value!==null&&m.value!==null&&(l=="forward"?(m.value.currentTime+=10,c.value.currentTime+=10):(m.value.currentTime-=10,c.value.currentTime-=10))},u=()=>{g.value=!1};return pe(()=>{const l=S.value,t=h.value;t!==null&&l!==null&&(R(t),l.addEventListener("mousemove",$,!1),l.addEventListener("mouseout",$,!1),l.addEventListener("touchstart",$,!1),l.addEventListener("touchmove",$,!1)),c.value!==null&&(c.value.addEventListener("ended",u,!1),c.value.addEventListener("timeupdate",o=>{},!1),c.value.addEventListener("seeking",o=>{c.value!==null&&console.log(Math.floor(c.value.currentTime))},!1))}),(l,t)=>{const o=F("FontAwesomeIcon");return v(),_("div",{class:"video-container",ref_key:"videoContainerRef",ref:S},[e("div",Oe,[e("div",Ue,[e("div",Ee,[e("strong",{class:O(L(V)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",Me,[e("strong",{class:O(L(I)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:E},[Ie(e("button",{ref_key:"draggableButton",ref:h,class:"drag-btn"},null,512),[[we,L(I)]]),e("video",{ref_key:"originalVideo",ref:c,src:L(P)},null,8,Pe),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:N},[e("video",{ref_key:"inferenceVideo",ref:m,src:L(A)},null,8,Re)],512),L(I)?(v(),_("button",{key:0,class:"share-btn",onClick:J},[f(ve,{name:"fade",mode:"out-in"},{default:le(()=>[B.value?(v(),_("span",{key:0,class:"copy-text",onClick:t[0]||(t[0]=ae(()=>{},["stop"]))},"copy")):U("",!0)]),_:1})])):U("",!0),L(I)?(v(),_("button",{key:1,class:"download-btn",onClick:Q},[f(ve,{name:"fade",mode:"out-in"},{default:le(()=>[x.value?(v(),_("span",{key:0,class:"download-text",onClick:t[1]||(t[1]=ae(()=>{},["stop"]))},"download")):U("",!0)]),_:1})])):U("",!0)],512),L(I)?(v(),_("div",De,[e("div",Fe,[f(o,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:t[2]||(t[2]=b=>X("backward"))}),f(o,{icon:"circle-play",class:"fa-3x play-button",onClick:z}),f(o,{icon:"play",class:"fa-3x next-button",onClick:t[3]||(t[3]=b=>X("forward"))})])])):U("",!0)])],512)}}});const qe=oe(Te,[["__scopeId","data-v-3ca2e580"]]),Ne="http://222.107.124.161:64000/assets/sample_video_img-8e9d2f79.png",ne=C=>(fe("data-v-e7ebe5a6"),C=C(),me(),C),He={class:"upload-modal-container"},ze={class:"contents"},Xe=ne(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),Je=ne(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Qe={class:"sample-video-area"},je=ne(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),Ke={class:"sample-video-list"},We=["onClick"],Ge={key:0,class:"file-name-area"},Ye={class:"file-name"},Ze={key:1,class:"file-name-area"},et={class:"upload-btn-area"},tt=se({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(C,{emit:p}){const S=W("defaultInstance"),E=W("emitter"),N=a([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),c=a(0),m=a(!1),h=a(0),g=a(-1),d=a([]),B=a(!1),x=new AbortController,M=u=>{d.value.length>0?E.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):g.value=u},i=()=>{B.value=!0},V=()=>{B.value=!1},I=u=>{B.value=!0,u.preventDefault()},P=u=>{if(g.value!==-1)E.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{u.preventDefault();const l=/\.mp4$/i;B.value=!1;const t=u.dataTransfer;if(t&&t.files)for(const o of t.files)if(l.test(o.name))A(t.files,"drop");else{E.emit("update:alert",{isActive:!0,message:"mp4 확장자만 지원합니다."});break}}},A=(u,l)=>{let t;if(l=="change"?t=u.files:t=u,t!==null)for(let o=0;o<t.length;o++){/\.mp4$/i.test(t[o].name)&&d.value.push({title:t[o].name,file:t[o]});const y=d.value.filter((k,H,K)=>H===K.findIndex(D=>D.title===k.title));d.value=y}},J=u=>{d.value.splice(u,1)},Q=u=>{if(g.value!==-1)E.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const l=u.target;l&&l.files&&A(l,"change")}},R=()=>{p("update:close")},$=()=>{p("update:abort"),x.abort()},z=()=>{Promise.all([S.get(T.videoList),S.get(T.inferenceModelList)]).then(u=>{p("update:upload",{videoList:u[0].data,inferenceModelList:u[1].data.data.filter(l=>l!==null)}),R()})},X=()=>{if(d.value.length>0){m.value=!0;const u=d.value,l=new FormData;for(let t=0;t<u.length;t++)console.log(u[t].file),l.append("file",u[t].file);S.postForm(T.upload,l,{signal:x.signal,onUploadProgress:t=>{const o=t.loaded*100/t.total;h.value=Number(o.toFixed(0)),o==100&&(m.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(t=>{console.log("output-> result",t),z()})}else E.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(u,l)=>{const t=F("FontAwesomeIcon"),o=F("BaseButton");return v(),_(j,null,[m.value?(v(),ee(_e,{key:0,text:"video file uploading...",progressValue:h.value,"onUpdate:closeProgressModal":$},null,8,["progressValue"])):U("",!0),e("div",He,[e("button",{class:"close-btn",onClick:R}),e("div",ze,[e("div",{class:O(["file-upload-area",B.value?"dragged":""]),onDragenter:i,onDragover:I,onDragleave:V,onDrop:P},[e("strong",null,[Ce(" Drop Video File here to upload or "),Xe,(v(),_("input",{key:c.value,type:"file",id:"file-upload",accept:".mp4",onChange:Q,onClick:l[0]||(l[0]=b=>c.value+=1),multiple:""},null,32))])],34),Je,e("div",Qe,[je,e("ul",Ke,[(v(!0),_(j,null,te(N.value,(b,y)=>(v(),_("li",{key:y},[e("img",{onClick:k=>M(y),src:Ne,class:O(y==g.value?"selected":"")},null,10,We)]))),128))])]),d.value.length>0?(v(),_("ul",Ge,[(v(!0),_(j,null,te(d.value,(b,y)=>(v(),_("li",{key:y},[e("span",Ye,G(b.file.name),1),f(t,{icon:"xmark",class:"delete-button",onClick:k=>J(y)},null,8,["onClick"])]))),128))])):U("",!0),g.value!=-1?(v(),_("ul",Ze,[e("li",null,G(N.value[g.value].name),1)])):U("",!0),e("div",et,[f(o,{text:"Upload",onClick:X})])])])],64)}}});const lt=oe(tt,[["__scopeId","data-v-e7ebe5a6"]]),q=C=>(fe("data-v-38f10bf6"),C=C(),me(),C),at={class:"upload-area"},st=q(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),ot={class:"row"},nt={class:"row video-file-select-area"},it=q(()=>e("label",{class:"label"},"Video File",-1)),ut={class:"date"},dt=["onClick"],rt={class:"file-size"},ct={class:"setting-area"},vt=q(()=>e("h2",{class:"h2-title"},"Output Settings",-1)),pt={class:"row"},ft=q(()=>e("label",{class:"label"},"AI Model",-1)),mt={class:"row"},_t=q(()=>e("label",{class:"label"},"Format",-1)),gt={class:"row"},bt=q(()=>e("label",{class:"label"},"Encoder",-1)),yt={class:"row check-area"},ht=q(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),kt={class:"row check-area"},xt={class:"row"},Vt=q(()=>e("label",{class:"bitrate"},"Bitrate : ",-1)),It=q(()=>e("span",{class:"unit"},"(kbps)",-1)),wt={class:"row"},Ct=se({__name:"Main",setup(C){const p=W("emitter"),S=W("signOut"),E=Be(),N=a(0),c=W("defaultInstance"),m=a([]),h=a(null),g=a([]),d=a(null),B=[{name:"mp4"},{name:"mov"},{name:"mkv"}],x=a({name:"mp4"}),M=a({name:"H.264",value:"H.264"}),i=a([]),V=a("VBR"),I=a(!1),P=a(!1),A=a("1000"),J=a(0),Q=a(!1),R=a(!1),$=a(""),z=a(""),X=a(""),u=a(""),l=Ae(()=>{const n=[{name:"H.264",value:"H.264"},{name:"H.265",value:"H.265"},{name:"ProRes(Unable to play video)",value:"ProRes"}];return(x.value.name=="mp4"||x.value.name=="mov")&&(n[2].disabled=!0),n}),t=a(null);let o;const b=n=>{m.value.length==0&&(p.emit("update:alert",{isActive:!0,message:"Please upload your video files."}),n.stopPropagation())},y=n=>{h.value=null,g.value=[],m.value=[],g.value=n.inferenceModelList,m.value=n.videoList},k=n=>{p.emit("update:alert",{isActive:!0,message:"삭제하시겠습니까?",fn:()=>{p.emit("update:loading",{isLoading:!0}),c.delete(T.video+`?videoId=${n}`).then(s=>{p.emit("update:loading",{isLoading:!1}),H()})}})},H=()=>{Promise.all([c.get(T.videoList),c.get(T.inferenceModelList)]).then(n=>{m.value=n[0].data,g.value=n[1].data.data.filter(s=>s!==null)})},K=n=>{const s=i.value.indexOf(n);s>=0?i.value.splice(s,1):n=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(n)},D=()=>{h.value==null?p.emit("update:alert",{isActive:!0,message:"Please select a video file."}):d.value==null?p.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(I.value=!1,R.value=!1,$.value="",z.value="",p.emit("update:loading",{isLoading:!0}),c.post(T.videoInference,{videoId:h.value&&h.value.videoId,containerId:d.value.containerId,format:x.value.name,encoder:M.value.value,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?"1000":A.value,vbr:i.value.indexOf("best quality")>=0?!1:V.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:V.value=="CBR"}).then(n=>{sessionStorage.setItem("inference",JSON.stringify({uuid:n.data.data,containerId:d.value.containerId})),X.value=n.data.data,be(n.data.data)}))},ie=()=>{o.close(),P.value=!1,R.value=!1,de({containerId:d.value.containerId,uuid:X.value})},ge=()=>{p.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{ie()}})},be=n=>{o=new Le.EventSourcePolyfill("http://222.107.124.161:64000"+T.connectSSE+`?uuid=${n}`,{headers:{Authorization:E.user.token}}),o.onopen=()=>{p.emit("update:loading",{isLoading:!1})},o.onmessage=s=>{try{if(typeof JSON.parse(s.data)=="object"){const w=JSON.parse(s.data);u.value=w.step,J.value=w.progress,P.value=!0,w.status=="error"&&ie(),w.step=="all"&&w.progress==100&&w.result=="true"&&(o.close(),P.value=!1,sessionStorage.removeItem("inference"),p.emit("update:loading",{isLoading:!0}),$.value=w.originalVideo,z.value=w.inferenceVideo,R.value=!0,p.emit("update:loading",{isLoading:!1}))}}catch{}}},ue=n=>{if(P.value)return n.preventDefault(),n.stopImmediatePropagation(),""},de=n=>{p.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요.&nbsp;&nbsp;<div class='loader'></div>"}),c.delete(T.videoInference+`?containerId=${n.containerId}&uuid=${n.uuid}`).then(s=>{H(),p.emit("update:loading",{isLoading:!1}),p.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),setTimeout(()=>{p.emit("update:alert",{isActive:!1})},2e3),sessionStorage.removeItem("inference")})};return Se(()=>{window.removeEventListener("beforeunload",ue)}),pe(()=>{window.addEventListener("beforeunload",ue),H(),sessionStorage.getItem("inference")!=null&&de(JSON.parse(sessionStorage.getItem("inference")))}),(n,s)=>{const w=F("FontAwesomeIcon"),re=F("BaseButton"),Y=F("BaseSelect"),ye=F("BaseCheckBox"),ce=F("BaseRadio"),he=F("BaseInput");return v(),_(j,null,[P.value?(v(),ee(_e,{key:0,text:u.value+" in_progress...",progressValue:J.value,"onUpdate:closeProgressModal":ge},null,8,["text","progressValue"])):U("",!0),e("main",null,[I.value?(v(),ee($e,{key:0,to:"#teleport-upload-modal"},[(v(),ee(lt,{key:N.value,"onUpdate:close":s[0]||(s[0]=r=>I.value=!1),"onUpdate:upload":s[1]||(s[1]=r=>y(r)),"onUpdate:abort":s[2]||(s[2]=r=>N.value+=1)}))])):U("",!0),e("aside",null,[e("section",at,[st,f(w,{icon:"right-from-bracket",class:"sign-out-button",onClick:L(S)},null,8,["onClick"]),e("div",ot,[f(re,{onClick:s[3]||(s[3]=r=>I.value=!0),text:"Upload Video"})]),e("div",nt,[it,f(Y,{onClick:b,name:"fileName",options:m.value,text:h.value==null?"<span class=not-selected>Please Upload Video Files</span>":h.value.fileName},{list:le(()=>[(v(!0),_(j,null,te(m.value,(r,ke)=>(v(),_("li",{class:"optionItem",key:ke},[e("span",ut,G(r.date),1),(v(!0),_(j,null,te(r.video,(Z,Bt)=>(v(),_("div",{class:"file-name-area",onClick:xe=>{Q.value=!0,h.value=Z}},[e("span",{class:"file-name",ref_for:!0,ref_key:"fileName",ref:t},G(Z.fileName),513),e("span",null,[e("span",rt,G(Z.fileSize),1),f(w,{icon:"xmark",class:"delete-button",onClick:ae(xe=>k(Z.videoId),["stop"])},null,8,["onClick"])])],8,dt))),256))]))),128))]),_:1},8,["options","text"])])]),e("section",ct,[vt,e("div",pt,[ft,f(Y,{"onUpdate:selectBox":s[4]||(s[4]=r=>{d.value=r}),options:g.value,name:"projectName,modelName",text:d.value==null?"<span class=not-selected>Select AI Model</span>":d.value.projectName+"/"+d.value.modelName},null,8,["options","text"])]),e("div",mt,[_t,f(Y,{"onUpdate:selectBox":s[5]||(s[5]=r=>x.value=r),options:B,name:"name",text:x.value.name},null,8,["text"])]),e("div",gt,[bt,f(Y,{"onUpdate:selectBox":s[6]||(s[6]=r=>{r.disabled&&L(p).emit("update:alert",{isActive:!0,message:"Unable to play video"}),M.value=r}),options:l.value,name:"name",text:M.value.name},null,8,["options","text"])]),e("div",yt,[e("div",null,[f(ye,{"onUpdate:checkModelValue":K,id:"BestQuality",value:"best quality"}),ht])]),e("div",kt,[e("div",null,[f(ce,{class:O(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[s[7]||(s[7]=r=>V.value=r),s[8]||(s[8]=r=>V.value=r)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:V.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:O(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[f(ce,{class:O(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[s[9]||(s[9]=r=>V.value=r),s[10]||(s[10]=r=>V.value=r)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:V.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:O(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",xt,[Vt,f(he,{"onUpdate:modelValue":s[11]||(s[11]=r=>A.value=r),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?1e3:A.value,class:O(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),It]),e("div",wt,[f(re,{text:"Preview",class:O(h.value==null||d.value==null?"inActive":"active"),onClick:D},null,8,["class"])])])]),f(qe,{isUploaded:Q.value,isInferred:R.value,originalVideoSrc:$.value,inferredVideoSrc:z.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const Lt=oe(Ct,[["__scopeId","data-v-38f10bf6"]]);export{Lt as default};
