import{P as se}from"./ProgressModal-59bc3b41.js";import{d as G,r as s,i as K,w as ce,o as ne,f as q,g as y,j as r,x as R,h as e,y as V,k as U,z as re,T as ve,F as z,A as pe,n as f,C as fe,_ as Y,t as W,D as me,E as ae,G as oe,p as ie,m as de,H as ge,I as _e}from"./index-c23b569b.js";import{s as O}from"./services-39e6a1b0.js";const be={id:"teleport-upload-modal",class:"contents"},ye={class:"title-area"},he={class:"original"},xe={class:"pixell-ai"},ke=["src"],Ve=["src"],Ie={key:0,class:"timeline-area"},Be={class:"video-menu-area"},Ce=G({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(I){const v=I,B=s(null),h=s(null),w=s(null),d=s(null),m=s(null),_=s(null),x=s(!1),g=s(!1),$=K("signOut"),A=s(!1),n=s(null),{isUploaded:k,isInferred:S,originalVideoSrc:M,inferredVideoSrc:D}=ce(v),F=()=>{const i="test.mp4".split(".").pop();n.value!==null&&clearTimeout(n.value),window.navigator.clipboard.writeText("copy").then(()=>{pe.get("",{responseType:"blob"}).then(o=>{console.log(o)});const t=new Blob([""],{type:`video/${i}`}),l=document.createElement("a");l.href=URL.createObjectURL(t),l.download="test",l.click(),URL.revokeObjectURL(l.href),A.value=!0,n.value=setTimeout(()=>{A.value=!1},2e3)})},X=i=>{const t=B.value;let l=!1;document.onmouseup=()=>{l=!1,g.value=!1};const o=()=>{l=!0,g.value=!0},p=C=>{if(l&&t!==null){const Q=t.getBoundingClientRect();if("pageX"in C){const P=(C.pageX-Q.left)/t.offsetWidth*100;P<100&&P>0?i.style.left=P+"%":P<=0?i.style.left="0px":P>=100&&(i.style.left="100%")}}},b=()=>{l=!1,g.value=!1};i.onmousedown=o,i.onmouseup=b,t!==null&&(t.onmousemove=p,t.onmouseout=p)},L=i=>{if(g.value){const t=B.value,l=w.value,o=m.value;if(t!==null){const p=t.getBoundingClientRect();if("pageX"in i){const b=(i.pageX-p.left)/t.offsetWidth*100;b<100&&b>0?(l.style.width=b+"%",o.style.width=100/b*100+"%",o.style.zIndex="3"):b<=0?(l.style.width="0",o.style.width="0"):b>=100&&(l.style.width="100%",o.style.width="100%")}}}},T=()=>{d.value!==null&&m.value!==null&&(d.value.paused?(d.value.play(),m.value.play(),x.value=!0):(d.value.pause(),m.value.pause(),x.value=!1))},N=i=>{d.value!==null&&m.value!==null&&(i=="forward"?(m.value.currentTime+=10,d.value.currentTime+=10):(m.value.currentTime-=10,d.value.currentTime-=10))},H=()=>{x.value=!1};return ne(()=>{const i=B.value,t=_.value;t!==null&&i!==null&&(X(t),i.addEventListener("mousemove",L,!1),i.addEventListener("mouseout",L,!1),i.addEventListener("touchstart",L,!1),i.addEventListener("touchmove",L,!1)),d.value!==null&&(d.value.addEventListener("ended",H,!1),d.value.addEventListener("timeupdate",l=>{},!1),d.value.addEventListener("seeking",l=>{d.value!==null&&console.log(Math.floor(d.value.currentTime))},!1))}),(i,t)=>{const l=q("FontAwesomeIcon");return f(),y(z,null,[r(l,{icon:"right-from-bracket",class:"sign-out-button",onClick:R($)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:B},[e("div",be,[e("div",ye,[e("div",he,[e("strong",{class:V(R(k)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",xe,[e("strong",{class:V(R(S)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:h},[R(S)?(f(),y("button",{key:0,ref_key:"draggableButton",ref:_,class:"drag-btn"},null,512)):U("",!0),e("video",{ref_key:"originalVideo",ref:d},[e("source",{src:R(M)},null,8,ke)],512),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:w},[e("video",{ref_key:"inferenceVideo",ref:m},[e("source",{src:R(D)},null,8,Ve)],512)],512),R(S)?(f(),y("button",{key:1,class:"share-btn",onClick:F},[r(ve,{name:"fade",mode:"out-in"},{default:re(()=>[A.value?(f(),y("span",{key:0,class:"copy-text",onClick:t[0]||(t[0]=fe(()=>{},["stop"]))},"copied.")):U("",!0)]),_:1})])):U("",!0)],512),R(S)?(f(),y("div",Ie,[e("div",Be,[r(l,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:t[1]||(t[1]=o=>N("backward"))}),r(l,{icon:"circle-play",class:"fa-3x play-button",onClick:T}),r(l,{icon:"play",class:"fa-3x next-button",onClick:t[2]||(t[2]=o=>N("forward"))})])])):U("",!0)])],512)],64)}}});const we=Y(Ce,[["__scopeId","data-v-e12fa026"]]),Ae="http://172.168.10.91:49090/assets/sample_video_img-8e9d2f79.png",Z=I=>(ie("data-v-a5bf2b61"),I=I(),de(),I),Se={class:"upload-modal-container"},Le={class:"contents"},Oe=Z(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),$e=Z(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Ue={class:"sample-video-area"},Ee=Z(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),Me={class:"sample-video-list"},Pe=["onClick"],Re={key:0,class:"file-name-area"},qe={class:"file-name"},De={key:1,class:"file-name-area"},Fe={class:"upload-btn-area"},Te=G({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(I,{emit:v}){const B=K("defaultInstance"),h=K("emitter"),w=s([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),d=s(0),m=s(!1),_=s(0),x=s(-1),g=s([]),$=s(!1),A=new AbortController,n=t=>{g.value.length>0?h.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):x.value=t},k=()=>{$.value=!0},S=()=>{$.value=!1},M=t=>{$.value=!0,t.preventDefault()},D=t=>{if(x.value!==-1)h.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{t.preventDefault();const l=/(\.mov|\.mp4|\.mkv)$/i;$.value=!1;const o=t.dataTransfer;if(o&&o.files){for(const p of o.files)if(!l.exec(p.name)){h.emit("update:alert",{isActive:!0,message:"mp4,mov,mkv 확장자만 지원합니다."});break}F(o.files,"drop")}}},F=(t,l)=>{let o;if(l=="change"?o=t.files:o=t,o!==null)for(let p=0;p<o.length;p++)g.value.push({title:o[p].name,file:o[p]})},X=t=>{g.value.splice(t,1)},L=t=>{if(x.value!==-1)h.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const l=t.target;l&&l.files&&F(l,"change")}},T=()=>{v("update:close")},N=()=>{v("update:abort"),A.abort()},H=()=>{Promise.all([B.get(O.videoList),B.get(O.inferenceModelList)]).then(t=>{v("update:upload",{videoList:t[0].data,inferenceModelList:t[1].data.data.filter(l=>l!==null)}),T()})},i=()=>{if(g.value.length>0){m.value=!0;const t=g.value,l=new FormData;for(let o=0;o<t.length;o++)console.log(t[o].file),l.append("file",t[o].file);B.postForm(O.upload,l,{signal:A.signal,onUploadProgress:o=>{const p=o.loaded*100/o.total;_.value=Number(p.toFixed(0)),p==100&&(m.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(o=>{console.log("output-> result",o),H()})}else h.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(t,l)=>{const o=q("FontAwesomeIcon"),p=q("BaseButton");return f(),y(z,null,[m.value?(f(),W(se,{key:0,text:"video file uploading...",progressValue:_.value,"onUpdate:closeProgressModal":N},null,8,["progressValue"])):U("",!0),e("div",Se,[e("button",{class:"close-btn",onClick:T}),e("div",Le,[e("div",{class:V(["file-upload-area",$.value?"dragged":""]),onDragenter:k,onDragover:M,onDragleave:S,onDrop:D},[e("strong",null,[me(" Drop Video File here to upload or "),Oe,(f(),y("input",{key:d.value,type:"file",id:"file-upload",accept:".mp4, .mov, .mkv",onChange:L,onClick:l[0]||(l[0]=b=>d.value+=1),multiple:""},null,32))])],34),$e,e("div",Ue,[Ee,e("ul",Me,[(f(!0),y(z,null,ae(w.value,(b,C)=>(f(),y("li",{key:C},[e("img",{onClick:Q=>n(C),src:Ae,class:V(C==x.value?"selected":"")},null,10,Pe)]))),128))])]),g.value.length>0?(f(),y("ul",Re,[(f(!0),y(z,null,ae(g.value,(b,C)=>(f(),y("li",{key:C},[e("span",qe,oe(b.file.name),1),r(o,{icon:"xmark",class:"delete-button",onClick:Q=>X(C)},null,8,["onClick"])]))),128))])):U("",!0),x.value!=-1?(f(),y("ul",De,[e("li",null,oe(w.value[x.value].name),1)])):U("",!0),e("div",Fe,[r(p,{text:"Upload",onClick:i})])])])],64)}}});const Ne=Y(Te,[["__scopeId","data-v-a5bf2b61"]]),E=I=>(ie("data-v-15e5669e"),I=I(),de(),I),je={class:"upload-area"},Xe=E(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),He={class:"row"},Je={class:"row"},Qe=E(()=>e("label",{class:"label"},"video File",-1)),ze={class:"setting-area"},Ke=E(()=>e("h2",{class:"h2-title"},"Output Setting",-1)),We={class:"row"},Ge=E(()=>e("label",{class:"label"},"AI Model",-1)),Ye={class:"row"},Ze=E(()=>e("label",{class:"label"},"Format",-1)),et={class:"row"},tt=E(()=>e("label",{class:"label"},"Encoder",-1)),lt={class:"row check-area"},at=E(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),ot={class:"row check-area"},st={class:"row"},nt=E(()=>e("label",{class:"bitrate"},"AVg.Bitrate : ",-1)),it=E(()=>e("span",{class:"unit"},"(kbps)",-1)),dt={class:"row"},ut=G({__name:"Main",setup(I){const v=K("emitter"),B=s(0),h=K("defaultInstance"),w=s([]),d=s(null),m=s([]),_=s(null),x=[{name:"mp4"},{name:"mov"},{name:"mkv"}],g=s({name:"mp4"}),$=[{name:"H.264"},{name:"H.265"},{name:"ProRes"}],A=s({name:"H.264"}),n=s([]),k=s("VBR"),S=s(!1),M=s(!1),D=s("128"),F=s(0),X=s(!1),L=s(!1),T=s(""),N=s(""),H=s("");let i;const t=u=>{d.value=null,m.value=[],w.value=[],m.value=u.inferenceModelList,w.value=u.videoList},l=()=>{Promise.all([h.get(O.videoList),h.get(O.inferenceModelList)]).then(u=>{w.value=u[0].data,m.value=u[1].data.data.filter(a=>a!==null)})},o=u=>{const a=n.value.indexOf(u);a>=0?n.value.splice(a,1):u=="best quality"?(n.value=[],n.value.push("best quality")):n.value.push(u)},p=()=>{d.value==null?v.emit("update:alert",{isActive:!0,message:"Please select a video file."}):_.value==null?v.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(v.emit("update:loading",{isLoading:!0}),h.post(O.videoInference,{videoId:d.value&&d.value.videoId,containerId:_.value.containerId,format:g.value.name,encoder:A.value.name,bestQuality:n.value.indexOf("best quality")>=0?1:0,twoPassEncoding:n.value.indexOf("best quality")>=0?0:n.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:n.value.indexOf("best quality")>=0?0:D.value,vbr:n.value.indexOf("best quality")>=0?!1:k.value=="VBR",cbr:n.value.indexOf("best quality")>=0?!1:k.value=="CBR"}).then(u=>{console.log(u),localStorage.setItem("inference",JSON.stringify({uuid:u.data.data,containerId:_.value.containerId})),H.value=u.data.data,Q(u.data.data)}))},b=()=>{i.close(),M.value=!1,L.value=!1,ee({containerId:_.value.containerId,uuid:H.value})},C=()=>{v.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{v.emit("update:loading",{isLoading:!0}),b()}})},Q=u=>{i=new EventSource(O.connectSSE+`?uuid=${u}`),i.onopen=()=>{console.log(O.connectSSE+`?uuid=${u}----connect`)},i.onmessage=a=>{try{if(typeof JSON.parse(a.data)=="object"){const j=JSON.parse(a.data);j.step=="inference"&&(M.value=!0,v.emit("update:loading",{isLoading:!1}),F.value=j.progress,j.progress==100&&(M.value=!1,v.emit("update:loading",{isLoading:!0}),h.get(O.videoDownload+`?video_id=${u}`).then(J=>{console.log("video download",J),T.value="",N.value="",i.close(),L.value=!0,localStorage.removeItem("inference"),v.emit("update:loading",{isLoading:!1})})))}}catch{}},i.onerror=a=>{console.log(a),b(),v.emit("update:loading",{isLoading:!1})}},P=u=>(u.preventDefault(),u.stopImmediatePropagation(),""),ee=u=>{v.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요."}),h.delete(O.videoInference+`?containerId=${u.containerId}&uuid=${u.uuid}`).then(a=>{console.log("삭제",a),l(),v.emit("update:loading",{isLoading:!1}),v.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),localStorage.removeItem("inference")})};return ge(()=>{window.removeEventListener("beforeunload",P)}),ne(()=>{window.addEventListener("beforeunload",P),l(),localStorage.getItem("inference")!=null&&ee(JSON.parse(localStorage.getItem("inference")))}),(u,a)=>{const j=q("BaseButton"),J=q("BaseSelect"),te=q("BaseCheckBox"),le=q("BaseRadio"),ue=q("BaseInput");return f(),y(z,null,[M.value?(f(),W(se,{key:0,text:"Inference is in progress...",progressValue:F.value,"onUpdate:closeProgressModal":C},null,8,["progressValue"])):U("",!0),e("main",null,[S.value?(f(),W(_e,{key:0,to:"#teleport-upload-modal"},[(f(),W(Ne,{key:B.value,"onUpdate:close":a[0]||(a[0]=c=>S.value=!1),"onUpdate:upload":a[1]||(a[1]=c=>t(c)),"onUpdate:abort":a[2]||(a[2]=c=>B.value+=1)}))])):U("",!0),e("aside",null,[e("section",je,[Xe,e("div",He,[r(j,{onClick:a[3]||(a[3]=c=>S.value=!0),text:"Upload Video"})]),e("div",Je,[Qe,r(J,{"onUpdate:selectBox":a[4]||(a[4]=c=>{X.value=!0,d.value=c}),name:"fileName",options:w.value,text:d.value==null?"<span class=not-selected>Please Upload Video Files</span>":d.value.fileName},null,8,["options","text"])])]),e("section",ze,[Ke,e("div",We,[Ge,r(J,{"onUpdate:selectBox":a[5]||(a[5]=c=>{_.value=c}),options:m.value,name:"projectName,modelName",text:_.value==null?"<span class=not-selected>Select AI Model</span>":_.value.projectName+"/"+_.value.modelName},null,8,["options","text"])]),e("div",Ye,[Ze,r(J,{"onUpdate:selectBox":a[6]||(a[6]=c=>g.value=c),options:x,name:"name",text:g.value.name},null,8,["text"])]),e("div",et,[tt,r(J,{"onUpdate:selectBox":a[7]||(a[7]=c=>A.value=c),options:$,name:"name",text:A.value.name},null,8,["text"])]),e("div",lt,[e("div",null,[r(te,{"onUpdate:checkModelValue":o,id:"BestQuality",value:"best quality"}),at]),e("div",null,[e("span",{class:V(["check-box",n.value.indexOf("best quality")<0?"active":"inActive"])},[r(te,{"onUpdate:checkModelValue":o,id:n.value.indexOf("best quality")<0?"2PassEncoding":"",value:"2-Pass Encoding"},null,8,["id"])],2),e("label",{for:"2PassEncoding",class:V(n.value.indexOf("best quality")<0?"active":"inActive")},"2-Pass Encoding",2)])]),e("div",ot,[e("div",null,[r(le,{class:V(["radio",n.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[a[8]||(a[8]=c=>k.value=c),a[9]||(a[9]=c=>k.value=c)],name:"vbrOrCbr",value:"VBR",isDisabled:!(n.value.indexOf("best quality")<0),modelValue:k.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:V(n.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[r(le,{class:V(["radio",n.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[a[10]||(a[10]=c=>k.value=c),a[11]||(a[11]=c=>k.value=c)],name:"vbrOrCbr",value:"CBR",isDisabled:!(n.value.indexOf("best quality")<0),modelValue:k.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:V(n.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",st,[nt,r(ue,{"onUpdate:modelValue":a[12]||(a[12]=c=>D.value=c),placeholder:"",type:"text",onlyText:!0,modelValue:n.value.indexOf("best quality")>=0?0:D.value,class:V(n.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(n.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),it]),e("div",dt,[r(j,{text:"Preview",class:V(d.value==null||_.value==null?"inActive":"active"),onClick:p},null,8,["class"])])])]),r(we,{isUploaded:X.value,isInferred:L.value,originalVideoSrc:T.value,inferredVideoSrc:N.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const pt=Y(ut,[["__scopeId","data-v-15e5669e"]]);export{pt as default};
