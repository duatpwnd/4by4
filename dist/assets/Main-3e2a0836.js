import{d as oe,r as l,v as Ae,o as fe,f as F,g as m,h as e,w as O,x as L,y as me,z as Se,j as f,A as ae,T as pe,k as U,m as c,C as se,_ as ne,i as G,q as te,D as _e,F as j,E as le,G as Y,p as ge,l as ye,c as $e,H as Le,I as Oe,J as Ue,K as Ee}from"./index-5e7de735.js";import{P as be,e as Me}from"./eventsource-d4af02ea.js";import{s as T}from"./services-b33b6e54.js";const Pe={id:"teleport-upload-modal",class:"contents"},De={class:"title-area"},Re={class:"original"},Fe={class:"pixell-ai"},Te=["src"],Ne=["src"],qe={key:0,class:"timeline-area"},He={class:"video-menu-area"},ze=oe({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(C){const p=C,S=l(null),E=l(null),q=l(null),v=l(null),_=l(null),h=l(null),y=l(!1),d=l(!1),B=l(!1),x=l(!1),M=l(null),i=l(null),{isUploaded:V,isInferred:I,originalVideoSrc:P,inferredVideoSrc:A}=Ae(p),J=()=>{M.value!==null&&clearTimeout(M.value),window.navigator.clipboard.writeText(A.value).then(()=>{B.value=!0,M.value=setTimeout(()=>{B.value=!1},2e3)})},Q=()=>{i.value!==null&&clearTimeout(i.value);const a=document.createElement("a");a.href=A.value,a.download=A.value,a.click(),x.value=!0,i.value=setTimeout(()=>{x.value=!1},2e3)},D=a=>{const t=S.value;console.log(t);let o=!1;document.onmouseup=()=>{o=!1,d.value=!1};const g=()=>{o=!0,d.value=!0},b=W=>{if(o&&t!==null){const X=t.getBoundingClientRect();if("pageX"in W){const R=(W.pageX-X.left)/t.offsetWidth*100;R<100&&R>0?a.style.left=R+"%":R<=0?a.style.left="0px":R>=100&&(a.style.left="100%")}}},k=()=>{o=!1,d.value=!1};a.onmousedown=g,a.onmouseup=k,t!==null&&(t.onmousemove=b,t.onmouseout=b)},$=a=>{if(d.value){const t=S.value,o=q.value,g=_.value;if(t!==null){const b=t.getBoundingClientRect();if("pageX"in a){const k=(a.pageX-b.left)/t.offsetWidth*100;k<100&&k>0?(o.style.width=k+"%",g.style.width=100/k*100+"%",g.style.zIndex="3"):k<=0?(o.style.width="0",g.style.width="0"):k>=100&&(o.style.width="100%",g.style.width="100%")}}}},H=()=>{v.value!==null&&_.value!==null&&(v.value.paused?(v.value.play(),_.value.play(),y.value=!0):(v.value.pause(),_.value.pause(),y.value=!1))},z=a=>{v.value!==null&&_.value!==null&&(a=="forward"?(_.value.currentTime+=10,v.value.currentTime+=10):(_.value.currentTime-=10,v.value.currentTime-=10))},u=()=>{y.value=!1};return fe(()=>{const a=S.value,t=h.value;t!==null&&a!==null&&(D(t),a.addEventListener("mousemove",$,!1),a.addEventListener("mouseout",$,!1),a.addEventListener("touchstart",$,!1),a.addEventListener("touchmove",$,!1)),v.value!==null&&(v.value.addEventListener("ended",u,!1),v.value.addEventListener("timeupdate",o=>{},!1),v.value.addEventListener("seeking",o=>{v.value!==null&&console.log(Math.floor(v.value.currentTime))},!1))}),(a,t)=>{const o=F("FontAwesomeIcon");return c(),m("div",{class:"video-container",ref_key:"videoContainerRef",ref:S},[e("div",Pe,[e("div",De,[e("div",Re,[e("strong",{class:O(L(V)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",Fe,[e("strong",{class:O(L(I)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:E},[me(e("button",{ref_key:"draggableButton",ref:h,class:"drag-btn"},null,512),[[Se,L(I)]]),e("video",{ref_key:"originalVideo",ref:v,src:L(P)},null,8,Te),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:q},[e("video",{ref_key:"inferenceVideo",ref:_,src:L(A)},null,8,Ne)],512),L(I)?(c(),m("button",{key:0,class:"share-btn",onClick:J},[f(pe,{name:"fade",mode:"out-in"},{default:ae(()=>[B.value?(c(),m("span",{key:0,class:"copy-text",onClick:t[0]||(t[0]=se(()=>{},["stop"]))},"copy")):U("",!0)]),_:1})])):U("",!0),L(I)?(c(),m("button",{key:1,class:"download-btn",onClick:Q},[f(pe,{name:"fade",mode:"out-in"},{default:ae(()=>[x.value?(c(),m("span",{key:0,class:"download-text",onClick:t[1]||(t[1]=se(()=>{},["stop"]))},"download")):U("",!0)]),_:1})])):U("",!0)],512),L(I)?(c(),m("div",qe,[e("div",He,[f(o,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:t[2]||(t[2]=g=>z("backward"))}),f(o,{icon:"circle-play",class:"fa-3x play-button",onClick:H}),f(o,{icon:"play",class:"fa-3x next-button",onClick:t[3]||(t[3]=g=>z("forward"))})])])):U("",!0)])],512)}}});const Xe=ne(ze,[["__scopeId","data-v-3ca2e580"]]),Je="http://222.107.124.161:64000/assets/sample_video_img-8e9d2f79.png",ie=C=>(ge("data-v-e7ebe5a6"),C=C(),ye(),C),Qe={class:"upload-modal-container"},We={class:"contents"},je=ie(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),Ke=ie(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Ge={class:"sample-video-area"},Ye=ie(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),Ze={class:"sample-video-list"},et=["onClick"],tt={key:0,class:"file-name-area"},lt={class:"file-name"},at={key:1,class:"file-name-area"},st={class:"upload-btn-area"},ot=oe({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(C,{emit:p}){const S=G("defaultInstance"),E=G("emitter"),q=l([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),v=l(0),_=l(!1),h=l(0),y=l(-1),d=l([]),B=l(!1),x=new AbortController,M=u=>{d.value.length>0?E.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):y.value=u},i=()=>{B.value=!0},V=()=>{B.value=!1},I=u=>{B.value=!0,u.preventDefault()},P=u=>{if(y.value!==-1)E.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{u.preventDefault();const a=/\.mp4$/i;B.value=!1;const t=u.dataTransfer;if(t&&t.files)for(const o of t.files)if(a.test(o.name))A(t.files,"drop");else{E.emit("update:alert",{isActive:!0,message:"mp4 확장자만 지원합니다."});break}}},A=(u,a)=>{let t;if(a=="change"?t=u.files:t=u,t!==null)for(let o=0;o<t.length;o++){/\.mp4$/i.test(t[o].name)&&d.value.push({title:t[o].name,file:t[o]});const b=d.value.filter((k,W,X)=>W===X.findIndex(R=>R.title===k.title));d.value=b}},J=u=>{d.value.splice(u,1)},Q=u=>{if(y.value!==-1)E.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const a=u.target;a&&a.files&&A(a,"change")}},D=()=>{p("update:close")},$=()=>{p("update:abort"),x.abort()},H=()=>{Promise.all([S.get(T.videoList),S.get(T.inferenceModelList)]).then(u=>{p("update:upload",{videoList:u[0].data,inferenceModelList:u[1].data.data.filter(a=>a!==null)}),D()})},z=()=>{if(d.value.length>0){_.value=!0;const u=d.value,a=new FormData;for(let t=0;t<u.length;t++)console.log(u[t].file),a.append("file",u[t].file);S.postForm(T.upload,a,{signal:x.signal,onUploadProgress:t=>{const o=t.loaded*100/t.total;h.value=Number(o.toFixed(0)),o==100&&(_.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(t=>{console.log("output-> result",t),H()})}else E.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(u,a)=>{const t=F("FontAwesomeIcon"),o=F("BaseButton");return c(),m(j,null,[_.value?(c(),te(be,{key:0,text:"video file uploading...",progressValue:h.value,"onUpdate:closeProgressModal":$},null,8,["progressValue"])):U("",!0),e("div",Qe,[e("button",{class:"close-btn",onClick:D}),e("div",We,[e("div",{class:O(["file-upload-area",B.value?"dragged":""]),onDragenter:i,onDragover:I,onDragleave:V,onDrop:P},[e("strong",null,[_e(" Drop Video File here to upload or "),je,(c(),m("input",{key:v.value,type:"file",id:"file-upload",accept:".mp4",onChange:Q,onClick:a[0]||(a[0]=g=>v.value+=1),multiple:""},null,32))])],34),Ke,e("div",Ge,[Ye,e("ul",Ze,[(c(!0),m(j,null,le(q.value,(g,b)=>(c(),m("li",{key:b},[e("img",{onClick:k=>M(b),src:Je,class:O(b==y.value?"selected":"")},null,10,et)]))),128))])]),d.value.length>0?(c(),m("ul",tt,[(c(!0),m(j,null,le(d.value,(g,b)=>(c(),m("li",{key:b},[e("span",lt,Y(g.file.name),1),f(t,{icon:"xmark",class:"delete-button",onClick:k=>J(b)},null,8,["onClick"])]))),128))])):U("",!0),y.value!=-1?(c(),m("ul",at,[e("li",null,Y(q.value[y.value].name),1)])):U("",!0),e("div",st,[f(o,{text:"Upload",onClick:z})])])])],64)}}});const nt=ne(ot,[["__scopeId","data-v-e7ebe5a6"]]),N=C=>(ge("data-v-2538c711"),C=C(),ye(),C),it={class:"upload-area"},ut=N(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),dt={class:"row"},rt={class:"row video-file-select-area"},ct=N(()=>e("label",{class:"label"},"Video File",-1)),vt={class:"date"},pt=["onClick","onMouseenter"],ft={class:"file-size"},mt={class:"setting-area"},_t=N(()=>e("h2",{class:"h2-title"},"Output Settings",-1)),gt={class:"row"},yt=N(()=>e("label",{class:"label"},"AI Model",-1)),bt={class:"row"},ht=N(()=>e("label",{class:"label"},"Format",-1)),kt={class:"row"},xt=N(()=>e("label",{class:"label"},"Encoder",-1)),Vt={class:"row check-area"},It=N(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),wt={class:"row check-area"},Ct={class:"row"},Bt=N(()=>e("label",{class:"bitrate"},"Bitrate : ",-1)),At=N(()=>e("span",{class:"unit"},"(kbps)",-1)),St={class:"row"},$t=oe({__name:"Main",setup(C){const p=G("emitter"),S=G("signOut"),E=$e(),q=l(0),v=G("defaultInstance"),_=l([]),h=l(null),y=l([]),d=l(null),B=[{name:"mp4"},{name:"mov"},{name:"mkv"}],x=l({name:"mp4"}),M=l({name:"H.264",value:"H.264"}),i=l([]),V=l("VBR"),I=l(!1),P=l(!1),A=l("1000"),J=l(0),Q=l(!1),D=l(!1),$=l(""),H=l(""),z=l(""),u=l(""),a=Le(()=>{const n=[{name:"H.264",value:"H.264"},{name:"H.265",value:"H.265"},{name:"ProRes(Unable to play video)",value:"ProRes"}];return(x.value.name=="mp4"||x.value.name=="mov")&&(n[2].disabled=!0),n}),t=l(-1),o=l(null);let g;const b=n=>{_.value.length==0&&(p.emit("update:alert",{isActive:!0,message:"Please upload your video files."}),n.stopPropagation())},k=n=>{h.value=null,y.value=[],_.value=[],y.value=n.inferenceModelList,_.value=n.videoList},W=n=>{p.emit("update:alert",{isActive:!0,message:"삭제하시겠습니까?",fn:()=>{p.emit("update:loading",{isLoading:!0}),v.delete(T.video+`?videoId=${n}`).then(s=>{p.emit("update:loading",{isLoading:!1}),X()})}})},X=()=>{Promise.all([v.get(T.videoList),v.get(T.inferenceModelList)]).then(n=>{_.value=n[0].data,y.value=n[1].data.data.filter(s=>s!==null)})},R=n=>{const s=i.value.indexOf(n);s>=0?i.value.splice(s,1):n=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(n)},he=()=>{h.value==null?p.emit("update:alert",{isActive:!0,message:"Please select a video file."}):d.value==null?p.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(I.value=!1,D.value=!1,$.value="",H.value="",p.emit("update:loading",{isLoading:!0}),v.post(T.videoInference,{videoId:h.value&&h.value.videoId,containerId:d.value.containerId,format:x.value.name,encoder:M.value.value,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?"1000":A.value,vbr:i.value.indexOf("best quality")>=0?!1:V.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:V.value=="CBR"}).then(n=>{sessionStorage.setItem("inference",JSON.stringify({uuid:n.data.data,containerId:d.value.containerId})),z.value=n.data.data,xe(n.data.data)}))},ue=()=>{g.close(),P.value=!1,D.value=!1,re({containerId:d.value.containerId,uuid:z.value})},ke=()=>{p.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{ue()}})},xe=n=>{g=new Me.EventSourcePolyfill("http://222.107.124.161:64000"+T.connectSSE+`?uuid=${n}`,{headers:{Authorization:E.user.token}}),g.onopen=()=>{p.emit("update:loading",{isLoading:!1})},g.onmessage=s=>{try{if(typeof JSON.parse(s.data)=="object"){const w=JSON.parse(s.data);u.value=w.step,J.value=w.progress,P.value=!0,w.status=="error"&&ue(),w.step=="all"&&w.progress==100&&w.result=="true"&&(g.close(),P.value=!1,sessionStorage.removeItem("inference"),p.emit("update:loading",{isLoading:!0}),$.value=w.originalVideo,H.value=w.inferenceVideo,D.value=!0,p.emit("update:loading",{isLoading:!1}))}}catch{}}},de=n=>{if(P.value)return n.preventDefault(),n.stopImmediatePropagation(),""},re=n=>{p.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요.&nbsp;&nbsp;<div class='loader'></div>"}),v.delete(T.videoInference+`?containerId=${n.containerId}&uuid=${n.uuid}`).then(s=>{X(),p.emit("update:loading",{isLoading:!1}),p.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),setTimeout(()=>{p.emit("update:alert",{isActive:!1})},2e3),sessionStorage.removeItem("inference")})};return Oe(()=>{window.removeEventListener("beforeunload",de)}),fe(()=>{window.addEventListener("beforeunload",de),X(),sessionStorage.getItem("inference")!=null&&re(JSON.parse(sessionStorage.getItem("inference")))}),(n,s)=>{const w=F("FontAwesomeIcon"),ce=F("BaseButton"),Z=F("BaseSelect"),Ve=F("BaseCheckBox"),ve=F("BaseRadio"),Ie=F("BaseInput"),we=Ue("tooltip");return c(),m(j,null,[P.value?(c(),te(be,{key:0,text:u.value+" in_progress...",progressValue:J.value,"onUpdate:closeProgressModal":ke},null,8,["text","progressValue"])):U("",!0),e("main",null,[I.value?(c(),te(Ee,{key:0,to:"#teleport-upload-modal"},[(c(),te(nt,{key:q.value,"onUpdate:close":s[0]||(s[0]=r=>I.value=!1),"onUpdate:upload":s[1]||(s[1]=r=>k(r)),"onUpdate:abort":s[2]||(s[2]=r=>q.value+=1)}))])):U("",!0),e("aside",null,[e("section",it,[ut,f(w,{icon:"right-from-bracket",class:"sign-out-button",onClick:L(S)},null,8,["onClick"]),e("div",dt,[f(ce,{onClick:s[3]||(s[3]=r=>I.value=!0),text:"Upload Video"})]),e("div",rt,[ct,f(Z,{onClick:b,name:"fileName",options:_.value,text:h.value==null?"<span class=not-selected>Please Upload Video Files</span>":h.value.fileName},{list:ae(()=>[(c(!0),m(j,null,le(_.value,(r,Ce)=>(c(),m("li",{class:"optionItem",key:Ce},[e("span",vt,Y(r.date),1),(c(!0),m(j,null,le(r.video,(K,ee)=>(c(),m("div",{class:"file-name-area",onClick:Be=>{Q.value=!0,h.value=K},onMouseenter:()=>{o.value&&o.value[ee].offsetWidth<o.value[ee].scrollWidth&&(t.value=ee)}},[me((c(),m("span",{class:"file-name",ref_for:!0,ref_key:"fileName",ref:o},[_e(Y(K.fileName),1)])),[[we,{content:t.value==ee?K.fileName:"",placement:"bottom",delay:0}]]),e("span",null,[e("span",ft,Y(K.fileSize),1),f(w,{icon:"xmark",class:"delete-button",onClick:se(Be=>W(K.videoId),["stop"])},null,8,["onClick"])])],40,pt))),256))]))),128))]),_:1},8,["options","text"])])]),e("section",mt,[_t,e("div",gt,[yt,f(Z,{"onUpdate:selectBox":s[4]||(s[4]=r=>{d.value=r}),options:y.value,name:"projectName,modelName",text:d.value==null?"<span class=not-selected>Select AI Model</span>":d.value.projectName+"/"+d.value.modelName},null,8,["options","text"])]),e("div",bt,[ht,f(Z,{"onUpdate:selectBox":s[5]||(s[5]=r=>x.value=r),options:B,name:"name",text:x.value.name},null,8,["text"])]),e("div",kt,[xt,f(Z,{"onUpdate:selectBox":s[6]||(s[6]=r=>{r.disabled&&L(p).emit("update:alert",{isActive:!0,message:"Unable to play video"}),M.value=r}),options:a.value,name:"name",text:M.value.name},null,8,["options","text"])]),e("div",Vt,[e("div",null,[f(Ve,{"onUpdate:checkModelValue":R,id:"BestQuality",value:"best quality"}),It])]),e("div",wt,[e("div",null,[f(ve,{class:O(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[s[7]||(s[7]=r=>V.value=r),s[8]||(s[8]=r=>V.value=r)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:V.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:O(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[f(ve,{class:O(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[s[9]||(s[9]=r=>V.value=r),s[10]||(s[10]=r=>V.value=r)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:V.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:O(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",Ct,[Bt,f(Ie,{"onUpdate:modelValue":s[11]||(s[11]=r=>A.value=r),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?1e3:A.value,class:O(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),At]),e("div",St,[f(ce,{text:"Preview",class:O(h.value==null||d.value==null?"inActive":"active"),onClick:he},null,8,["class"])])])]),f(Xe,{isUploaded:Q.value,isInferred:D.value,originalVideoSrc:$.value,inferredVideoSrc:H.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const Et=ne($t,[["__scopeId","data-v-2538c711"]]);export{Et as default};
