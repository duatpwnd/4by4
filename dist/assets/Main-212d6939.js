import{P as ie}from"./ProgressModal-011a5716.js";import{d as te,r as a,i as z,w as ye,o as ue,f as M,g as y,j as f,x as F,h as e,y as E,z as be,A as he,C as de,T as ke,k as q,F as j,n as v,D as xe,_ as le,t as W,E as Ve,G,H as Y,p as ce,m as re,I as Ie,J as Ce,K as we}from"./index-aaf701c1.js";import{s as U}from"./services-eb80de62.js";const Be={id:"teleport-upload-modal",class:"contents"},Ae={class:"title-area"},Se={class:"original"},$e={class:"pixell-ai"},Le=["src"],Oe=["src"],Ue={key:0,class:"timeline-area"},Ee={class:"video-menu-area"},Me=te({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(B){const r=B,A=a(null),k=a(null),V=a(null),u=a(null),g=a(null),b=a(null),I=a(!1),p=a(!1),S=z("signOut"),i=a(!1),h=a(null),{isUploaded:N,isInferred:C,originalVideoSrc:T,inferredVideoSrc:$}=ye(r),H=()=>{$.value.split(".").pop(),h.value!==null&&clearTimeout(h.value),console.log($.value),window.navigator.clipboard.writeText($.value).then(()=>{const d=document.createElement("a");d.href=$.value,d.download=$.value,d.click(),i.value=!0,h.value=setTimeout(()=>{i.value=!1},2e3)})},R=d=>{const t=A.value;console.log(t);let o=!1;document.onmouseup=()=>{o=!1,p.value=!1};const s=()=>{o=!0,p.value=!0},m=x=>{if(o&&t!==null){const J=t.getBoundingClientRect();if("pageX"in x){const L=(x.pageX-J.left)/t.offsetWidth*100;L<100&&L>0?d.style.left=L+"%":L<=0?d.style.left="0px":L>=100&&(d.style.left="100%")}}},_=()=>{o=!1,p.value=!1};d.onmousedown=s,d.onmouseup=_,t!==null&&(t.onmousemove=m,t.onmouseout=m)},O=d=>{if(p.value){const t=A.value,o=V.value,s=g.value;if(t!==null){const m=t.getBoundingClientRect();if("pageX"in d){const _=(d.pageX-m.left)/t.offsetWidth*100;_<100&&_>0?(o.style.width=_+"%",s.style.width=100/_*100+"%",s.style.zIndex="3"):_<=0?(o.style.width="0",s.style.width="0"):_>=100&&(o.style.width="100%",s.style.width="100%")}}}},D=()=>{u.value!==null&&g.value!==null&&(u.value.paused?(u.value.play(),g.value.play(),I.value=!0):(u.value.pause(),g.value.pause(),I.value=!1))},X=d=>{u.value!==null&&g.value!==null&&(d=="forward"?(g.value.currentTime+=10,u.value.currentTime+=10):(g.value.currentTime-=10,u.value.currentTime-=10))},Q=()=>{I.value=!1};return ue(()=>{const d=A.value,t=b.value;t!==null&&d!==null&&(R(t),d.addEventListener("mousemove",O,!1),d.addEventListener("mouseout",O,!1),d.addEventListener("touchstart",O,!1),d.addEventListener("touchmove",O,!1)),u.value!==null&&(u.value.addEventListener("ended",Q,!1),u.value.addEventListener("timeupdate",o=>{},!1),u.value.addEventListener("seeking",o=>{u.value!==null&&console.log(Math.floor(u.value.currentTime))},!1))}),(d,t)=>{const o=M("FontAwesomeIcon");return v(),y(j,null,[f(o,{icon:"right-from-bracket",class:"sign-out-button",onClick:F(S)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:A},[e("div",Be,[e("div",Ae,[e("div",Se,[e("strong",{class:E(F(N)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",$e,[e("strong",{class:E(F(C)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:k},[be(e("button",{ref_key:"draggableButton",ref:b,class:"drag-btn"},null,512),[[he,F(C)]]),e("video",{ref_key:"originalVideo",ref:u,src:F(T)},null,8,Le),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:V},[e("video",{ref_key:"inferenceVideo",ref:g,src:F($)},null,8,Oe)],512),F(C)?(v(),y("button",{key:0,class:"share-btn",onClick:H},[f(ke,{name:"fade",mode:"out-in"},{default:de(()=>[i.value?(v(),y("span",{key:0,class:"copy-text",onClick:t[0]||(t[0]=xe(()=>{},["stop"]))},"download and copy")):q("",!0)]),_:1})])):q("",!0)],512),F(C)?(v(),y("div",Ue,[e("div",Ee,[f(o,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:t[1]||(t[1]=s=>X("backward"))}),f(o,{icon:"circle-play",class:"fa-3x play-button",onClick:D}),f(o,{icon:"play",class:"fa-3x next-button",onClick:t[2]||(t[2]=s=>X("forward"))})])])):q("",!0)])],512)],64)}}});const Pe=le(Me,[["__scopeId","data-v-aaf53aee"]]),Re="http://222.107.124.161:64000/assets/sample_video_img-8e9d2f79.png",ae=B=>(ce("data-v-e55f1bc4"),B=B(),re(),B),De={class:"upload-modal-container"},Fe={class:"contents"},qe=ae(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),Ne=ae(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Te={class:"sample-video-area"},He=ae(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),Xe={class:"sample-video-list"},Je=["onClick"],je={key:0,class:"file-name-area"},Qe={class:"file-name"},ze={key:1,class:"file-name-area"},Ke={class:"upload-btn-area"},We=te({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(B,{emit:r}){const A=z("defaultInstance"),k=z("emitter"),V=a([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),u=a(0),g=a(!1),b=a(0),I=a(-1),p=a([]),S=a(!1),i=new AbortController,h=t=>{p.value.length>0?k.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):I.value=t},N=()=>{S.value=!0},C=()=>{S.value=!1},T=t=>{S.value=!0,t.preventDefault()},$=t=>{if(I.value!==-1)k.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{t.preventDefault();const o=/(\.mov|\.mp4|\.mkv)$/i;S.value=!1;const s=t.dataTransfer;if(s&&s.files){for(const m of s.files)if(!o.exec(m.name)){k.emit("update:alert",{isActive:!0,message:"mp4,mov,mkv 확장자만 지원합니다."});break}H(s.files,"drop")}}},H=(t,o)=>{let s;if(o=="change"?s=t.files:s=t,s!==null)for(let m=0;m<s.length;m++){p.value.push({title:s[m].name,file:s[m]});const _=p.value.filter((x,J,L)=>J===L.findIndex(Z=>Z.title===x.title));p.value=_}},R=t=>{p.value.splice(t,1)},O=t=>{if(I.value!==-1)k.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const o=t.target;o&&o.files&&H(o,"change")}},D=()=>{r("update:close")},X=()=>{r("update:abort"),i.abort()},Q=()=>{Promise.all([A.get(U.videoList),A.get(U.inferenceModelList)]).then(t=>{r("update:upload",{videoList:t[0].data,inferenceModelList:t[1].data.data.filter(o=>o!==null)}),D()})},d=()=>{if(p.value.length>0){g.value=!0;const t=p.value,o=new FormData;for(let s=0;s<t.length;s++)console.log(t[s].file),o.append("file",t[s].file);A.postForm(U.upload,o,{signal:i.signal,onUploadProgress:s=>{const m=s.loaded*100/s.total;b.value=Number(m.toFixed(0)),m==100&&(g.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(s=>{console.log("output-> result",s),Q()})}else k.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(t,o)=>{const s=M("FontAwesomeIcon"),m=M("BaseButton");return v(),y(j,null,[g.value?(v(),W(ie,{key:0,text:"video file uploading...",progressValue:b.value,"onUpdate:closeProgressModal":X},null,8,["progressValue"])):q("",!0),e("div",De,[e("button",{class:"close-btn",onClick:D}),e("div",Fe,[e("div",{class:E(["file-upload-area",S.value?"dragged":""]),onDragenter:N,onDragover:T,onDragleave:C,onDrop:$},[e("strong",null,[Ve(" Drop Video File here to upload or "),qe,(v(),y("input",{key:u.value,type:"file",id:"file-upload",accept:".mp4, .mov, .mkv",onChange:O,onClick:o[0]||(o[0]=_=>u.value+=1),multiple:""},null,32))])],34),Ne,e("div",Te,[He,e("ul",Xe,[(v(!0),y(j,null,G(V.value,(_,x)=>(v(),y("li",{key:x},[e("img",{onClick:J=>h(x),src:Re,class:E(x==I.value?"selected":"")},null,10,Je)]))),128))])]),p.value.length>0?(v(),y("ul",je,[(v(!0),y(j,null,G(p.value,(_,x)=>(v(),y("li",{key:x},[e("span",Qe,Y(_.file.name),1),f(s,{icon:"xmark",class:"delete-button",onClick:J=>R(x)},null,8,["onClick"])]))),128))])):q("",!0),I.value!=-1?(v(),y("ul",ze,[e("li",null,Y(V.value[I.value].name),1)])):q("",!0),e("div",Ke,[f(m,{text:"Upload",onClick:d})])])])],64)}}});const Ge=le(We,[["__scopeId","data-v-e55f1bc4"]]),P=B=>(ce("data-v-c2e5c54a"),B=B(),re(),B),Ye={class:"upload-area"},Ze=P(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),et={class:"row"},tt={class:"row video-file-select-area"},lt=P(()=>e("label",{class:"label"},"video File",-1)),at={class:"date"},st={class:"file-name-area"},ot=["onClick"],nt={class:"setting-area"},it=P(()=>e("h2",{class:"h2-title"},"Output Setting",-1)),ut={class:"row"},dt=P(()=>e("label",{class:"label"},"AI Model",-1)),ct={class:"row"},rt=P(()=>e("label",{class:"label"},"Format",-1)),vt={class:"row"},pt=P(()=>e("label",{class:"label"},"Encoder",-1)),ft={class:"row check-area"},mt=P(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),_t={class:"row check-area"},gt={class:"row"},yt=P(()=>e("label",{class:"bitrate"},"Bitrate : ",-1)),bt=P(()=>e("span",{class:"unit"},"(kbps)",-1)),ht={class:"row"},kt=te({__name:"Main",setup(B){const r=z("emitter"),A=a(0),k=z("defaultInstance"),V=a([]),u=a(null),g=a([]),b=a(null),I=[{name:"mp4"},{name:"mov"},{name:"mkv"}],p=a({name:"mp4"}),S=a({name:"H.264",value:"H.264"}),i=a([]),h=a("VBR"),N=a(!1),C=a(!1),T=a("1000"),$=a(0),H=a(!1),R=a(!1),O=a(""),D=a(""),X=a(""),Q=a(""),d=Ie(()=>{const n=[{name:"H.264",value:"H.264"},{name:"H.265",value:"H.265"},{name:"ProRes(Unable to play video)",value:"ProRes"}];return(p.value.name=="mp4"||p.value.name=="mov")&&(n[2].disabled=!0),n});let t;const o=n=>{V.value.length==0&&(r.emit("update:alert",{isActive:!0,message:"Please upload your video files."}),n.stopPropagation())},s=n=>{u.value=null,g.value=[],V.value=[],g.value=n.inferenceModelList,V.value=n.videoList},m=n=>{r.emit("update:alert",{isActive:!0,message:"삭제하시겠습니까?",fn:()=>{console.log("삭제api"),r.emit("update:loading",{isLoading:!0}),k.delete(U.video+`?videoId=${n}`).then(l=>{console.log(l),r.emit("update:loading",{isLoading:!1}),_()})}})},_=()=>{Promise.all([k.get(U.videoList),k.get(U.inferenceModelList)]).then(n=>{V.value=n[0].data,g.value=n[1].data.data.filter(l=>l!==null)})},x=n=>{const l=i.value.indexOf(n);l>=0?i.value.splice(l,1):n=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(n)},J=()=>{u.value==null?r.emit("update:alert",{isActive:!0,message:"Please select a video file."}):b.value==null?r.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(R.value=!1,O.value="",D.value="",r.emit("update:loading",{isLoading:!0}),k.post(U.videoInference,{videoId:u.value&&u.value.videoId,containerId:b.value.containerId,format:p.value.name,encoder:S.value.value,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?"1000":T.value,vbr:i.value.indexOf("best quality")>=0?!1:h.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:h.value=="CBR"}).then(n=>{console.log(n),sessionStorage.setItem("inference",JSON.stringify({uuid:n.data.data,containerId:b.value.containerId})),X.value=n.data.data,ve(n.data.data)}))},L=()=>{t.close(),C.value=!1,R.value=!1,oe({containerId:b.value.containerId,uuid:X.value})},Z=()=>{r.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{r.emit("update:loading",{isLoading:!0}),L()}})},ve=n=>{t=new EventSource(U.connectSSE+`?uuid=${n}`),t.onopen=()=>{r.emit("update:loading",{isLoading:!1}),console.log(U.connectSSE+`?uuid=${n}----connect`)},t.onmessage=l=>{try{if(typeof JSON.parse(l.data)=="object"){const w=JSON.parse(l.data);Q.value=w.step,$.value=w.progress,C.value=!0,w.status=="error"&&L(),w.step=="all"&&w.progress==100&&w.result=="true"&&(t.close(),C.value=!1,sessionStorage.removeItem("inference"),r.emit("update:loading",{isLoading:!0}),O.value=w.originalVideo,D.value=w.inferenceVideo,R.value=!0,r.emit("update:loading",{isLoading:!1}))}}catch{}},t.onerror=l=>{console.log(l),L()}},se=n=>{if(C.value)return n.preventDefault(),n.stopImmediatePropagation(),""},oe=n=>{r.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요."}),k.delete(U.videoInference+`?containerId=${n.containerId}&uuid=${n.uuid}`).then(l=>{console.log("삭제",l),_(),r.emit("update:loading",{isLoading:!1}),r.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),sessionStorage.removeItem("inference")})};return Ce(()=>{window.removeEventListener("beforeunload",se)}),ue(()=>{window.addEventListener("beforeunload",se),_(),sessionStorage.getItem("inference")!=null&&oe(JSON.parse(sessionStorage.getItem("inference")))}),(n,l)=>{const w=M("BaseButton"),pe=M("FontAwesomeIcon"),K=M("BaseSelect"),fe=M("BaseCheckBox"),ne=M("BaseRadio"),me=M("BaseInput");return v(),y(j,null,[C.value?(v(),W(ie,{key:0,text:Q.value+" in_progress...",progressValue:$.value,"onUpdate:closeProgressModal":Z},null,8,["text","progressValue"])):q("",!0),e("main",null,[N.value?(v(),W(we,{key:0,to:"#teleport-upload-modal"},[(v(),W(Ge,{key:A.value,"onUpdate:close":l[0]||(l[0]=c=>N.value=!1),"onUpdate:upload":l[1]||(l[1]=c=>s(c)),"onUpdate:abort":l[2]||(l[2]=c=>A.value+=1)}))])):q("",!0),e("aside",null,[e("section",Ye,[Ze,e("div",et,[f(w,{onClick:l[3]||(l[3]=c=>N.value=!0),text:"Upload Video"})]),e("div",tt,[lt,f(K,{onClick:o,name:"fileName",options:V.value,text:u.value==null?"<span class=not-selected>Please Upload Video Files</span>":u.value.fileName},{list:de(()=>[(v(!0),y(j,null,G(V.value,(c,_e)=>(v(),y("li",{class:"optionItem",key:_e},[e("span",at,Y(c.date),1),(v(!0),y(j,null,G(c.video,ee=>(v(),y("div",st,[e("span",{class:"file-name",onClick:ge=>{H.value=!0,u.value=ee}},Y(ee.fileName),9,ot),f(pe,{icon:"xmark",class:"delete-button",onClick:ge=>m(ee.videoId)},null,8,["onClick"])]))),256))]))),128))]),_:1},8,["options","text"])])]),e("section",nt,[it,e("div",ut,[dt,f(K,{"onUpdate:selectBox":l[4]||(l[4]=c=>{b.value=c}),options:g.value,name:"projectName,modelName",text:b.value==null?"<span class=not-selected>Select AI Model</span>":b.value.projectName+"/"+b.value.modelName},null,8,["options","text"])]),e("div",ct,[rt,f(K,{"onUpdate:selectBox":l[5]||(l[5]=c=>p.value=c),options:I,name:"name",text:p.value.name},null,8,["text"])]),e("div",vt,[pt,f(K,{"onUpdate:selectBox":l[6]||(l[6]=c=>S.value=c),options:d.value,name:"name",text:S.value.name},null,8,["options","text"])]),e("div",ft,[e("div",null,[f(fe,{"onUpdate:checkModelValue":x,id:"BestQuality",value:"best quality"}),mt])]),e("div",_t,[e("div",null,[f(ne,{class:E(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[l[7]||(l[7]=c=>h.value=c),l[8]||(l[8]=c=>h.value=c)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:h.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:E(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[f(ne,{class:E(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[l[9]||(l[9]=c=>h.value=c),l[10]||(l[10]=c=>h.value=c)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:h.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:E(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",gt,[yt,f(me,{"onUpdate:modelValue":l[11]||(l[11]=c=>T.value=c),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?1e3:T.value,class:E(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),bt]),e("div",ht,[f(w,{text:"Preview",class:E(u.value==null||b.value==null?"inActive":"active"),onClick:J},null,8,["class"])])])]),f(Pe,{isUploaded:H.value,isInferred:R.value,originalVideoSrc:O.value,inferredVideoSrc:D.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const Ct=le(kt,[["__scopeId","data-v-c2e5c54a"]]);export{Ct as default};
