import{d as ne,r as a,i as Z,v as Be,o as pe,f as F,g,j as _,w as U,h as e,x as E,y as fe,z as Ae,A as se,T as ve,k as M,F as Q,m as r,C as oe,_ as ie,q as le,D as me,E as ae,G as Y,p as _e,l as ge,c as Se,H as $e,I as Le,J as Oe,K as Ue}from"./index-d46476ca.js";import{P as be,e as Ee}from"./eventsource-98ad1372.js";import{s as T}from"./services-b33b6e54.js";const Me={id:"teleport-upload-modal",class:"contents"},Pe={class:"title-area"},De={class:"original"},Re={class:"pixell-ai"},Fe=["src"],Te=["src"],Ne={key:0,class:"timeline-area"},qe={class:"video-menu-area"},He=ne({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(I){const c=I,B=a(null),A=a(null),w=a(null),u=a(null),p=a(null),S=a(null),f=a(!1),y=a(!1),x=Z("signOut"),$=a(!1),n=a(!1),h=a(null),L=a(null),{isUploaded:P,isInferred:C,originalVideoSrc:X,inferredVideoSrc:D}=Be(c),q=()=>{h.value!==null&&clearTimeout(h.value),window.navigator.clipboard.writeText(D.value).then(()=>{$.value=!0,h.value=setTimeout(()=>{$.value=!1},2e3)})},H=()=>{L.value!==null&&clearTimeout(L.value);const t=document.createElement("a");t.href=D.value,t.download=D.value,t.click(),n.value=!0,L.value=setTimeout(()=>{n.value=!1},2e3)},J=t=>{const l=B.value;console.log(l);let v=!1;document.onmouseup=()=>{v=!1,y.value=!1};const b=()=>{v=!0,y.value=!0},O=j=>{if(v&&l!==null){const K=l.getBoundingClientRect();if("pageX"in j){const z=(j.pageX-K.left)/l.offsetWidth*100;z<100&&z>0?t.style.left=z+"%":z<=0?t.style.left="0px":z>=100&&(t.style.left="100%")}}},k=()=>{v=!1,y.value=!1};t.onmousedown=b,t.onmouseup=k,l!==null&&(l.onmousemove=O,l.onmouseout=O)},R=t=>{if(y.value){const l=B.value,v=w.value,b=p.value;if(l!==null){const O=l.getBoundingClientRect();if("pageX"in t){const k=(t.pageX-O.left)/l.offsetWidth*100;k<100&&k>0?(v.style.width=k+"%",b.style.width=100/k*100+"%",b.style.zIndex="3"):k<=0?(v.style.width="0",b.style.width="0"):k>=100&&(v.style.width="100%",b.style.width="100%")}}}},W=()=>{u.value!==null&&p.value!==null&&(u.value.paused?(u.value.play(),p.value.play(),f.value=!0):(u.value.pause(),p.value.pause(),f.value=!1))},i=t=>{u.value!==null&&p.value!==null&&(t=="forward"?(p.value.currentTime+=10,u.value.currentTime+=10):(p.value.currentTime-=10,u.value.currentTime-=10))},m=()=>{f.value=!1};return pe(()=>{const t=B.value,l=S.value;l!==null&&t!==null&&(J(l),t.addEventListener("mousemove",R,!1),t.addEventListener("mouseout",R,!1),t.addEventListener("touchstart",R,!1),t.addEventListener("touchmove",R,!1)),u.value!==null&&(u.value.addEventListener("ended",m,!1),u.value.addEventListener("timeupdate",v=>{},!1),u.value.addEventListener("seeking",v=>{u.value!==null&&console.log(Math.floor(u.value.currentTime))},!1))}),(t,l)=>{const v=F("FontAwesomeIcon");return r(),g(Q,null,[_(v,{icon:"right-from-bracket",class:"sign-out-button",onClick:U(x)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:B},[e("div",Me,[e("div",Pe,[e("div",De,[e("strong",{class:E(U(P)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",Re,[e("strong",{class:E(U(C)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:A},[fe(e("button",{ref_key:"draggableButton",ref:S,class:"drag-btn"},null,512),[[Ae,U(C)]]),e("video",{ref_key:"originalVideo",ref:u,src:U(X)},null,8,Fe),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:w},[e("video",{ref_key:"inferenceVideo",ref:p,src:U(D)},null,8,Te)],512),U(C)?(r(),g("button",{key:0,class:"share-btn",onClick:q},[_(ve,{name:"fade",mode:"out-in"},{default:se(()=>[$.value?(r(),g("span",{key:0,class:"copy-text",onClick:l[0]||(l[0]=oe(()=>{},["stop"]))},"copy")):M("",!0)]),_:1})])):M("",!0),U(C)?(r(),g("button",{key:1,class:"download-btn",onClick:H},[_(ve,{name:"fade",mode:"out-in"},{default:se(()=>[n.value?(r(),g("span",{key:0,class:"download-text",onClick:l[1]||(l[1]=oe(()=>{},["stop"]))},"download")):M("",!0)]),_:1})])):M("",!0)],512),U(C)?(r(),g("div",Ne,[e("div",qe,[_(v,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:l[2]||(l[2]=b=>i("backward"))}),_(v,{icon:"circle-play",class:"fa-3x play-button",onClick:W}),_(v,{icon:"play",class:"fa-3x next-button",onClick:l[3]||(l[3]=b=>i("forward"))})])])):M("",!0)])],512)],64)}}});const ze=ie(He,[["__scopeId","data-v-0bce4f6b"]]),Xe="http://222.107.124.161:64000/assets/sample_video_img-8e9d2f79.png",ue=I=>(_e("data-v-e7ebe5a6"),I=I(),ge(),I),Je={class:"upload-modal-container"},Qe={class:"contents"},We=ue(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),je=ue(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Ke={class:"sample-video-area"},Ge=ue(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),Ye={class:"sample-video-list"},Ze=["onClick"],et={key:0,class:"file-name-area"},tt={class:"file-name"},lt={key:1,class:"file-name-area"},at={class:"upload-btn-area"},st=ne({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(I,{emit:c}){const B=Z("defaultInstance"),A=Z("emitter"),w=a([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),u=a(0),p=a(!1),S=a(0),f=a(-1),y=a([]),x=a(!1),$=new AbortController,n=i=>{y.value.length>0?A.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):f.value=i},h=()=>{x.value=!0},L=()=>{x.value=!1},P=i=>{x.value=!0,i.preventDefault()},C=i=>{if(f.value!==-1)A.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{i.preventDefault();const m=/\.mp4$/i;x.value=!1;const t=i.dataTransfer;if(t&&t.files)for(const l of t.files)if(m.test(l.name))X(t.files,"drop");else{A.emit("update:alert",{isActive:!0,message:"mp4 확장자만 지원합니다."});break}}},X=(i,m)=>{let t;if(m=="change"?t=i.files:t=i,t!==null)for(let l=0;l<t.length;l++){/\.mp4$/i.test(t[l].name)&&y.value.push({title:t[l].name,file:t[l]});const b=y.value.filter((O,k,j)=>k===j.findIndex(K=>K.title===O.title));y.value=b}},D=i=>{y.value.splice(i,1)},q=i=>{if(f.value!==-1)A.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const m=i.target;m&&m.files&&X(m,"change")}},H=()=>{c("update:close")},J=()=>{c("update:abort"),$.abort()},R=()=>{Promise.all([B.get(T.videoList),B.get(T.inferenceModelList)]).then(i=>{c("update:upload",{videoList:i[0].data,inferenceModelList:i[1].data.data.filter(m=>m!==null)}),H()})},W=()=>{if(y.value.length>0){p.value=!0;const i=y.value,m=new FormData;for(let t=0;t<i.length;t++)console.log(i[t].file),m.append("file",i[t].file);B.postForm(T.upload,m,{signal:$.signal,onUploadProgress:t=>{const l=t.loaded*100/t.total;S.value=Number(l.toFixed(0)),l==100&&(p.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(t=>{console.log("output-> result",t),R()})}else A.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(i,m)=>{const t=F("FontAwesomeIcon"),l=F("BaseButton");return r(),g(Q,null,[p.value?(r(),le(be,{key:0,text:"video file uploading...",progressValue:S.value,"onUpdate:closeProgressModal":J},null,8,["progressValue"])):M("",!0),e("div",Je,[e("button",{class:"close-btn",onClick:H}),e("div",Qe,[e("div",{class:E(["file-upload-area",x.value?"dragged":""]),onDragenter:h,onDragover:P,onDragleave:L,onDrop:C},[e("strong",null,[me(" Drop Video File here to upload or "),We,(r(),g("input",{key:u.value,type:"file",id:"file-upload",accept:".mp4",onChange:q,onClick:m[0]||(m[0]=v=>u.value+=1),multiple:""},null,32))])],34),je,e("div",Ke,[Ge,e("ul",Ye,[(r(!0),g(Q,null,ae(w.value,(v,b)=>(r(),g("li",{key:b},[e("img",{onClick:O=>n(b),src:Xe,class:E(b==f.value?"selected":"")},null,10,Ze)]))),128))])]),y.value.length>0?(r(),g("ul",et,[(r(!0),g(Q,null,ae(y.value,(v,b)=>(r(),g("li",{key:b},[e("span",tt,Y(v.file.name),1),_(t,{icon:"xmark",class:"delete-button",onClick:O=>D(b)},null,8,["onClick"])]))),128))])):M("",!0),f.value!=-1?(r(),g("ul",lt,[e("li",null,Y(w.value[f.value].name),1)])):M("",!0),e("div",at,[_(l,{text:"Upload",onClick:W})])])])],64)}}});const ot=ie(st,[["__scopeId","data-v-e7ebe5a6"]]),N=I=>(_e("data-v-55187828"),I=I(),ge(),I),nt={class:"upload-area"},it=N(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),ut={class:"row"},dt={class:"row video-file-select-area"},rt=N(()=>e("label",{class:"label"},"Video File",-1)),ct={class:"date"},vt=["onClick","onMouseenter"],pt={class:"file-size"},ft={class:"setting-area"},mt=N(()=>e("h2",{class:"h2-title"},"Output Settings",-1)),_t={class:"row"},gt=N(()=>e("label",{class:"label"},"AI Model",-1)),bt={class:"row"},yt=N(()=>e("label",{class:"label"},"Format",-1)),ht={class:"row"},kt=N(()=>e("label",{class:"label"},"Encoder",-1)),xt={class:"row check-area"},Vt=N(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),It={class:"row check-area"},wt={class:"row"},Ct=N(()=>e("label",{class:"bitrate"},"Bitrate : ",-1)),Bt=N(()=>e("span",{class:"unit"},"(kbps)",-1)),At={class:"row"},St=ne({__name:"Main",setup(I){const c=Z("emitter"),B=Se(),A=a(0),w=Z("defaultInstance"),u=a([]),p=a(null),S=a([]),f=a(null),y=[{name:"mp4"},{name:"mov"},{name:"mkv"}],x=a({name:"mp4"}),$=a({name:"H.264",value:"H.264"}),n=a([]),h=a("VBR"),L=a(!1),P=a(!1),C=a("1000"),X=a(0),D=a(!1),q=a(!1),H=a(""),J=a(""),R=a(""),W=a(""),i=$e(()=>{const o=[{name:"H.264",value:"H.264"},{name:"H.265",value:"H.265"},{name:"ProRes(Unable to play video)",value:"ProRes"}];return(x.value.name=="mp4"||x.value.name=="mov")&&(o[2].disabled=!0),o}),m=a(-1),t=a(null);let l;const v=o=>{u.value.length==0&&(c.emit("update:alert",{isActive:!0,message:"Please upload your video files."}),o.stopPropagation())},b=o=>{p.value=null,S.value=[],u.value=[],S.value=o.inferenceModelList,u.value=o.videoList},O=o=>{c.emit("update:alert",{isActive:!0,message:"삭제하시겠습니까?",fn:()=>{c.emit("update:loading",{isLoading:!0}),w.delete(T.video+`?videoId=${o}`).then(s=>{c.emit("update:loading",{isLoading:!1}),k()})}})},k=()=>{Promise.all([w.get(T.videoList),w.get(T.inferenceModelList)]).then(o=>{u.value=o[0].data,S.value=o[1].data.data.filter(s=>s!==null)})},j=o=>{const s=n.value.indexOf(o);s>=0?n.value.splice(s,1):o=="best quality"?(n.value=[],n.value.push("best quality")):n.value.push(o)},K=()=>{p.value==null?c.emit("update:alert",{isActive:!0,message:"Please select a video file."}):f.value==null?c.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(L.value=!1,q.value=!1,H.value="",J.value="",c.emit("update:loading",{isLoading:!0}),w.post(T.videoInference,{videoId:p.value&&p.value.videoId,containerId:f.value.containerId,format:x.value.name,encoder:$.value.value,bestQuality:n.value.indexOf("best quality")>=0?1:0,twoPassEncoding:n.value.indexOf("best quality")>=0?0:n.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:n.value.indexOf("best quality")>=0?"1000":C.value,vbr:n.value.indexOf("best quality")>=0?!1:h.value=="VBR",cbr:n.value.indexOf("best quality")>=0?!1:h.value=="CBR"}).then(o=>{sessionStorage.setItem("inference",JSON.stringify({uuid:o.data.data,containerId:f.value.containerId})),R.value=o.data.data,he(o.data.data)}))},z=()=>{l.close(),P.value=!1,q.value=!1,re({containerId:f.value.containerId,uuid:R.value})},ye=()=>{c.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{z()}})},he=o=>{l=new Ee.EventSourcePolyfill("http://222.107.124.161:64000"+T.connectSSE+`?uuid=${o}`,{headers:{Authorization:B.user.token}}),l.onopen=()=>{c.emit("update:loading",{isLoading:!1})},l.onmessage=s=>{try{if(typeof JSON.parse(s.data)=="object"){const V=JSON.parse(s.data);W.value=V.step,X.value=V.progress,P.value=!0,V.status=="error"&&z(),V.step=="all"&&V.progress==100&&V.result=="true"&&(l.close(),P.value=!1,sessionStorage.removeItem("inference"),c.emit("update:loading",{isLoading:!0}),H.value=V.originalVideo,J.value=V.inferenceVideo,q.value=!0,c.emit("update:loading",{isLoading:!1}))}}catch{}}},de=o=>{if(P.value)return o.preventDefault(),o.stopImmediatePropagation(),""},re=o=>{c.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요.&nbsp;&nbsp;<div class='loader'></div>"}),w.delete(T.videoInference+`?containerId=${o.containerId}&uuid=${o.uuid}`).then(s=>{k(),c.emit("update:loading",{isLoading:!1}),c.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),setTimeout(()=>{c.emit("update:alert",{isActive:!1})},2e3),sessionStorage.removeItem("inference")})};return Le(()=>{window.removeEventListener("beforeunload",de)}),pe(()=>{window.addEventListener("beforeunload",de),k(),sessionStorage.getItem("inference")!=null&&re(JSON.parse(sessionStorage.getItem("inference")))}),(o,s)=>{const V=F("BaseButton"),ke=F("FontAwesomeIcon"),ee=F("BaseSelect"),xe=F("BaseCheckBox"),ce=F("BaseRadio"),Ve=F("BaseInput"),Ie=Oe("tooltip");return r(),g(Q,null,[P.value?(r(),le(be,{key:0,text:W.value+" in_progress...",progressValue:X.value,"onUpdate:closeProgressModal":ye},null,8,["text","progressValue"])):M("",!0),e("main",null,[L.value?(r(),le(Ue,{key:0,to:"#teleport-upload-modal"},[(r(),le(ot,{key:A.value,"onUpdate:close":s[0]||(s[0]=d=>L.value=!1),"onUpdate:upload":s[1]||(s[1]=d=>b(d)),"onUpdate:abort":s[2]||(s[2]=d=>A.value+=1)}))])):M("",!0),e("aside",null,[e("section",nt,[it,e("div",ut,[_(V,{onClick:s[3]||(s[3]=d=>L.value=!0),text:"Upload Video"})]),e("div",dt,[rt,_(ee,{onClick:v,name:"fileName",options:u.value,text:p.value==null?"<span class=not-selected>Please Upload Video Files</span>":p.value.fileName},{list:se(()=>[(r(!0),g(Q,null,ae(u.value,(d,we)=>(r(),g("li",{class:"optionItem",key:we},[e("span",ct,Y(d.date),1),(r(!0),g(Q,null,ae(d.video,(G,te)=>(r(),g("div",{class:"file-name-area",onClick:Ce=>{D.value=!0,p.value=G},onMouseenter:()=>{t.value&&t.value[te].offsetWidth<t.value[te].scrollWidth&&(m.value=te)}},[fe((r(),g("span",{class:"file-name",ref_for:!0,ref_key:"fileName",ref:t},[me(Y(G.fileName),1)])),[[Ie,{content:m.value==te?G.fileName:"",placement:"bottom",delay:0}]]),e("span",null,[e("span",pt,Y(G.fileSize),1),_(ke,{icon:"xmark",class:"delete-button",onClick:oe(Ce=>O(G.videoId),["stop"])},null,8,["onClick"])])],40,vt))),256))]))),128))]),_:1},8,["options","text"])])]),e("section",ft,[mt,e("div",_t,[gt,_(ee,{"onUpdate:selectBox":s[4]||(s[4]=d=>{f.value=d}),options:S.value,name:"projectName,modelName",text:f.value==null?"<span class=not-selected>Select AI Model</span>":f.value.projectName+"/"+f.value.modelName},null,8,["options","text"])]),e("div",bt,[yt,_(ee,{"onUpdate:selectBox":s[5]||(s[5]=d=>x.value=d),options:y,name:"name",text:x.value.name},null,8,["text"])]),e("div",ht,[kt,_(ee,{"onUpdate:selectBox":s[6]||(s[6]=d=>{d.disabled&&U(c).emit("update:alert",{isActive:!0,message:"Unable to play video"}),$.value=d}),options:i.value,name:"name",text:$.value.name},null,8,["options","text"])]),e("div",xt,[e("div",null,[_(xe,{"onUpdate:checkModelValue":j,id:"BestQuality",value:"best quality"}),Vt])]),e("div",It,[e("div",null,[_(ce,{class:E(["radio",n.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[s[7]||(s[7]=d=>h.value=d),s[8]||(s[8]=d=>h.value=d)],name:"vbrOrCbr",value:"VBR",isDisabled:!(n.value.indexOf("best quality")<0),modelValue:h.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:E(n.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[_(ce,{class:E(["radio",n.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[s[9]||(s[9]=d=>h.value=d),s[10]||(s[10]=d=>h.value=d)],name:"vbrOrCbr",value:"CBR",isDisabled:!(n.value.indexOf("best quality")<0),modelValue:h.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:E(n.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",wt,[Ct,_(Ve,{"onUpdate:modelValue":s[11]||(s[11]=d=>C.value=d),placeholder:"",type:"text",onlyText:!0,modelValue:n.value.indexOf("best quality")>=0?1e3:C.value,class:E(n.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(n.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),Bt]),e("div",At,[_(V,{text:"Preview",class:E(p.value==null||f.value==null?"inActive":"active"),onClick:K},null,8,["class"])])])]),_(ze,{isUploaded:D.value,isInferred:q.value,originalVideoSrc:H.value,inferredVideoSrc:J.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const Ut=ie(St,[["__scopeId","data-v-55187828"]]);export{Ut as default};
