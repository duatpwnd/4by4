import{P as oe}from"./ProgressModal-5e10b764.js";import{d as G,r as s,i as z,w as ce,o as ne,f as T,g as y,j as r,x as F,h as e,y as I,z as re,A as ve,C as pe,T as fe,k as N,F as Q,n as m,D as me,_ as Y,t as W,E as ge,G as ae,H as se,p as ie,m as de,I as _e,J as be}from"./index-3f02fad1.js";import{s as $}from"./services-3e2e4a22.js";const ye={id:"teleport-upload-modal",class:"contents"},he={class:"title-area"},xe={class:"original"},ke={class:"pixell-ai"},Ve=["src"],Ie=["src"],Be={key:0,class:"timeline-area"},we={class:"video-menu-area"},Ce=G({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(B){const p=B,w=s(null),h=s(null),O=s(null),d=s(null),f=s(null),b=s(null),x=s(!1),g=s(!1),U=z("signOut"),L=s(!1),i=s(null),{isUploaded:k,isInferred:E,originalVideoSrc:M,inferredVideoSrc:V}=ce(p),X=()=>{V.value.split(".").pop(),i.value!==null&&clearTimeout(i.value),console.log(V.value),window.navigator.clipboard.writeText(V.value).then(()=>{const n=document.createElement("a");n.href=V.value,n.download=V.value,n.click(),L.value=!0,i.value=setTimeout(()=>{L.value=!1},2e3)})},J=n=>{const t=w.value;console.log(t);let o=!1;document.onmouseup=()=>{o=!1,g.value=!1};const a=()=>{o=!0,g.value=!0},v=S=>{if(o&&t!==null){const H=t.getBoundingClientRect();if("pageX"in S){const q=(S.pageX-H.left)/t.offsetWidth*100;q<100&&q>0?n.style.left=q+"%":q<=0?n.style.left="0px":q>=100&&(n.style.left="100%")}}},_=()=>{o=!1,g.value=!1};n.onmousedown=a,n.onmouseup=_,t!==null&&(t.onmousemove=v,t.onmouseout=v)},C=n=>{if(g.value){const t=w.value,o=O.value,a=f.value;if(t!==null){const v=t.getBoundingClientRect();if("pageX"in n){const _=(n.pageX-v.left)/t.offsetWidth*100;_<100&&_>0?(o.style.width=_+"%",a.style.width=100/_*100+"%",a.style.zIndex="3"):_<=0?(o.style.width="0",a.style.width="0"):_>=100&&(o.style.width="100%",a.style.width="100%")}}}},D=()=>{d.value!==null&&f.value!==null&&(d.value.paused?(d.value.play(),f.value.play(),x.value=!0):(d.value.pause(),f.value.pause(),x.value=!1))},R=n=>{d.value!==null&&f.value!==null&&(n=="forward"?(f.value.currentTime+=10,d.value.currentTime+=10):(f.value.currentTime-=10,d.value.currentTime-=10))},j=()=>{x.value=!1};return ne(()=>{const n=w.value,t=b.value;t!==null&&n!==null&&(J(t),n.addEventListener("mousemove",C,!1),n.addEventListener("mouseout",C,!1),n.addEventListener("touchstart",C,!1),n.addEventListener("touchmove",C,!1)),d.value!==null&&(d.value.addEventListener("ended",j,!1),d.value.addEventListener("timeupdate",o=>{},!1),d.value.addEventListener("seeking",o=>{d.value!==null&&console.log(Math.floor(d.value.currentTime))},!1))}),(n,t)=>{const o=T("FontAwesomeIcon");return m(),y(Q,null,[r(o,{icon:"right-from-bracket",class:"sign-out-button",onClick:F(U)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:w},[e("div",ye,[e("div",he,[e("div",xe,[e("strong",{class:I(F(k)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",ke,[e("strong",{class:I(F(E)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:h},[re(e("button",{ref_key:"draggableButton",ref:b,class:"drag-btn"},null,512),[[ve,F(E)]]),e("video",{ref_key:"originalVideo",ref:d,src:F(M)},null,8,Ve),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:O},[e("video",{ref_key:"inferenceVideo",ref:f,src:F(V)},null,8,Ie)],512),F(E)?(m(),y("button",{key:0,class:"share-btn",onClick:X},[r(fe,{name:"fade",mode:"out-in"},{default:pe(()=>[L.value?(m(),y("span",{key:0,class:"copy-text",onClick:t[0]||(t[0]=me(()=>{},["stop"]))},"copied.")):N("",!0)]),_:1})])):N("",!0)],512),F(E)?(m(),y("div",Be,[e("div",we,[r(o,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:t[1]||(t[1]=a=>R("backward"))}),r(o,{icon:"circle-play",class:"fa-3x play-button",onClick:D}),r(o,{icon:"play",class:"fa-3x next-button",onClick:t[2]||(t[2]=a=>R("forward"))})])])):N("",!0)])],512)],64)}}});const Se=Y(Ce,[["__scopeId","data-v-99c73938"]]),Ae="http://172.168.10.91:49090/assets/sample_video_img-8e9d2f79.png",Z=B=>(ie("data-v-a5bf2b61"),B=B(),de(),B),$e={class:"upload-modal-container"},Oe={class:"contents"},Le=Z(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),Ee=Z(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Ue={class:"sample-video-area"},Me=Z(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),Pe={class:"sample-video-list"},De=["onClick"],Re={key:0,class:"file-name-area"},qe={class:"file-name"},Fe={key:1,class:"file-name-area"},Te={class:"upload-btn-area"},Ne=G({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(B,{emit:p}){const w=z("defaultInstance"),h=z("emitter"),O=s([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),d=s(0),f=s(!1),b=s(0),x=s(-1),g=s([]),U=s(!1),L=new AbortController,i=t=>{g.value.length>0?h.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):x.value=t},k=()=>{U.value=!0},E=()=>{U.value=!1},M=t=>{U.value=!0,t.preventDefault()},V=t=>{if(x.value!==-1)h.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{t.preventDefault();const o=/(\.mov|\.mp4|\.mkv)$/i;U.value=!1;const a=t.dataTransfer;if(a&&a.files){for(const v of a.files)if(!o.exec(v.name)){h.emit("update:alert",{isActive:!0,message:"mp4,mov,mkv 확장자만 지원합니다."});break}X(a.files,"drop")}}},X=(t,o)=>{let a;if(o=="change"?a=t.files:a=t,a!==null)for(let v=0;v<a.length;v++)g.value.push({title:a[v].name,file:a[v]})},J=t=>{g.value.splice(t,1)},C=t=>{if(x.value!==-1)h.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const o=t.target;o&&o.files&&X(o,"change")}},D=()=>{p("update:close")},R=()=>{p("update:abort"),L.abort()},j=()=>{Promise.all([w.get($.videoList),w.get($.inferenceModelList)]).then(t=>{p("update:upload",{videoList:t[0].data,inferenceModelList:t[1].data.data.filter(o=>o!==null)}),D()})},n=()=>{if(g.value.length>0){f.value=!0;const t=g.value,o=new FormData;for(let a=0;a<t.length;a++)console.log(t[a].file),o.append("file",t[a].file);w.postForm($.upload,o,{signal:L.signal,onUploadProgress:a=>{const v=a.loaded*100/a.total;b.value=Number(v.toFixed(0)),v==100&&(f.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(a=>{console.log("output-> result",a),j()})}else h.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(t,o)=>{const a=T("FontAwesomeIcon"),v=T("BaseButton");return m(),y(Q,null,[f.value?(m(),W(oe,{key:0,text:"video file uploading...",progressValue:b.value,"onUpdate:closeProgressModal":R},null,8,["progressValue"])):N("",!0),e("div",$e,[e("button",{class:"close-btn",onClick:D}),e("div",Oe,[e("div",{class:I(["file-upload-area",U.value?"dragged":""]),onDragenter:k,onDragover:M,onDragleave:E,onDrop:V},[e("strong",null,[ge(" Drop Video File here to upload or "),Le,(m(),y("input",{key:d.value,type:"file",id:"file-upload",accept:".mp4, .mov, .mkv",onChange:C,onClick:o[0]||(o[0]=_=>d.value+=1),multiple:""},null,32))])],34),Ee,e("div",Ue,[Me,e("ul",Pe,[(m(!0),y(Q,null,ae(O.value,(_,S)=>(m(),y("li",{key:S},[e("img",{onClick:H=>i(S),src:Ae,class:I(S==x.value?"selected":"")},null,10,De)]))),128))])]),g.value.length>0?(m(),y("ul",Re,[(m(!0),y(Q,null,ae(g.value,(_,S)=>(m(),y("li",{key:S},[e("span",qe,se(_.file.name),1),r(a,{icon:"xmark",class:"delete-button",onClick:H=>J(S)},null,8,["onClick"])]))),128))])):N("",!0),x.value!=-1?(m(),y("ul",Fe,[e("li",null,se(O.value[x.value].name),1)])):N("",!0),e("div",Te,[r(v,{text:"Upload",onClick:n})])])])],64)}}});const Xe=Y(Ne,[["__scopeId","data-v-a5bf2b61"]]),P=B=>(ie("data-v-1d7e9a20"),B=B(),de(),B),Je={class:"upload-area"},je=P(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),He={class:"row"},Qe={class:"row"},ze=P(()=>e("label",{class:"label"},"video File",-1)),Ke={class:"setting-area"},We=P(()=>e("h2",{class:"h2-title"},"Output Setting",-1)),Ge={class:"row"},Ye=P(()=>e("label",{class:"label"},"AI Model",-1)),Ze={class:"row"},et=P(()=>e("label",{class:"label"},"Format",-1)),tt={class:"row"},lt=P(()=>e("label",{class:"label"},"Encoder",-1)),at={class:"row check-area"},st=P(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),ot={class:"row check-area"},nt={class:"row"},it=P(()=>e("label",{class:"bitrate"},"AVg.Bitrate : ",-1)),dt=P(()=>e("span",{class:"unit"},"(kbps)",-1)),ut={class:"row"},ct=G({__name:"Main",setup(B){const p=z("emitter"),w=s(0),h=z("defaultInstance"),O=s([]),d=s(null),f=s([]),b=s(null),x=[{name:"mp4"},{name:"mov"},{name:"mkv"}],g=s({name:"mp4"}),U=[{name:"H.264"},{name:"H.265"},{name:"ProRes"}],L=s({name:"H.264"}),i=s([]),k=s("VBR"),E=s(!1),M=s(!1),V=s("128"),X=s(0),J=s(!1),C=s(!1),D=s(""),R=s(""),j=s("");let n;const t=u=>{d.value=null,f.value=[],O.value=[],f.value=u.inferenceModelList,O.value=u.videoList},o=()=>{Promise.all([h.get($.videoList),h.get($.inferenceModelList)]).then(u=>{O.value=u[0].data,f.value=u[1].data.data.filter(l=>l!==null)})},a=u=>{const l=i.value.indexOf(u);l>=0?i.value.splice(l,1):u=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(u)},v=()=>{d.value==null?p.emit("update:alert",{isActive:!0,message:"Please select a video file."}):b.value==null?p.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(C.value=!1,D.value="",R.value="",p.emit("update:loading",{isLoading:!0}),h.post($.videoInference,{videoId:d.value&&d.value.videoId,containerId:b.value.containerId,format:g.value.name,encoder:L.value.name,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?0:V.value,vbr:i.value.indexOf("best quality")>=0?!1:k.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:k.value=="CBR"}).then(u=>{console.log(u),localStorage.setItem("inference",JSON.stringify({uuid:u.data.data,containerId:b.value.containerId})),j.value=u.data.data,H(u.data.data)}))},_=()=>{n.close(),M.value=!1,C.value=!1,ee({containerId:b.value.containerId,uuid:j.value})},S=()=>{p.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{p.emit("update:loading",{isLoading:!0}),_()}})},H=u=>{n=new EventSource($.connectSSE+`?uuid=${u}`),n.onopen=()=>{console.log($.connectSSE+`?uuid=${u}----connect`)},n.onmessage=l=>{try{if(typeof JSON.parse(l.data)=="object"){const A=JSON.parse(l.data);console.log(A),A.step=="inference"&&(M.value=!0,p.emit("update:loading",{isLoading:!1}),X.value=A.progress),A.status=="error"&&_(),A.step=="all"&&A.progress==100&&A.result=="true"&&(n.close(),M.value=!1,localStorage.removeItem("inference"),p.emit("update:loading",{isLoading:!0}),D.value="http://172.168.10.91:49090"+$.videoDownload+`?videoId=${d.value&&d.value.videoId}`,R.value="http://172.168.10.91:49090"+$.videoDownload+`?uuid=${u}`,C.value=!0,p.emit("update:loading",{isLoading:!1}))}}catch{}},n.onerror=l=>{console.log(l),_()}},q=u=>{if(M.value)return u.preventDefault(),u.stopImmediatePropagation(),""},ee=u=>{p.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요."}),h.delete($.videoInference+`?containerId=${u.containerId}&uuid=${u.uuid}`).then(l=>{console.log("삭제",l),o(),p.emit("update:loading",{isLoading:!1}),p.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),localStorage.removeItem("inference")})};return _e(()=>{window.removeEventListener("beforeunload",q)}),ne(()=>{window.addEventListener("beforeunload",q),o(),localStorage.getItem("inference")!=null&&ee(JSON.parse(localStorage.getItem("inference")))}),(u,l)=>{const A=T("BaseButton"),K=T("BaseSelect"),te=T("BaseCheckBox"),le=T("BaseRadio"),ue=T("BaseInput");return m(),y(Q,null,[M.value?(m(),W(oe,{key:0,text:"Inference is in progress...",progressValue:X.value,"onUpdate:closeProgressModal":S},null,8,["progressValue"])):N("",!0),e("main",null,[E.value?(m(),W(be,{key:0,to:"#teleport-upload-modal"},[(m(),W(Xe,{key:w.value,"onUpdate:close":l[0]||(l[0]=c=>E.value=!1),"onUpdate:upload":l[1]||(l[1]=c=>t(c)),"onUpdate:abort":l[2]||(l[2]=c=>w.value+=1)}))])):N("",!0),e("aside",null,[e("section",Je,[je,e("div",He,[r(A,{onClick:l[3]||(l[3]=c=>E.value=!0),text:"Upload Video"})]),e("div",Qe,[ze,r(K,{"onUpdate:selectBox":l[4]||(l[4]=c=>{J.value=!0,d.value=c}),name:"fileName",options:O.value,text:d.value==null?"<span class=not-selected>Please Upload Video Files</span>":d.value.fileName},null,8,["options","text"])])]),e("section",Ke,[We,e("div",Ge,[Ye,r(K,{"onUpdate:selectBox":l[5]||(l[5]=c=>{b.value=c}),options:f.value,name:"projectName,modelName",text:b.value==null?"<span class=not-selected>Select AI Model</span>":b.value.projectName+"/"+b.value.modelName},null,8,["options","text"])]),e("div",Ze,[et,r(K,{"onUpdate:selectBox":l[6]||(l[6]=c=>g.value=c),options:x,name:"name",text:g.value.name},null,8,["text"])]),e("div",tt,[lt,r(K,{"onUpdate:selectBox":l[7]||(l[7]=c=>L.value=c),options:U,name:"name",text:L.value.name},null,8,["text"])]),e("div",at,[e("div",null,[r(te,{"onUpdate:checkModelValue":a,id:"BestQuality",value:"best quality"}),st]),e("div",null,[e("span",{class:I(["check-box",i.value.indexOf("best quality")<0?"active":"inActive"])},[r(te,{"onUpdate:checkModelValue":a,id:i.value.indexOf("best quality")<0?"2PassEncoding":"",value:"2-Pass Encoding"},null,8,["id"])],2),e("label",{for:"2PassEncoding",class:I(i.value.indexOf("best quality")<0?"active":"inActive")},"2-Pass Encoding",2)])]),e("div",ot,[e("div",null,[r(le,{class:I(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[l[8]||(l[8]=c=>k.value=c),l[9]||(l[9]=c=>k.value=c)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:k.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:I(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[r(le,{class:I(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[l[10]||(l[10]=c=>k.value=c),l[11]||(l[11]=c=>k.value=c)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:k.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:I(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",nt,[it,r(ue,{"onUpdate:modelValue":l[12]||(l[12]=c=>V.value=c),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?0:V.value,class:I(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),dt]),e("div",ut,[r(A,{text:"Preview",class:I(d.value==null||b.value==null?"inActive":"active"),onClick:v},null,8,["class"])])])]),r(Se,{isUploaded:J.value,isInferred:C.value,originalVideoSrc:D.value,inferredVideoSrc:R.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const ft=Y(ct,[["__scopeId","data-v-1d7e9a20"]]);export{ft as default};
