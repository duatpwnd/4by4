import{d as se,r as a,i as G,w as we,o as ce,f as P,g,j as _,x as q,h as e,y as U,z as ve,A as Be,C as pe,T as Ae,k as T,F as X,n as c,D as fe,_ as oe,t as ee,E as me,G as te,H as K,p as _e,m as ge,c as Se,I as $e,J as Le,K as Oe,L as Ee}from"./index-54a60391.js";import{P as ye,e as Ue}from"./eventsource-c405a803.js";import{s as R}from"./services-b33b6e54.js";const Me={id:"teleport-upload-modal",class:"contents"},Pe={class:"title-area"},Re={class:"original"},De={class:"pixell-ai"},Fe=["src"],Ne=["src"],qe={key:0,class:"timeline-area"},Te={class:"video-menu-area"},He=se({__name:"Video",props:{isUploaded:{type:Boolean},isInferred:{type:Boolean},originalVideoSrc:{},inferredVideoSrc:{}},setup(I){const v=I,$=a(null),L=a(null),C=a(null),d=a(null),p=a(null),O=a(null),f=a(!1),y=a(!1),h=G("signOut"),E=a(!1),i=a(null),{isUploaded:x,isInferred:w,originalVideoSrc:M,inferredVideoSrc:V}=we(v),H=()=>{V.value.split(".").pop(),i.value!==null&&clearTimeout(i.value),console.log(V.value),window.navigator.clipboard.writeText(V.value).then(()=>{const u=document.createElement("a");u.href=V.value,u.download=V.value,u.click(),E.value=!0,i.value=setTimeout(()=>{E.value=!1},2e3)})},J=u=>{const t=$.value;console.log(t);let o=!1;document.onmouseup=()=>{o=!1,y.value=!1};const l=()=>{o=!0,y.value=!0},m=k=>{if(o&&t!==null){const z=t.getBoundingClientRect();if("pageX"in k){const A=(k.pageX-z.left)/t.offsetWidth*100;A<100&&A>0?u.style.left=A+"%":A<=0?u.style.left="0px":A>=100&&(u.style.left="100%")}}},b=()=>{o=!1,y.value=!1};u.onmousedown=l,u.onmouseup=b,t!==null&&(t.onmousemove=m,t.onmouseout=m)},B=u=>{if(y.value){const t=$.value,o=C.value,l=p.value;if(t!==null){const m=t.getBoundingClientRect();if("pageX"in u){const b=(u.pageX-m.left)/t.offsetWidth*100;b<100&&b>0?(o.style.width=b+"%",l.style.width=100/b*100+"%",l.style.zIndex="3"):b<=0?(o.style.width="0",l.style.width="0"):b>=100&&(o.style.width="100%",l.style.width="100%")}}}},F=()=>{d.value!==null&&p.value!==null&&(d.value.paused?(d.value.play(),p.value.play(),f.value=!0):(d.value.pause(),p.value.pause(),f.value=!1))},N=u=>{d.value!==null&&p.value!==null&&(u=="forward"?(p.value.currentTime+=10,d.value.currentTime+=10):(p.value.currentTime-=10,d.value.currentTime-=10))},j=()=>{f.value=!1};return ce(()=>{const u=$.value,t=O.value;t!==null&&u!==null&&(J(t),u.addEventListener("mousemove",B,!1),u.addEventListener("mouseout",B,!1),u.addEventListener("touchstart",B,!1),u.addEventListener("touchmove",B,!1)),d.value!==null&&(d.value.addEventListener("ended",j,!1),d.value.addEventListener("timeupdate",o=>{},!1),d.value.addEventListener("seeking",o=>{d.value!==null&&console.log(Math.floor(d.value.currentTime))},!1))}),(u,t)=>{const o=P("FontAwesomeIcon");return c(),g(X,null,[_(o,{icon:"right-from-bracket",class:"sign-out-button",onClick:q(h)},null,8,["onClick"]),e("div",{class:"video-container",ref_key:"videoContainerRef",ref:$},[e("div",Me,[e("div",Pe,[e("div",Re,[e("strong",{class:U(q(x)?"uploaded":"not-uploaded")},"Original ",2)]),e("div",De,[e("strong",{class:U(q(w)?"uploaded":"not-uploaded")},"PIXELL AI",2)])]),e("div",{class:"video-area",ref_key:"videoAreaRef",ref:L},[ve(e("button",{ref_key:"draggableButton",ref:O,class:"drag-btn"},null,512),[[Be,q(w)]]),e("video",{ref_key:"originalVideo",ref:d,src:q(M)},null,8,Fe),e("div",{id:"video-clipper",ref_key:"videoClipperRef",ref:C},[e("video",{ref_key:"inferenceVideo",ref:p,src:q(V)},null,8,Ne)],512),q(w)?(c(),g("button",{key:0,class:"share-btn",onClick:H},[_(Ae,{name:"fade",mode:"out-in"},{default:pe(()=>[E.value?(c(),g("span",{key:0,class:"copy-text",onClick:t[0]||(t[0]=fe(()=>{},["stop"]))},"download and copy")):T("",!0)]),_:1})])):T("",!0)],512),q(w)?(c(),g("div",qe,[e("div",Te,[_(o,{icon:"play",class:"fa-flip-both fa-3x prev-button",onClick:t[1]||(t[1]=l=>N("backward"))}),_(o,{icon:"circle-play",class:"fa-3x play-button",onClick:F}),_(o,{icon:"play",class:"fa-3x next-button",onClick:t[2]||(t[2]=l=>N("forward"))})])])):T("",!0)])],512)],64)}}});const ze=oe(He,[["__scopeId","data-v-aaf53aee"]]),Xe="http://222.107.124.161:64000/assets/sample_video_img-8e9d2f79.png",ne=I=>(_e("data-v-e7ebe5a6"),I=I(),ge(),I),Je={class:"upload-modal-container"},je={class:"contents"},Qe=ne(()=>e("label",{class:"file-upload-txt",for:"file-upload"},"Choose File",-1)),We=ne(()=>e("p",{class:"guide-msg"}," Your Video Files are safely stored and secured using encryption ",-1)),Ke={class:"sample-video-area"},Ge=ne(()=>e("h3",{class:"h3-title"},"Try Sample Video",-1)),Ye={class:"sample-video-list"},Ze=["onClick"],et={key:0,class:"file-name-area"},tt={class:"file-name"},lt={key:1,class:"file-name-area"},at={class:"upload-btn-area"},st=se({__name:"UploadModal",emits:["update:close","update:upload","update:abort"],setup(I,{emit:v}){const $=G("defaultInstance"),L=G("emitter"),C=a([{name:"tes1.mp4"},{name:"tes2.mp4"},{name:"tes3.mp4"}]),d=a(0),p=a(!1),O=a(0),f=a(-1),y=a([]),h=a(!1),E=new AbortController,i=t=>{y.value.length>0?L.emit("update:alert",{isActive:!0,message:"이미 업로드된 파일이 존재합니다."}):f.value=t},x=()=>{h.value=!0},w=()=>{h.value=!1},M=t=>{h.value=!0,t.preventDefault()},V=t=>{if(f.value!==-1)L.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{t.preventDefault();const o=/\.mp4$/i;h.value=!1;const l=t.dataTransfer;if(l&&l.files)for(const m of l.files)if(o.test(m.name))H(l.files,"drop");else{L.emit("update:alert",{isActive:!0,message:"mp4 확장자만 지원합니다."});break}}},H=(t,o)=>{let l;if(o=="change"?l=t.files:l=t,l!==null)for(let m=0;m<l.length;m++){/\.mp4$/i.test(l[m].name)&&y.value.push({title:l[m].name,file:l[m]});const k=y.value.filter((z,A,le)=>A===le.findIndex(ae=>ae.title===z.title));y.value=k}},J=t=>{y.value.splice(t,1)},B=t=>{if(f.value!==-1)L.emit("update:alert",{isActive:!0,message:"이미 샘플비디오를 선택하셨습니다."});else{const o=t.target;o&&o.files&&H(o,"change")}},F=()=>{v("update:close")},N=()=>{v("update:abort"),E.abort()},j=()=>{Promise.all([$.get(R.videoList),$.get(R.inferenceModelList)]).then(t=>{v("update:upload",{videoList:t[0].data,inferenceModelList:t[1].data.data.filter(o=>o!==null)}),F()})},u=()=>{if(y.value.length>0){p.value=!0;const t=y.value,o=new FormData;for(let l=0;l<t.length;l++)console.log(t[l].file),o.append("file",t[l].file);$.postForm(R.upload,o,{signal:E.signal,onUploadProgress:l=>{const m=l.loaded*100/l.total;O.value=Number(m.toFixed(0)),m==100&&(p.value=!1)},headers:{"Content-Type":"multipart/form-data",type:"video"}}).then(l=>{console.log("output-> result",l),j()})}else L.emit("update:alert",{isActive:!0,message:"파일을 업로드 해주세요."})};return(t,o)=>{const l=P("FontAwesomeIcon"),m=P("BaseButton");return c(),g(X,null,[p.value?(c(),ee(ye,{key:0,text:"video file uploading...",progressValue:O.value,"onUpdate:closeProgressModal":N},null,8,["progressValue"])):T("",!0),e("div",Je,[e("button",{class:"close-btn",onClick:F}),e("div",je,[e("div",{class:U(["file-upload-area",h.value?"dragged":""]),onDragenter:x,onDragover:M,onDragleave:w,onDrop:V},[e("strong",null,[me(" Drop Video File here to upload or "),Qe,(c(),g("input",{key:d.value,type:"file",id:"file-upload",accept:".mp4",onChange:B,onClick:o[0]||(o[0]=b=>d.value+=1),multiple:""},null,32))])],34),We,e("div",Ke,[Ge,e("ul",Ye,[(c(!0),g(X,null,te(C.value,(b,k)=>(c(),g("li",{key:k},[e("img",{onClick:z=>i(k),src:Xe,class:U(k==f.value?"selected":"")},null,10,Ze)]))),128))])]),y.value.length>0?(c(),g("ul",et,[(c(!0),g(X,null,te(y.value,(b,k)=>(c(),g("li",{key:k},[e("span",tt,K(b.file.name),1),_(l,{icon:"xmark",class:"delete-button",onClick:z=>J(k)},null,8,["onClick"])]))),128))])):T("",!0),f.value!=-1?(c(),g("ul",lt,[e("li",null,K(C.value[f.value].name),1)])):T("",!0),e("div",at,[_(m,{text:"Upload",onClick:u})])])])],64)}}});const ot=oe(st,[["__scopeId","data-v-e7ebe5a6"]]),D=I=>(_e("data-v-1d14fc30"),I=I(),ge(),I),nt={class:"upload-area"},it=D(()=>e("h2",{class:"h2-title"},"PIXELL AI",-1)),ut={class:"row"},dt={class:"row video-file-select-area"},rt=D(()=>e("label",{class:"label"},"Video File",-1)),ct={class:"date"},vt=["onClick","onMouseenter"],pt={class:"file-size"},ft={class:"setting-area"},mt=D(()=>e("h2",{class:"h2-title"},"Output Settings",-1)),_t={class:"row"},gt=D(()=>e("label",{class:"label"},"AI Model",-1)),yt={class:"row"},bt=D(()=>e("label",{class:"label"},"Format",-1)),ht={class:"row"},kt=D(()=>e("label",{class:"label"},"Encoder",-1)),xt={class:"row check-area"},Vt=D(()=>e("label",{for:"BestQuality"},"Best Quality",-1)),It={class:"row check-area"},Ct={class:"row"},wt=D(()=>e("label",{class:"bitrate"},"Bitrate : ",-1)),Bt=D(()=>e("span",{class:"unit"},"(kbps)",-1)),At={class:"row"},St=se({__name:"Main",setup(I){const v=G("emitter"),$=Se(),L=a(0),C=G("defaultInstance"),d=a([]),p=a(null),O=a([]),f=a(null),y=[{name:"mp4"},{name:"mov"},{name:"mkv"}],h=a({name:"mp4"}),E=a({name:"H.264",value:"H.264"}),i=a([]),x=a("VBR"),w=a(!1),M=a(!1),V=a("1000"),H=a(0),J=a(!1),B=a(!1),F=a(""),N=a(""),j=a(""),u=a(""),t=$e(()=>{const n=[{name:"H.264",value:"H.264"},{name:"H.265",value:"H.265"},{name:"ProRes(Unable to play video)",value:"ProRes"}];return(h.value.name=="mp4"||h.value.name=="mov")&&(n[2].disabled=!0),n}),o=a(-1),l=a(null);let m;const b=n=>{d.value.length==0&&(v.emit("update:alert",{isActive:!0,message:"Please upload your video files."}),n.stopPropagation())},k=n=>{p.value=null,O.value=[],d.value=[],O.value=n.inferenceModelList,d.value=n.videoList},z=n=>{v.emit("update:alert",{isActive:!0,message:"삭제하시겠습니까?",fn:()=>{v.emit("update:loading",{isLoading:!0}),C.delete(R.video+`?videoId=${n}`).then(s=>{v.emit("update:loading",{isLoading:!1}),A()})}})},A=()=>{Promise.all([C.get(R.videoList),C.get(R.inferenceModelList)]).then(n=>{d.value=n[0].data,O.value=n[1].data.data.filter(s=>s!==null)})},le=n=>{const s=i.value.indexOf(n);s>=0?i.value.splice(s,1):n=="best quality"?(i.value=[],i.value.push("best quality")):i.value.push(n)},ae=()=>{p.value==null?v.emit("update:alert",{isActive:!0,message:"Please select a video file."}):f.value==null?v.emit("update:alert",{isActive:!0,message:"Please select ai model."}):(w.value=!1,B.value=!1,F.value="",N.value="",v.emit("update:loading",{isLoading:!0}),C.post(R.videoInference,{videoId:p.value&&p.value.videoId,containerId:f.value.containerId,format:h.value.name,encoder:E.value.value,bestQuality:i.value.indexOf("best quality")>=0?1:0,twoPassEncoding:i.value.indexOf("best quality")>=0?0:i.value.indexOf("2-Pass Encoding")>=0?1:0,avgBitrate:i.value.indexOf("best quality")>=0?"1000":V.value,vbr:i.value.indexOf("best quality")>=0?!1:x.value=="VBR",cbr:i.value.indexOf("best quality")>=0?!1:x.value=="CBR"}).then(n=>{sessionStorage.setItem("inference",JSON.stringify({uuid:n.data.data,containerId:f.value.containerId})),j.value=n.data.data,he(n.data.data)}))},ie=()=>{m.close(),M.value=!1,B.value=!1,de({containerId:f.value.containerId,uuid:j.value})},be=()=>{v.emit("update:alert",{isActive:!0,message:"취소하시겠습니까?",fn:()=>{v.emit("update:loading",{isLoading:!0}),ie()}})},he=n=>{const s=new Ue.EventSourcePolyfill("http://222.107.124.161:64000"+R.connectSSE+`?uuid=${n}`,{headers:{Authorization:$.user.token}});s.onopen=()=>{v.emit("update:loading",{isLoading:!1})},s.onmessage=Q=>{try{if(typeof JSON.parse(Q.data)=="object"){const S=JSON.parse(Q.data);u.value=S.step,H.value=S.progress,M.value=!0,S.status=="error"&&ie(),S.step=="all"&&S.progress==100&&S.result=="true"&&(s.close(),M.value=!1,sessionStorage.removeItem("inference"),v.emit("update:loading",{isLoading:!0}),F.value=S.originalVideo,N.value=S.inferenceVideo,B.value=!0,v.emit("update:loading",{isLoading:!1}))}}catch{}}},ue=n=>{if(M.value)return n.preventDefault(),n.stopImmediatePropagation(),""},de=n=>{v.emit("update:alert",{isActive:!0,message:"추론 정지중입니다. 잠시만 기다려주세요."}),C.delete(R.videoInference+`?containerId=${n.containerId}&uuid=${n.uuid}`).then(s=>{A(),v.emit("update:loading",{isLoading:!1}),v.emit("update:alert",{isActive:!0,message:"추론 정지가 완료되었습니다."}),sessionStorage.removeItem("inference")})};return Le(()=>{window.removeEventListener("beforeunload",ue)}),ce(()=>{window.addEventListener("beforeunload",ue),A(),sessionStorage.getItem("inference")!=null&&de(JSON.parse(sessionStorage.getItem("inference")))}),(n,s)=>{const Q=P("BaseButton"),S=P("FontAwesomeIcon"),Y=P("BaseSelect"),ke=P("BaseCheckBox"),re=P("BaseRadio"),xe=P("BaseInput"),Ve=Oe("tooltip");return c(),g(X,null,[M.value?(c(),ee(ye,{key:0,text:u.value+" in_progress...",progressValue:H.value,"onUpdate:closeProgressModal":be},null,8,["text","progressValue"])):T("",!0),e("main",null,[w.value?(c(),ee(Ee,{key:0,to:"#teleport-upload-modal"},[(c(),ee(ot,{key:L.value,"onUpdate:close":s[0]||(s[0]=r=>w.value=!1),"onUpdate:upload":s[1]||(s[1]=r=>k(r)),"onUpdate:abort":s[2]||(s[2]=r=>L.value+=1)}))])):T("",!0),e("aside",null,[e("section",nt,[it,e("div",ut,[_(Q,{onClick:s[3]||(s[3]=r=>w.value=!0),text:"Upload Video"})]),e("div",dt,[rt,_(Y,{onClick:b,name:"fileName",options:d.value,text:p.value==null?"<span class=not-selected>Please Upload Video Files</span>":p.value.fileName},{list:pe(()=>[(c(!0),g(X,null,te(d.value,(r,Ie)=>(c(),g("li",{class:"optionItem",key:Ie},[e("span",ct,K(r.date),1),(c(!0),g(X,null,te(r.video,(W,Z)=>(c(),g("div",{class:"file-name-area",onClick:Ce=>{J.value=!0,p.value=W},onMouseenter:()=>{l.value&&l.value[Z].offsetWidth<l.value[Z].scrollWidth&&(o.value=Z)}},[ve((c(),g("span",{class:"file-name",ref_for:!0,ref_key:"fileName",ref:l},[me(K(W.fileName),1)])),[[Ve,{content:o.value==Z?W.fileName:"",placement:"bottom",delay:0}]]),e("span",null,[e("span",pt,K(W.fileSize),1),_(S,{icon:"xmark",class:"delete-button",onClick:fe(Ce=>z(W.videoId),["stop"])},null,8,["onClick"])])],40,vt))),256))]))),128))]),_:1},8,["options","text"])])]),e("section",ft,[mt,e("div",_t,[gt,_(Y,{"onUpdate:selectBox":s[4]||(s[4]=r=>{f.value=r}),options:O.value,name:"projectName,modelName",text:f.value==null?"<span class=not-selected>Select AI Model</span>":f.value.projectName+"/"+f.value.modelName},null,8,["options","text"])]),e("div",yt,[bt,_(Y,{"onUpdate:selectBox":s[5]||(s[5]=r=>h.value=r),options:y,name:"name",text:h.value.name},null,8,["text"])]),e("div",ht,[kt,_(Y,{"onUpdate:selectBox":s[6]||(s[6]=r=>E.value=r),options:t.value,name:"name",text:E.value.name},null,8,["options","text"])]),e("div",xt,[e("div",null,[_(ke,{"onUpdate:checkModelValue":le,id:"BestQuality",value:"best quality"}),Vt])]),e("div",It,[e("div",null,[_(re,{class:U(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[s[7]||(s[7]=r=>x.value=r),s[8]||(s[8]=r=>x.value=r)],name:"vbrOrCbr",value:"VBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:x.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"VBR",class:U(i.value.indexOf("best quality")<0?"active":"inActive")},"VBR",2)]),e("div",null,[_(re,{class:U(["radio",i.value.indexOf("best quality")<0?"active":"inActive"]),"onUpdate:modelValue":[s[9]||(s[9]=r=>x.value=r),s[10]||(s[10]=r=>x.value=r)],name:"vbrOrCbr",value:"CBR",isDisabled:!(i.value.indexOf("best quality")<0),modelValue:x.value},null,8,["class","isDisabled","modelValue"]),e("label",{for:"CBR",class:U(i.value.indexOf("best quality")<0?"active":"inActive")},"CBR",2)])]),e("div",Ct,[wt,_(xe,{"onUpdate:modelValue":s[11]||(s[11]=r=>V.value=r),placeholder:"",type:"text",onlyText:!0,modelValue:i.value.indexOf("best quality")>=0?1e3:V.value,class:U(i.value.indexOf("best quality")<0?"active":"inActive"),isDisabled:!(i.value.indexOf("best quality")<0)},null,8,["modelValue","class","isDisabled"]),Bt]),e("div",At,[_(Q,{text:"Preview",class:U(p.value==null||f.value==null?"inActive":"active"),onClick:ae},null,8,["class"])])])]),_(ze,{isUploaded:J.value,isInferred:B.value,originalVideoSrc:F.value,inferredVideoSrc:N.value},null,8,["isUploaded","isInferred","originalVideoSrc","inferredVideoSrc"])])],64)}}});const Et=oe(St,[["__scopeId","data-v-1d14fc30"]]);export{Et as default};
